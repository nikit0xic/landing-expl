(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[35759],{95074:t=>{t.exports={reactions_preview_item:'<div class="ReactionsPreviewItem ReactionsPreviewItem--stackOverlay %class%" style="background-image: url(\'%image_url%\');" aria-label="%title%"></div>'}},559739:(t,e,n)=>{"use strict";n.d(e,{preservePositionBetween:()=>r});var i=n(368076),o=n(659397);function r(t,{scrollByImpl:e=window.scrollBy}={}){let n=t;return{start:(0,o.once)((function(t){t&&(n=t);const r=(0,i.getElementOffset)(n);return(0,o.once)((function(t){if(t&&(n=t),n.isConnected){const t=(0,i.getElementOffset)(n);e(0,t.top-r.top)}}))}))}}},877734:(t,e,n)=>{"use strict";n.d(e,{isDebugEnabled:()=>r});var i=n(180937);let o;const r=()=>(void 0!==o||(o=!!i.ls.get("reactions.debug_enabled")),o)},926595:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>r});var i=n(65718);const o="reactions";function r({error:t,reportError:e=!1}){e&&(0,i.logError)(t,{environment:o}),console.error(t)}},172613:(t,e,n)=>{"use strict";n.d(e,{isBadgesEnabled:()=>o,isBadgesRenderingEnabled:()=>r,isOneTimeDonutWithoutBadges:()=>a});var i=n(977053);const o=()=>(0,i.partConfigEnabled)("badges"),r=()=>(0,i.partConfigEnabled)("badges_rendering"),a=()=>(0,i.partConfigEnabled)("groups_one_time_donut_without_badges")},115990:(t,e,n)=>{"use strict";n.d(e,{stripPercentVars:()=>i});const i=t=>t.replace(/%[-\w]+%/g,"")},751602:(t,e,n)=>{"use strict";function i(t){const e=t.match(/^([a-z_]+)([0-9\-_]+)$/);if(!e)return null;const[,n,i]=e;return{objectType:n,objectId:i}}n.d(e,{getElementLikeButtonCount:()=>c,getElementLikeButtonIcon:()=>u,getElementLikeButtonLabel:()=>v,isObjectTypeIsVideo:()=>a,likePostObjectId:()=>o,likeReplyObjectId:()=>r,parseLikeObjectId:()=>i});const o=t=>`wall${t}`,r=t=>`wall_reply${t}`,a=t=>["video","video_comment"].includes(t);var s;const c=t=>{var e;return null!=(s=null==(e=t)?void 0:e.querySelector(".like_button_count, ._like_button_count"))?s:void 0};var l;const u=t=>{var e;return null!=(l=null==(e=t)?void 0:e.querySelector(".like_button_icon, ._like_button_icon"))?l:void 0};var d;const v=t=>null!=(d=t.querySelector(".like_button_label, ._like_button_label"))?d:void 0},703032:(t,e,n)=>{"use strict";n.d(e,{ATTR_USER_REACTION_ID:()=>i});const i="data-reaction-user-reaction-id"},608082:(t,e,n)=>{"use strict";n.d(e,{getLastOwnReactionChangeTime:()=>k,setDataCurrentId:()=>L,updateReactionButtonContainerForCounts:()=>E,updateReactionButtonCounts:()=>I,updateReactionButtonForCurrentReaction:()=>P});var i=n(11010),o=n(434788),r=n(541843),a=n(902947),s=(n(368076),n(471828)),c=n(877734),l=n(654200),u=n(70689),d=n(97875),v=n(703032),g=n(188498),b=n(900701),p=n(423842);const w="data-reaction-last-own-change-time",m="PostButtonReactions__icon--animationActive";const _="post_button";r.LottieManager.observer.ignoreGroup(_);const f=t=>{var e;const n=null==(e=t.__reactionIconAnimation)?void 0:e.player;n&&(n.destroy(),delete t.__reactionIconAnimation)},y=(0,i._)((function*(t,e,n,i){var o;if(!(t!==(null==(o=n.__reactionIconAnimation)?void 0:o.animationURL))&&t||(f(n),e.innerHTML="",n.classList.remove(m)),!i||!t)return;const a=yield r.LottieManager.loadAnimation({group:_,animationUrl:t,containers:[e],loop:!1,autoplay:!0});a.addEventListener("firstFrame",(()=>{n.classList.add(m)})),a.addEventListener("loopComplete",(()=>{var t;!0===(null==(t=(0,p.getReactionConfig)())?void 0:t.animationShowStaticAfterEnd)&&(n.classList.remove(m),f(n))})),n.__reactionIconAnimation={player:a,animationURL:t}})),R=(t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-icon"]');if(!n)return;const{currentOption:i,isUserAction:o}=e;if(i.isReactionSet){var r,a;const t=i.current,e=null==(r=t)?void 0:r.imageMenuURL;n.style.backgroundImage=`url('${e}')`,n.setAttribute("aria-label",null==(a=t)?void 0:a.title)}else{var s;const t=i.default;var c;if(n.style.backgroundImage="",null==(s=t)?void 0:s.title)n.setAttribute("aria-label",null==(c=t)?void 0:c.title)}n.classList.toggle("PostButtonReactions__icon--custom",i.isReactionSet);{const t=i.isReactionSet?i.current.animationURL:void 0,e=(t=>{let e=t.querySelector(".PostButtonReactions__iconAnimation");return e||(e=(0,u.se)('<div class="PostButtonReactions__iconAnimation" data-section-ref="reactions-button-icon-animation"></div>'),t.appendChild(e),e)})(n);y(t,e,n,o)}},S=(t,e,n)=>{t.classList.toggle("PostButtonReactions--icon-active",e),t.classList.toggle("PostButtonReactions--active",e)},E=(t,e)=>{const n=!e||!(0,l.hasReactionsForCounts)(e);t.classList.toggle("PostBottomAction--empty",n)},P=(t,e,n,i)=>{const r=!(0,l.isReactionIdUnset)(e),a=((t,e)=>{let n,i=(0,l.getDefaultReaction)(t);if((0,l.isReactionIdUnset)(e)){if(i)return{isReactionSet:!1,default:i}}else{if(n=t.itemsById[e],n)return{isReactionSet:!0,current:n};console.error(new Error(`Missing reaction meta for ${e} in set '${t.id}'`))}return{_error:!0}})(n,e);"_error"in a||(R(t,{currentOption:a,isUserAction:i}),((t,e)=>{const{currentOption:n}=e,i=n.isReactionSet?n.current.titleColor:void 0,r=n.isReactionSet?n.current.backgroundColor:void 0,a=i?{"--reaction-button-title-color-light":i.light,"--reaction-button-title-color-dark":i.dark}:{"--reaction-button-title-color-light":null,"--reaction-button-title-color-dark":null},s=r?{"--reaction-button-background-color-light":r.light,"--reaction-button-background-color-dark":r.dark}:{"--reaction-button-background-color-light":null,"--reaction-button-background-color-dark":null},c=(0,o._)({},a,s);Object.entries(c).forEach((([e,n])=>{t.style.setProperty(e,n)}))})(t,{currentOption:a}),((t,e)=>{const{currentOption:n}=e;let i="";i=n.isReactionSet?(0,s.langReplace)(s.getLang("reactions_button_unset_reaction_title")||"",{reaction_name:n.current.title||""}):(0,s.langReplace)(s.getLang("reactions_button_set_reaction_with_name")||"",{reaction_name:n.default.title||""})||s.getLang("reactions_button_title")||"",t.setAttribute("aria-label",i||"")})(t,{currentOption:a}),(0,g.isCounterEnabledForBtn)(t)||((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{currentOption:i}=e,o=i.isReactionSet?i.current.title:i.default.title;o?n.innerText=o:(0,c.isDebugEnabled)()&&console.log("reactions: setReactionNameTitle: missing title",i)})(t,{currentOption:a})),S(t,r),i&&function(t,e){t.setAttribute(w,String(e))}(t,Date.now())},I=(t,e,n,i,o)=>{const r=(0,g.getCounterForTitle)(t,e,i,o);if((0,g.isCounterEnabled)(r)&&(((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{counterForTitle:i}=e;if((0,g.isCounterAvailable)(i)){const t=i.buttonText;(0,d.animateCount)(n,t,{allowZero:i.allowZeroAnimation,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})}else(0,c.isDebugEnabled)()&&console.log("reactions: setReactionTitle: missing title",i)})(t,{counterForTitle:r}),i)){((t,e)=>{var n;const i=null==(n=(0,b.getClosestLikeBtnContainerElem)(t))?void 0:n.querySelector('[data-section-ref="reactions-button-screen-reader-counter"]');if(!i)return;const o=(0,s.langNumeric)(e,s.getLang("reactions_n_reacted","raw")||"%s",!0);i.innerText=o})(t,(0,l.calcCountersSum)(i))}},k=t=>{const e=t.getAttribute(w);if(e&&(0,a.isNumeric)(e))try{return new Date(Number.parseInt(e)).getTime()||void 0}catch(t){return void console.error(t)}};const L=(t,e)=>{t.setAttribute(v.ATTR_USER_REACTION_ID,(0,l.isReactionIdUnset)(e)?"":String(e))}},815483:(t,e,n)=>{"use strict";n.d(e,{ReactionMenuTitleVariants:()=>r,TITLE_VARIANT_DEFAULT:()=>o,TitleVariantWithLikedUsers:()=>i});const i="WithLikedUsers",o=i,r=[i,"TitleOnly"]},849367:(t,e,n)=>{"use strict";n.d(e,{ButtonStyleVariant:()=>i});const i={Post:"post",Reply:"reply"}},531402:(t,e,n)=>{"use strict";n.d(e,{renderPreviewItems:()=>u});var i=n(659397),o=n(654200),r=n(70689),a=n(95074),s=n.n(a),c=n(849367),l=n(423842);const u=(t,e,n,a,u)=>{const d=((t,e,n=!1)=>{let i=[];for(const e of Object.keys(t)){const n=(0,o.parseReactionId)(e);n.isValid&&t[n.value]>0&&i.push(n.value)}return i=i.sort(((e,n)=>(t[n]||0)-(t[e]||0))).slice(0,e),n&&i.reverse(),i})(e,3),v=t.querySelector(".ReactionsPreview__items"),g=(0,l.getReactionSet)(n),b=0===(0,o.calcCountersSum)(e),p=s().reactions_preview_item;v&&g&&"string"==typeof p?(v.innerHTML=d.map((t=>{const e=g.itemsById[t];if(!e)return"";const n=(0,i.classNames)({"ReactionsPreviewItem--lite ReactionsPreviewItem--stackOverlayLite":u===c.ButtonStyleVariant.Reply,"ReactionsPreviewItem--post ReactionsPreviewItem--stackOverlayPost":u===c.ButtonStyleVariant.Post});return(0,r.rs)(p,{image_url:e.imagePreviewURL,title:e.title,class:n})})).join(""),t.classList.toggle("ReactionsPreview--empty",b),t.classList.toggle("ReactionsPreview--active",void 0!==a)):console.warn("Unable to render reaction previews",{itemsContainer:v,previewItemTemplate:p,reactionSet:g})}},750030:(t,e,n)=>{"use strict";n.d(e,{isIntentPreviewHidden:()=>c,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewUseCurrent:()=>l,isVariantHidden:()=>r,isVariantInActionStatusBar:()=>o,parsePreviewVariant:()=>d,previewVisibilityIntentForVariant:()=>u,previewVisibilityUseCurrent:()=>a});var i=n(771220);const o=t=>t===i.PreviewVariantActionStatusBar,r=t=>t===i.PreviewVariantHidden,a={kind:"useCurrent"},s=t=>t.kind===i.PreviewVariantActionStatusBar,c=t=>t.kind===i.PreviewVariantHidden,l=t=>"useCurrent"===t.kind,u=t=>t?{kind:t}:a,d=t=>i.PreviewVariants.includes(t)?t:void 0},771220:(t,e,n)=>{"use strict";n.d(e,{PreviewVariantActionStatusBar:()=>i,PreviewVariantHidden:()=>o,PreviewVariants:()=>r});const i="action_status_bar",o="hidden",r=[i,o]},863218:(t,e,n)=>{"use strict";n.d(e,{REACTIONS_COUNTS_RESPONSE_FIELD:()=>c,SIZE_128:()=>s,SIZE_32:()=>o,SIZE_40:()=>r,SIZE_96:()=>a,SUPPORTED_OBJECT_TYPES:()=>i,WK_SECTION_PREFIX_REACTIONS:()=>l});const i={wall:"wall",wall_reply:"wall_reply"},o={width:32,height:32},r={width:40,height:40},a={width:96,height:96},s={width:128,height:128},c="reactions_counts",l="reactions"},688731:(t,e,n)=>{"use strict";n.d(e,{ENABLED_IN_POST_REPLY:()=>o,isDebugEnabled:()=>i.isDebugEnabled});var i=n(877734);const o=!1},188498:(t,e,n)=>{"use strict";n.d(e,{getCounterForTitle:()=>a,isCounterAvailable:()=>c,isCounterEnabled:()=>s,isCounterEnabledForBtn:()=>r});var i=n(654200),o=n(471828);const r=t=>!!t.getAttribute("data-reaction-button-text-is-counter");function a(t,e,n,a){if(!r(t))return{kind:"disabled"};if(!n)return{kind:"error"};const s=0!==(a?(0,i.calcCountersSum)(a):0);if(!(0,i.hasReactionsForCounts)(n))return{kind:"enabled",allowZeroAnimation:s,buttonText:""};const c=(0,i.calcCounters)(n,e),l=(0,i.calcCountersWeightedSum)(c);return{kind:"enabled",allowZeroAnimation:s,buttonText:(0,o.langNumeric)(l,"%s",!0)}}function s(t){return!!t&&"disabled"!==t.kind}function c(t){return"enabled"===t.kind}},272546:(t,e,n)=>{"use strict";n.d(e,{addDataUpdateListener:()=>s,addReactionChooseListener:()=>l,emitDataUpdate:()=>c,emitReactionChoose:()=>u});var i=n(288824),o=n(195763);const r=(0,i.makeSharedState)("reactions-menu-events",(()=>({emitter:new o.default})),{version:0}),a=()=>r().emitter,s=(t,e)=>{const n=a(),i={[`${t}:data_update`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},c=(t,e)=>{a().emit(`${t}:data_update`,e)},l=(t,e)=>{const n=a(),i={[`${t}:reaction_choose`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},u=t=>{a().emit(`${t}:reaction_choose`)}},107857:(t,e,n)=>{"use strict";n.d(e,{getPreviewVariantForLikeBtn:()=>b,reactionsElemPayload:()=>p,reactionsElemPayloadForBadges:()=>w,shouldReactionsPreviewBeVisible:()=>y,updateReactionsButtonForCounts:()=>E,updateReactionsPreview:()=>S,verifyPayloadForBadges:()=>m});var i=n(861532),o=n(654200),r=n(97875),a=n(471828),s=n(423842),c=n(900701),l=n(27553),u=n(750030),d=n(531402),v=n(703032);const g=t=>{const e=t.getAttribute("data-reaction-counts");if(null===e)return{};const n=e?(0,i.parseJSON)(e):void 0;return"object"==typeof n&&null!==n?n:void 0},b=t=>{const e=t.getAttribute("data-reaction-preview-variant");if(e)return(0,u.parsePreviewVariant)(e)},p=t=>{const e=t.getAttribute("data-reaction-target-object"),n=t.getAttribute("data-reaction-hash"),i=t.getAttribute("data-reaction-set-id");if(null===i)return;const r=t.getAttribute(v.ATTR_USER_REACTION_ID),a=r?(0,o.parseReactionIdOrUnset)(r):void 0,s=t.getAttribute("data-reaction-style-variant"),c=s&&(0,l.isValidButtonStyleVariant)(s)?s:void 0,u=t.getAttribute("data-reaction-menu-title-variant"),d=u&&(0,l.isValidButtonTitleVariant)(u)?u:void 0,p=b(t);return{counts:g(t),csrfHash:n,objectRaw:e,reactionSetId:i,styleVariant:c,titleVariant:d,userReactionId:a,previewVariant:p}},w=t=>({objectId:t.getAttribute("data-badges-object-id"),objectOwnerId:t.getAttribute("data-badges-object-owner-id"),objectType:t.getAttribute("data-badges-object-type"),ref:t.getAttribute("data-badges-ref"),showOnboarding:t.getAttribute("data-badges-show-onboarding")}),m=t=>{const{objectId:e,objectOwnerId:n,objectType:i}=t;return e&&n&&i};var _;const f=(t,e,n,i)=>{const o=(0,a.langNumeric)(n,a.getLang("reactions_n_reacted","raw")||"%s",!0);t.setAttribute("aria-label",o);const s=null!=(_=t.querySelector('[data-section-ref="like-button-count"]'))?_:void 0;if(!s)return;if(t.tt&&"object"==typeof t.tt){var c,l;if(!(t.tt.shown||t.tt.showing))null==(l=t.tt)||null==(c=l.destroy)||c.call(l)}const u=(0,a.langNumeric)(e,"%s",!0);(0,r.animateCount)(s,u,{allowZero:0!==i,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})},y=t=>(0,o.hasReactionsForCounts)(t),R=(t,e,n)=>{const i=p(t);i&&i.objectRaw&&((t,{counts:e,countsPrevious:n,objectRaw:i,reactionId:r,reactionSetId:a,styleVariant:l})=>{const u=(0,s.getReactionSet)(a),v=(0,o.calcCounters)(e,u),g=(0,o.calcCountersWeightedSum)(v),b=(0,o.calcCountersSum)(e),p=n?(0,o.calcCountersSum)(n):0,w=(0,c.getPreviewElem)(i);w&&((0,d.renderPreviewItems)(w,e,a,r,l),f(w,g,b,p))})(0,{counts:e,countsPrevious:n,objectRaw:i.objectRaw,reactionId:i.userReactionId,reactionSetId:i.reactionSetId,styleVariant:i.styleVariant})},S=(t,e)=>{const n=(0,c.getLikeBtnElem)(t),i=e.counts;n&&i?R(n,i,e.countsPrevious):console.warn("Unable to update object reactions",{objectRaw:t,options:e})},E=(t,{counts:e})=>{const n=(0,c.getLikeBtnElem)(t);n&&((t,e)=>{t.setAttribute("data-reaction-counts",JSON.stringify(e))})(n,e)}},69703:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>r});var i=n(926595),o=n(423842);const r=({error:t})=>{var e;var n;const r=null!=(n=null==(e=(0,o.getReactionConfig)())?void 0:e.reportJsErrors)&&n;(0,i.reactionLogError)({error:t,reportError:r})}},900701:(t,e,n)=>{"use strict";var i;n.d(e,{getButtonContainer:()=>l,getClosestLikeBtnContainerElem:()=>a,getHiddenLikeBtn:()=>p,getLikeBtn:()=>g,getLikeBtnElem:()=>o,getLikeWrap:()=>c,getMenuMount:()=>d,getPreviewElem:()=>w});const o=t=>null!=(i=document.querySelector(`[data-section-ref="reactions-button"][data-reaction-target-object="${t}"]`))?i:void 0;var r;const a=t=>null!=(r=t.closest('[data-section-ref="reactions-button-container"]'))?r:void 0;var s;const c=t=>{const e=o(t);if(e)return null!=(s=e.closest(".like_wrap"))?s:void 0},l=t=>t.closest('[data-section-ref="reactions-button-container"]');var u;const d=t=>null!=(u=t.querySelector('[data-section-ref="reactions-menu-mount"]'))?u:null;var v;const g=t=>null!=(v=t.querySelector('[data-section-ref="reactions-button"]'))?v:null;var b;const p=t=>null!=(b=t.querySelector('[data-section-ref="reactions-hidden-button"]'))?b:void 0,w=t=>document.querySelector(`[data-section-ref="reactions-preview-items"][data-reaction-target-object="${t}"]`)},423842:(t,e,n)=>{"use strict";n.d(e,{getReactionConfig:()=>p,getReactionSet:()=>g,storageAddSets:()=>v,storageSetConfig:()=>b});var i=n(434788),o=n(288824),r=n(659397),a=n(654200),s=n(69703),c=n(863218),l=n(688731);const u=(0,o.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),d=(0,o.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),v=t=>{(0,l.isDebugEnabled)()&&console.log(t),Object.entries(t).forEach((([t,e])=>{const n=(0,a.validateReactionSetPayloaditems)(e,t);if(n)return void(0,s.reactionLogError)({error:n.error});const o=e.map((t=>(0,i._)({},t,{title:(0,r.decodeHTMLEntities)(t.title)})));u().set(t,(0,a.prepareReactionMenuSet)(t,o,{imageMenuSize:c.SIZE_96,imagePreviewSize:c.SIZE_32,imageStoryPanelSize:c.SIZE_128,imageStoryPreviewSize:c.SIZE_40}))}))},g=t=>{const e=u().get(t);if(e)return e;{const e=new Error(`Reaction set not found: ${t}`);(0,s.reactionLogError)({error:e})}},b=t=>{(0,l.isDebugEnabled)()&&console.log(t);const e=(0,a.parseReactionMenuConfig)(t);e?d().config=e:console.warn("Reactions: invalid menu config passed",t)},p=()=>{var t;return null==(t=d())?void 0:t.config}},27553:(t,e,n)=>{"use strict";n.d(e,{isValidButtonStyleVariant:()=>v,isValidButtonTitleVariant:()=>d,isValidEnvironment:()=>a,preloadImage:()=>s,usePrevious:()=>c,usePreviousRef:()=>l});var i=n(667294),o=n(815483),r=n(849367);const a=()=>{var t,e,n;return"function"==typeof(null==(t=window.cur)?void 0:t.viewAsBox)?(window.cur.viewAsBox(),!1):!(window.vk.widget&&!window.vk.id)||(null==(n=window.Widgets)||null==(e=n.oauth)||e.call(n),!1)},s=t=>new Promise(((e,n)=>{const i=new Image;i.src=t,i.onload=()=>e(),i.onerror=()=>n()})),c=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e.current},l=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e},u=Object.values(r.ButtonStyleVariant),d=t=>o.ReactionMenuTitleVariants.includes(t),v=t=>u.includes(t)},894289:(t,e,n)=>{"use strict";n.d(e,{isReactionsFullUpdatePayload:()=>a,reactionsCountsOnlyUpdatePayload:()=>s,reactionsCountsUpdatePayload:()=>r});var i=n(434788),o=n(776590);const r=(t,e)=>(0,i._)({kind:o.PayloadKindFull},t,{reactionIdState:{reactionId:e.id}}),a=t=>t.kind===o.PayloadKindFull,s=t=>(0,i._)({kind:o.PayloadKindCountsOnly},t)},776590:(t,e,n)=>{"use strict";n.d(e,{PayloadKindCountsOnly:()=>i,PayloadKindFull:()=>o});const i="counts_only",o="counts_with_current_reaction"},773781:(t,e,n)=>{"use strict";n.d(e,{postRenderReactionsInit:()=>A});var i=n(608082),o=n(659397),r=n(559739),a=n(70689),s=n(115990),c=n(751602),l=n(688731),u=n(107857),d=n(750030),v=n(900701),g=n(894289),b=n(41114),p=n(534691),w=n(658539),m=n(977053),_=n(272546),f=n(771220),y=n(423842),R=n(172613);const S=(t,e,n=(()=>{var t;return null==(t=window.cur)?void 0:t.wallTpl})())=>{var i;const o=null==(i=n)?void 0:i[t];if(o)return(0,s.stripPercentVars)((0,a.rs)(o,e));console.warn(`renderTemplate: missing template '${t}'`,n)},E=({isUserAction:t=!1},...e)=>{t?console.error(...e):(0,l.isDebugEnabled)()&&console.warn(...e)},P=t=>(0,R.isBadgesEnabled)()&&t.classList.contains("PostActionStatusBar--withBadges");const I=(t,e,{isActionStatusBarVisible:n,isReactionsPreviewVisible:i,positionTrackingEnd:r})=>{const s=((t,e)=>{var n,i,o;const r=(0,v.getLikeWrap)(t);if(!r)return;const s=null==(n=(0,p.getPostElem)(e,r))?void 0:n.querySelector('[data-section-ref="post-action-status-bar"]');if(s)return{actionStatusBar:s};const c=(0,w.isWkLayerWallPostOpen)()?null==(i=window.wkcur)?void 0:i.wallTpl:null==(o=window.cur)?void 0:o.wallTpl,l=(0,a.se)(S("post_action_status_bar",{class:"PostActionStatusBar--hidden"},c));return l?((0,m.partConfigEnabled)("feed_redesign_post_bottom_2023_enabled")?(0,a.domInsertAfter)(l,r):(0,a.domInsertBefore)(l,r),{actionStatusBar:l}):void 0})(t,e.postFullId);if(!s)return void E({},"Unable to init ActionStatusBar in post",e);const{actionStatusBar:c}=s;if(c.classList.toggle("PostActionStatusBar--hidden",!n),P(c)&&c.classList.toggle("PostActionStatusBar--withReactions",i),n&&!(0,v.getPreviewElem)(t)){const e=(0,a.se)(function(t,e,n={}){var i,r;const a=(0,w.isWkLayerWallPostOpen)()?null==(i=window.wkcur)?void 0:i.wallTpl:null==(r=window.cur)?void 0:r.wallTpl,s=(0,o.classNames)({"ReactionsPreview--empty":!t,"ReactionsPreview--isInActionStatusBar":!!n.isInActionStatusBar});return S("post_reactions_preview",{class:s,object_raw:e},a)}(i,t,{isInActionStatusBar:!0}));if(P(c)){const t=c.querySelector(".PostActionStatusBar__leftInner");t&&t.prepend(e)}else c.prepend(e)}if(r){var l;const e=(0,v.getLikeBtnElem)(t);null==(l=r)||l(e)}},k=t=>{var e;if(!(t=>void 0!==t.counts)(t))return void E(t,"Counts is invalid or missing");const n=(0,c.likePostObjectId)(t.postFullId),i=(0,p.getPostElem)(t.postFullId,(0,v.getLikeWrap)(n));i||E(t,"Missing post element for reactions preview update",{payload:t,likeWrap:(0,v.getLikeWrap)(n)});const o=(0,v.getLikeBtnElem)(n);if(!o)return void E(t,"Unable to find reactions button",{likeObjectId:n});const r=(0,u.reactionsElemPayload)(o),a=null==(e=r)?void 0:e.counts;L({elemPayload:r,likeBtnElem:o,likeObjectId:n,payload:t}),B({countsPrevious:a,likeBtnElem:o,likeObjectId:n,payload:t,postEl:i})},L=({elemPayload:t,likeBtnElem:e,likeObjectId:n,payload:o})=>{const{counts:r}=o;if(!!o.isQueueUpdate&&(t=>{const e=(0,i.getLastOwnReactionChangeTime)(t);if(!e)return!1;const n=e+1e4;return Date.now()<n})(e))(0,l.isDebugEnabled)()&&console.log("Ignoring reactions update from queue",o);else{if(t){const{counts:n,reactionSetId:a}=t,s=(0,y.getReactionSet)(a);if((0,g.isReactionsFullUpdatePayload)(o)){const t=o.reactionIdState.reactionId;s&&(0,i.updateReactionButtonForCurrentReaction)(e,t,s,o.isUserAction)}s&&((0,i.updateReactionButtonCounts)(e,s,o.isUserAction,r,n),(0,i.updateReactionButtonContainerForCounts)(e,r))}if((0,g.isReactionsFullUpdatePayload)(o)){var a;const n=o.reactionIdState.reactionId;(0,i.setDataCurrentId)(e,n),o.isUserAction&&(null==(a=t)?void 0:a.objectRaw)&&(0,_.emitDataUpdate)(t.objectRaw,{currentReactionId:n})}(0,u.updateReactionsButtonForCounts)(n,{counts:r})}},B=({countsPrevious:t,likeBtnElem:e,likeObjectId:n,payload:i,postEl:o})=>{const{counts:a,previewVisibility:s=d.previewVisibilityUseCurrent}=i,c=((t,e)=>{if((0,d.isIntentPreviewInActionStatusBar)(t))return{previewVariant:f.PreviewVariantActionStatusBar};if((0,d.isIntentPreviewHidden)(t))return{previewVariant:f.PreviewVariantHidden};if((0,d.isIntentPreviewUseCurrent)(t)){const t=(0,u.getPreviewVariantForLikeBtn)(e);if(t)return{previewVariant:t}}})(s,e);if(!c)return;const{previewVariant:l}=c,v=(0,d.isVariantInActionStatusBar)(l),g=(0,u.shouldReactionsPreviewBeVisible)(a),b=(0,d.isVariantHidden)(l)||v&&!g;if(v){let t;i.isPrimaryLikeButtonClick&&!i.isFromWkLayer&&(t=(0,r.preservePositionBetween)(e).start());const a=g;var p;if(!(0,R.isBadgesEnabled)())null==(p=o)||p.classList.toggle("post--withActionStatusBar",a);I(n,i,{isActionStatusBarVisible:a,isReactionsPreviewVisible:g,positionTrackingEnd:t})}b||(0,u.updateReactionsPreview)(n,{counts:a,countsPrevious:t})},C=t=>{if(!l.ENABLED_IN_POST_REPLY)return!1;const{counts:e}=t;if(!e)return;const n=(0,c.likeReplyObjectId)(t.replyFullId);(0,u.updateReactionsPreview)(n,{counts:e,countsPrevious:void 0}),(0,u.updateReactionsButtonForCounts)(n,{counts:e})},A=()=>{let t=[(0,b.registerUniqueListener)("wall-post-action-status-bar",b.WallDataEvents.post_reactions_counts_update,k),(0,b.registerUniqueListener)("wall-reply-reactions-counts",b.WallDataEvents.reply_reactions_counts_update,C)];return{onDestroy:()=>{t.forEach((t=>{t()})),t=[]}}}},214009:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>a,emitEvent:()=>d,registerNonGlobalNonUniqueListener:()=>u,registerUniqueListener:()=>l});var i=n(434788),o=n(288824),r=n(195763);const a={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update",post_subscribe_update:"wall/post_subscribe_update"},s=(0,o.makeSharedState)("wall-data",(()=>({emitter:new r.default,keyedListeners:Object.create(null)})),{version:0}),c=(t,e,n)=>{var o,r;const a=s(),c=null==(r=a.keyedListeners)||null==(o=r[t])?void 0:o[e];return c&&a.emitter.removeListener(t,c),((t,e,n)=>{const o=s();return o.emitter.addListener(t,n),o.keyedListeners[t]=(0,i._)({},o.keyedListeners[t],{[e]:n}),()=>{var i,r;o.emitter.removeListener(t,n),(null==(i=o.keyedListeners[t])?void 0:i[e])===n&&(null==(r=o.keyedListeners[t])||delete r[e])}})(t,e,n)},l=(t,e,n)=>c(e,t,n),u=(t,e)=>((t,e)=>{const n=s();return n.emitter.addListener(t,e),()=>{n.emitter.removeListener(t,e)}})(t,e),d=(t,e)=>{s().emitter.emit(t,e)}},41114:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>i.WallDataEvents,registerUniqueListener:()=>i.registerUniqueListener});var i=n(214009)}}]);try{stManager.done("dist/web/chunks/dbd3c9f0.516a34d3.js")}catch(t){}