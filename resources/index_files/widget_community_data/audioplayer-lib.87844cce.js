"use strict";(self.webpackChunkvkwidgets=self.webpackChunkvkwidgets||[]).push([[4927],{86314:(e,t,i)=>{i.d(t,{drawAlbumPartRow:()=>s});var o=i(3895);function s(e){return`<div class="audio_album_part_row">${(0,o.getLang)("audio_album_part").replace("{part}",e)}</div>`}},21222:(e,t,i)=>{i.d(t,{getAlbumParts:()=>s});var o=i(92414);function s(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){const t=e.getAudiosList(),i=e.getAudiosCount(),s=[];let a=0;for(let e=0;e<i;e++){const i=t[e][o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];i>a&&(a=i,s.push({number:i,offset:e}))}if(s.length>1)return s}return!1}},87339:(e,t,i)=>{i.d(t,{showAudioAlbum:()=>l});var o=i(90600),s=i(56401),a=i(80971);function l(e,t){return cur.viewAsBox?cur.viewAsBox():(t=s.AudioUtils.audioTupleToAudioObject(t),layers.fullhide&&layers.fullhide(),(0,a.onAdditionalEvent)(e,t,{type:o.TYPE_SHOW_ALBUM}),s.AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))}},1660:(e,t,i)=>{i.d(t,{followArtist:()=>r});var o=i(1959),s=i(56401),a=i(3895),l=i(59427),n=i(23434);function r(e,t,i,r){(0,o.lockButton)(r),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(r),onDone:i=>{(0,o.unlockButton)(r),l.FlatButton.setLabel(r,(0,a.getLang)("audio_following_artist_button")),r.classList.add("MusicAuthor__follow_btn__followed"),(0,n.showDoneBoxFull)("",{},{text:(0,a.getLang)("audio_follow_artist_success_notification_text"),title:(0,a.getLang)("audio_follow_artist_success_notification_title")}),r.onclick=o=>{o.preventDefault(),s.AudioUtils.unfollowArtist(e,t,i,r)}}})}},49659:(e,t,i)=>{function o(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})}i.d(t,{trackArtistToOfficial:()=>o})},53864:(e,t,i)=>{i.d(t,{unfollowArtist:()=>r});var o=i(1959),s=i(56401),a=i(3895),l=i(82753),n=i(59427);function r(e,t,i,r){(0,o.lockButton)(r),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(r),onDone:i=>{if(r){(0,o.unlockButton)(r);(0,l.hasClass)(r,"MusicAuthor__follow_btn__can_follow")?(n.FlatButton.setLabel(r,(0,a.getLang)("audio_follow_artist_button")),r.classList.remove("MusicAuthor__follow_btn__followed"),r.onclick=o=>{o.preventDefault(),s.AudioUtils.followArtist(e,t,i,r)}):(0,l.re)(r)}}})}},89829:(e,t,i)=>{i.d(t,{getRowActionName:()=>n});var o=i(3895),s=i(56401),a=i(48041),l=i(44142);function n(e,t,i){var n,r;const d=(0,a.partConfigEnabled)("add_audio_to_effector_web"),_=(0,l.ensureAudioPageService)(),u=null==(r=_.$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState()[t.fullId])||null==(n=r.state)?void 0:n.text,c=t.fullId in _.$deletedFromMyMusicAudiosIdentitiesMap.getState(),h=t.fullId in _.$myMusicIdentitiesMap.getState();let p,A=s.AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":p=(0,o.getLang)("audio_delete_from_current");break;case"recoms_delete":p=(0,o.getLang)("audio_dont_show");break;case"listened_delete":p=(0,o.getLang)("audio_remove_from_list");break;case"delete":if(s.AudioUtils.isPodcast(t))p=(0,o.getLang)("audio_podcast_delete_episode");else if(window.AudioPage&&window.AudioPage.isInRecentPlayed(i))p=(0,o.getLang)("audio_remove_from_list");else if(d)p=u||(0,o.getLang)("global_delete_audio");else{let e=A[t.fullId];p=e&&e.deleteAll?e.deleteAll.text:(0,o.getLang)("global_delete_audio")}break;case"restore_recoms":p=(0,o.getLang)("audio_restore_audio");break;case"more":p=(0,o.getLang)("global_media_selector_more");break;case"add":let e=A[t.fullId];if(e&&A[e.addedFullId]&&(e=null),s.AudioUtils.isPodcast(t))p=(0,o.getLang)("audio_podcast_restore_episode");else if(d?c:e&&"deleted"==e.state)p=(0,o.getLang)("audio_restore_audio");else if(d?h:e&&"added"==e.state)p=(0,o.getLang)("global_delete_audio");else{let e=!1;window.AudioPage&&(e=currentAudioPage(i)),!e&&window.cur.audioPage&&(e=window.cur.audioPage),p=e&&e.getOwnerId()<0&&e.canAddToGroup()&&e.getOwnerId()!==t.ownerId?(0,o.getLang)("audio_add_to_group"):(0,o.getLang)("audio_add_to_audio")}break;case"edit":p=s.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_edit_episode"):(0,o.getLang)("audio_edit_audio");break;case"next":p=(0,o.getLang)("audio_set_next_audio");break;case"recoms":p=(0,o.getLang)("audio_show_recommendations");break;case"fave":p=s.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_listen_later"):"";break;case"lyrics":p=(0,o.getLang)("audio_show_lyrics");break;case"snippet":p=(0,o.getLang)("audio_longtap_tooltip_text");break;default:p=""}return p}},28758:(e,t,i)=>{i.d(t,{hasAudioHQBodyClass:()=>s});var o=i(92414);function s(){return document.body.classList.contains(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS)}},71513:(e,t,i)=>{i.d(t,{renderAudioDiag:()=>l});var o=i(82753),s=i(39586),a=i(92414);function l(){let e=(0,o.ge)("audio_diag_log"),t=ls.get(a.AUDIO_PLAYER_ENUMS.LOG_LS_KEY)||[];e&&(0,s.each)(t,(function(t,i){let s=new Date(i.shift()).toUTCString();i=i.join(", "),e.appendChild((0,o.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+s+"</span>"+i+"</div>"))}))}},82641:(e,t,i)=>{i.d(t,{toggleAudioHQBodyClass:()=>s});var o=i(92414);function s(){let e=AudioPlayer.showHQLabel();document.body.classList.toggle(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS,e)}},76784:(e,t,i)=>{i.d(t,{updateQueueReceivedPost:()=>a});var o=i(82753),s=i(39586);function a(e){e&&(0,s.each)((0,o.geByClass)("_audio_row",e),(function(){(0,o.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))}},70027:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AudioPlaylist:()=>AudioPlaylist});var _shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(34892),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23434),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(39586),_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(56401),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(75419),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(16768),_web_audio_FetchService__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(94271),_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(18128);class AudioPlaylist{static splitId(e){let[t,i,...o]=e.split("_");return o=o.join("_"),[t,i,o]}static getFullIdFromData(e){const t=e||{},{ownerId:i,id:o,albumId:s,accessHash:a}=t;return`${i||vk.id}_${o||s||0}${a?"_"+a:""}`}updatePlaylist(e){const t=this.getSelf();let i=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,i=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,i=!0),i):i}_ensureIndex(e){const t=this.getSelf();if(t._index)return void(e&&e());const i=t.getAudiosList();if(!i)return;const o=(e,t)=>{const i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(t);return i>=33&&i<48?String.fromCharCode(i):e};t._index=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_5__.vkIndexer(i,(e=>(e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,o)),e)}cleanIndex(){this.getSelf()._index=null}search(e,t){let i=this.getSelf();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)||(e={q:e}),this._ensureIndex((()=>{let o=i._index?i._index.search(e.q):[];return o=o.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS]})),t(o)}))}setNextOffset(e){this._nextOffset=e}getNextOffset(){let e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getNoConsecutivePlay(){return this.getSelf()._noConsecutivePlay}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._implPlay_rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return null==this.getSelf()._titleLang?null:this.getSelf()._titleLang}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getAudiosList(){return this.getSelf()._list}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){let e=this.getSelf()._live;return!!e&&(e=e.split(","),{hostId:e[0],audioId:e[1],hash:e[2]})}getAudiosCount(){let e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){let e=this.getAudiosList(),t=0;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(e,(function(e,i){t+=i[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),t}getAudio(e){if(!e)return null;let t=this.getSelf();"string"==typeof e&&(e=e.split("_"));for(let i=0,o=t._list.length;i<o;i++)if(e[0]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_ID])return t._list[i];return null}getAudioAt(e){let t=this.getSelf();return e<t._list.length?t._list[e]:null}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){let t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}getForceReload(){return this.getSelf()._forceReload}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}isLoadable(){return this.getSelf()._isLoadable}getFeedOffset(){return this._feedOffset}getFeedFrom(){return this._feedFrom}_unref(){let e=this._ref;if(!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e))return;let t={};for(let i in e)if(e.hasOwnProperty(i)&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e[i])&&0===i.indexOf("_")){let o=e[i];t[i.substr(1)]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(o)?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clone)(o):o}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this._fetchService=t.fetchService,this.mergeWith(t)}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}indexOfAudio(e){if(!e)return-1;let t=[];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isString)(e)?t=e.split("_"):(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?t=[e.ownerId,e.id]:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);const i=this.getAudiosList();if(!i)return-1;for(let e=0,o=i.length;e<o;e++)if(i[e]&&t[0]==i[e][_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==i[e][_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_ID])return e;return-1}asObject(){let e={};return e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=window.getAudioPlayer()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,e.blockId=this.getBlockId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),this.getType()===AudioPlaylist.TYPE_RADIO&&(e.list=this.getAudiosList()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}clean(e){e||this._unref();let t=this.getSelf();t._hasMore=!0,t._list=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){return this.getSelf()._list=e||[]}setForceReload(e){let t=this.getSelf();return e&&(t._hasMore=!0),t._forceReload=e}getBlockId(){return this.getSelf()._blockId}getAudioIds(e){return this.getSelf()._fetchService.getAudioIdsBySource({playlist_id:this.getFullId(),block_id:this.getBlockId(),trackType:e,context:this.getContext()})}loadAll(e,t=""){if(!this.isFullyLoadable())return e&&e(this);this.load(0,e,!0,"default",t)}loadByBlockId(e,t,i,o="default"){const s=(e,t=null)=>{const i=this._onDoneLoading;delete this._onDoneLoading,delete this._loadingAll,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(i||[],((e,i)=>{i&&i(this,t)}))},a=this.getNextOffset();return!this.getAudiosCount()||e&&e===a?(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll?void 0:i?(this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_4__.loadAllPlaylistAudios)(this,s)):void ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:a},{onDone:e=>{this._blockId=e.blockId;const t=window.getAudioPlayer();t.mergePlaylistData(this,e),s(),t.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})):t&&t(this)}load(offset,onDone,needAll,trackType="default",viewType=null){(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(offset)?(onDone=offset,offset=0):offset=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(offset),this.getSelf().isExpired()&&(this.getSelf()._hasMore=!0,this.getSelf().setForceReload(!0));const searchParams=this.getSearchParams();let wasPreload=!1,countAvailable=this.getType()===this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,i)=>{let o=this._onDoneLoading;i||(delete this._onDoneLoading,delete this._loadingAll);(!wasPreload||wasPreload&&cur.audioChooseBox&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_1__.curBox)())&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(o||[],((i,o)=>{o&&o(e,t)})),i&&(wasPreload=!0)},params;if(this.getSelf().getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),this._loadingAll)return onDone&&onDone(this);if(needAll)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_4__.loadAllPlaylistAudios)(this,callOnDones,viewType);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getSelf().getForceReload()&&this.getSelf().setForceReload(!1);let isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{const e=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:e,playlist_id:this.getPlaylistId(),offset:offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(nav.objLoc.claim),track_type:trackType}}return ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf().setNextOffset(""),void(isCatalog?onDone&&onDone(loadedPlaylist):callOnDones(loadedPlaylist));if(window.addTemplates({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),this._loadingAll&&!needAll)return;const audioPlayer=window.getAudioPlayer();audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?onDone&&onDone(loadedPlaylist.list):callOnDones(loadedPlaylist),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)},onFail:()=>!0,cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0})}isExpired(){const e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","noConsecutivePlay","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire"],((t,i)=>{void 0!==e[i]&&(this["_"+i]=e[i])}))}mergeWith(e){let t=e.list;this.isExpired()&&(this.getSelf()._list=[]),t&&t.length&&(this.getType()===AudioPlaylist.TYPE_RADIO?this.pushAudio(t,0):this.pushAudio(t)),this.mergeInfo(e)}pushAudio(e,t){this._unref();const i=void 0===t,o=e=>{const o=this.getAudiosList(),s=[];for(let a=0;a<e.length;a++){const l=e[a],n=this.indexOfAudio(l);n<0?s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clone)(l)):i||(s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clone)(l)),o.splice(n,1),n<t&&t--)}for(const e of s)e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,""));i?o.push(...s):o.splice(t,0,...s),this._index&&s.forEach((e=>this._index.add(e)))};(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e[0])?o(e):e&&e.length&&o([e])}moveAudio(e,t){this._unref();let i=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,i[0])}removeAudio(e){let t=this.indexOfAudio(e);if(t>=0){var i;this._unref();let e=this._list.splice(t,1);null==(i=this._index)||i.remove(e[0]);return window.getAudioPlayer().saveStateCurrentPlaylist(),t}return-1}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextAudio(...e){return this.getSelf()._fetchNextAudio(...e)}fetchNextLiveAudio(e){let t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>e&&e(t),onFail:()=>!0})}constructor(e,t,i){let o={};if(e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e.getId))return e.isReference()?(window.getAudioPlayer().addPlaylist(this),e):(this._ref=e,void window.getAudioPlayer().addPlaylist(this));(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?o=e:(o.ownerId=t,o.type=e,o.albumId=i||++AudioPlaylist.plIndex),this._type=o.type,this._ownerId=o.ownerId||vk.id,this._albumId=o.albumId||0,this._fromId=o.fromId||0,this._list=[],this._context=o.context||"",this._blockId=o.blockId,this._isFakeId=!1,this._expire=o.expire||null,this._noDiscover=o.hasOwnProperty("noDiscover")?o.noDiscover:null,this._nextOffset=o.nextOffset,this._forceReload=!1,this._fetchService=new _web_audio_FetchService__WEBPACK_IMPORTED_MODULE_6__.FetchService,this._noConsecutivePlay=!1,this._isLoadable=o.loadable||!1,this._fetchNextAudio=o.fetchNextAudio||null,this.mergeWith(o),window.getAudioPlayer().addPlaylist(this)}}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.TYPE_RADIO="radio",AudioPlaylist.TYPE_ARTICLE_TTS="article_tts",AudioPlaylist.TYPE_VKMIX=_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_7__.PLAYLIST_TYPE_VKMIX,AudioPlaylist.DEFAULT_PLAYLIST_ID=-1,AudioPlaylist.RADIO_PLAYLIST_ID=-110},89827:(e,t,i)=>{i.d(t,{WebPlayerAdapter:()=>d});var o=i(1779),s=i(39586),a=i(56401),l=i(82753),n=i(76849),r=i(93036);class d extends o.AudioStatsPlayerAdapter{getPausedBy(e){const{pausedByVideo:t,pausedByStories:i,pausedByAudio:o,pausedByQueue:s}=this.player;return t&&e<t||window.Videoview&&Videoview.isLayerShown()?"video":i&&e<i||window.cur&&cur.storyLayer?"stories":o&&e<o?"audio":s&&e<s?"queue":null}getState(){let e=super.getState();const t=this.getAudioId();if(t){const e=(0,l.geByClass)("_audio_row_"+t+" audio_row__current",(0,l.ge)("page_layout"));if(e&&e.length)return o.FULL_SCREEN_STATE}return e}getAudio(){return(0,n.audioTupleToAudioObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[a.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(0,r.unLogF)(this.player.getVolume()))}getAudioId(){const e=this.player.getCurrentAudio();if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){const e=this.player.getCurrentAudio();if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){const e=this.player._prevAudio;if(e)return e[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[a.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){const e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){const e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){const e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){const e=this.player.getPlaylistQueue();if(e)return e.shuffled}isRealPlaylist(){const e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){const e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){const e=this.player.getCurrentAudio();return a.AudioUtils.isPodcast(e)}isExternalStream(){const e=this.player.getCurrentAudio();return a.AudioUtils.isExternalStream(e)}isRadio(){const e=this.player.getCurrentAudio();return a.AudioUtils.isRadio(e)}isMarusiaTrack(){const e=this.player.getCurrentAudio();return a.AudioUtils.isMarusiaTrack(e)}isLastTrack(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();if(!e)return!1;if(e&&!t)return!0;return t.indexOfAudio(e)+1===t.getAudiosCount()}getTrackPosition(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return e?e&&!t?0:t.indexOfAudio(e):null}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){let t=e&&e.hash;const i=(0,s.extend)({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",i,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}getPlaylistQueue(){this.player.getPlaylistQueue()}}},38523:(e,t,i)=>{i.d(t,{followCurator:()=>d});var o=i(1959),s=i(56401),a=i(3895),l=i(59427),n=i(49957),r=i(92450);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,n.getAudioPlayer)().notify(r.events.CURATOR_FOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,(0,a.getLang)("audio_following_artist_button")),i.classList.add("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),s.AudioUtils.unfollowCurator(e,t,i)}}})}},15674:(e,t,i)=>{i.d(t,{unfollowCurator:()=>d});var o=i(1959),s=i(56401),a=i(3895),l=i(59427),n=i(49957),r=i(92450);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,n.getAudioPlayer)().notify(r.events.CURATOR_UNFOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,(0,a.getLang)("audio_follow_artist_button")),i.classList.remove("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),s.AudioUtils.followCurator(e,t,i)}}})}},15113:(e,t,i)=>{i.d(t,{addToGroupBox:()=>n});var o=i(82753),s=i(3895),a=i(44734),l=i(23434);function n(e,t,i){const n=e+"_"+t,r=(0,a.showBox)("al_audio.php",{act:"add_to_groups_box",playlist_id:n,access_hash:i}).setButtons((0,s.getLang)("Save"),(()=>{let e=[];for(let t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&((0,o.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:(0,o.ge)("add_playlist_to_group_hash").value,playlist_id:n},{onDone(e){r.hide(),(0,l.showDoneBox)(e)},onFail(e){return(0,o.ge)("add_playlist_to_group_fail").innerHTML=e,!0}}))}))}},60139:(e,t,i)=>{i.d(t,{removeFromGroup:()=>r});var o=i(82753),s=i(3895),a=i(44734),l=i(23434),n=i(50722);function r(e,t,i,r=null){const d=e+"_"+t;let _=null;const u=cur.audioPage&&cur.audioPage._ownerId;if(n.Ranges.isGroupId(u))_=-u;else{const e=cur.group_id;n.Ranges.isGroupId(-e)&&(_=e)}if(_){let e=(0,a.showBox)("al_audio.php",{act:"delete_from_group_box",playlist_id:d,group_id:_}).setButtons((0,s.getLang)("global_yes"),(()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:_,hash:i,playlist_id:d},{onDone(t){if(e.hide(),(0,l.showDoneBox)(t),r){const e=(0,o.gpeByClass)("audio_pl_snippet2",r);e&&e.classList.remove("audio_pl__can_remove_from_club")}},onFail(t){return e.hide(),(0,l.showDoneBox)(t),!0}})}),(0,s.getLang)("global_cancel"),(()=>e.hide())).show()}}},62050:(e,t,i)=>{i.d(t,{addToPlaylistsBoxInit:()=>c});var o=i(82753),s=i(96041),a=i(39586),l=i(23434),n=i(1959),r=i(3895),d=i(20640),_=i(97460),u=i(13744);function c(e,t,i,h,p){if("undefined"==typeof AutoList)return window.stManager.add(window.jsc("web/auto_list.js"),(()=>{c(e,t,i,h,p)}));let A=(0,l.curBox)(),g=(0,o.geByClass1)("_audio_atp_content",A.bodyNode),y=(0,o.geByClass1)("_audio_atp_list",A.bodyNode),P=(0,o.ge)("audio_atp_search"),E=(0,o.geByClass1)("_audio_atp_empty"),f=(0,o.getSize)(g)[1];(0,o.setStyle)(y,{height:f-(0,o.getSize)(P)[1]});let w,m="";function I(){w&&w.destroy(),y.innerHTML="";let e=[];e=m?h.filter((e=>e[2].toLowerCase().indexOf(m)>=0)):h,(0,o.toggle)(y,0!=e.length),(0,o.toggle)(E,0==e.length),w=new AutoList(y,{onNeedRows:(t,i)=>{let o=[],s=i,a=Math.min(e.length,i+30);for(let t=s;t<a;t++){let i=e[t];if(i){let e=i[4]?"ape_selected":"";let t=`<div class="ape_check">\n              <div class="ape_check--unchecked">${(0,_.getIcon24CheckCircleOff)().icon}</div>\n              <div class="ape_check--checked">${(0,u.getIcon24CheckCircleOn)().icon}</div>\n            </div>`,s=`<div class="ape_pl_item _ape_pl_item ${e}" data-id="${i[1]}">${t}<div class="ape_pl_item_inner"><span class="ape_pl_title">${i[2]}</span> <span class="ape_pl_size">${i[3]}</span></div></div>`;o.push(s)}}t(o)}})}I(),cur.addToPlaylistSearch=(0,d.debounce)((function(e){m=(0,a.trim)(e).toLowerCase(),I()}),200);let C={},v={};(0,s.addEvent)(y,"click",(e=>{let t=(0,o.domClosest)("_ape_pl_item",e.target),i=(0,o.domData)(t,"id");(0,o.toggleClass)(t,"ape_selected")?(v[i]=!0,delete C[i]):(C[i]=!0,delete v[i])})),A.removeButtons(),A.addButton((0,r.getLang)("global_save"),(o=>{let s=Object.keys(v),a=Object.keys(C);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:s.join(","),remove_pl_ids:a.join(","),owner_id:e,audio_owner_id:t,audio_id:i,hash:p},{showProgress:()=>(0,n.lockButton)(o),hideProgress:()=>(0,n.unlockButton)(o),onDone:()=>{A.hide()},onFail:()=>(A.hide(),!0)})}),"ok",!0),A.addButton((0,r.getLang)("global_cancel"),A.hide.bind(this),"no",!0)}},61863:(e,t,i)=>{i.d(t,{claimPlaylist:()=>s});var o=i(23434);function s(e,t,i){const s=nav.objLoc.claim;if(!s)return;const a={act:i?"a_unclaim_playlist":"a_claim_playlist",claim:s,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",a,{onDone:e=>{(0,o.showDoneBox)(e)}})}},99110:(e,t,i)=>{i.d(t,{copyPlaylistLink:()=>r});var o=i(38764),s=i(3895),a=i(57458),l=i(23434),n=i(84415);function r(e,t,i){(0,a.statlogsValueEvent)("audio_copy_link",vk.id),(0,o.copyToClipboard)((0,n.getPlaylistUrl)(e,t,i,!0)),(0,l.showDoneBox)((0,s.getLang)("audio_playlist_link_copied"))}},34116:(e,t,i)=>{function o(e,t,i,o){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(s){s.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=s.audio_playlist_cover_upload_options),s.editorial_playlists_params&&(cur.editorialPlaylistsParams=s.editorial_playlists_params),AudioPage.editPlaylist(e,t,i,o)},onFail:()=>!0})}))}i.d(t,{editPlaylist:()=>o})},87483:(e,t,i)=>{i.d(t,{followPlaylist:()=>c});var o=i(82753),s=i(49957),a=i(3895),l=i(34892),n=i(23434),r=i(39586),d=i(44734),_=i(92450);let u=[];function c(e,t,i,c,h=!1,p=""){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;let A=(0,s.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,i);function g(s){const a=(0,o.domData)(e,"text-followed"),l=(0,o.domData)(e,"text-follow"),n=s?a:l;(0,o.domData)(e,"tooltip-text",n);((0,o.geByClass1)("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=n,A.setFollowed(s);let d=A.getAddClasses()||"";d=d.replace("audio_pl__followed",""),s&&(d+=" audio_pl__followed"),A.mergeWith({addClasses:d}),(0,r.each)((0,o.geByClass)(`_audio_pl_${t}_${i}`),((t,i)=>{(0,o.toggleClass)(i,"audio_pl__followed",s);const a=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];a&&(a.innerHTML=e.innerHTML)}))}function y(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){let e=null;u=u.filter((o=>{const s=o.playlistId===i&&o.playlistOwnerId===t;return s&&(e=o.pl),!s})),e&&cur.audioPage._data.playlists.unshift(e)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((e=>{const o=e.id===i&&e.owner_id===t;return o&&u.push({playlistId:i,playlistOwnerId:t,pl:e}),!o}));cur.audioPage.updatePlaylistsCounter(vk.id)}}let P=(0,o.gpeByClass)("_audio_pl",e),E=(0,o.toggleClass)(P,"audio_pl__followed");g(E),y(E),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:i,hash:c,showcase:h,block_id:p},{onDone(e){(0,l.isObject)(e)&&E&&(0,s.getAudioPlayer)().notify(_.events.MUSIC_PLAYLISTS_ADD,e)},onFail(e){return new d.MessageBox({title:(0,a.getLang)("global_error")}).content(e).setButtons((0,a.getLang)("audio_ok"),(function(){(0,n.curBox)().hide()})).show(),g(!1),y(!1),!0}})}},72236:(e,t,i)=>{i.d(t,{getContextPlaylist:()=>n});var o=i(82753),s=i(56401),a=i(49957),l=i(39586);function n(e,t){let i=(0,a.getAudioPlayer)(),n=s.AudioUtils.getAudioFromEl(e,!0);if(!n)return{};function r(e){return[].slice.call(e)}let d=null,_=[],u=(0,o.domData)(e,"new-post"),c=!1,h=null,p=AudioPlaylist.TYPE_TEMP,A=vk.id,g=null,y={},P=window.AudioPage&&currentAudioPage(e);if((0,o.traverseParent)(e,(e=>c=(0,o.domData)(e,"audio-context"))),c=n.context||c,c=c||("audio"==cur.module?cur.submodule:cur.module),t||"autoplay"===c)return{context:c};let[E,f]=s.AudioUtils.contextSplit(c),w=(0,o.gpeByClass)("_audio_pl",e),m=!1;if(w){const e=(0,o.domData)(w,"playlist-id");h=i.getPlaylistByBlockId(e),h||(h=i.getPlaylist(...AudioPlaylist.splitId(e||"")));const t=(0,o.domData)(w,"no-consecutive-play");t&&h.mergeWith({noConsecutivePlay:t});let s=(0,o.domData)(w,"title")||"";s&&h.mergeWith({title:(0,l.clean)(s)});let a=(0,o.domData)(w,"access-hash")||"";a&&h.mergeWith({accessHash:a})}else if(P&&P.getPageCurrentPlaylist())h=P.getPageCurrentPlaylist();else if("module"==E){let e=f;h=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),_=[d]}else if(0===n.context.indexOf("admin"))h=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,n.ownerId,0,n.accessKey),h.getAudiosCount()||h.setForceReload(!0);else if(0===n.context.indexOf("im"))d=(0,o.gpeByClass)("_im_peer_history",e),d=d||(0,o.gpeByClass)("_fc_tab_log_msgs",e),g="im"+(cur.peer||"");else if(0===n.context.indexOf("board"))m=!0,g=n.context,_=r((0,o.geByClass)("_wall_audio_rows",d));else if(0===n.context.indexOf("widget"))m=!0,g=n.context;else if(0===n.context.indexOf("wiki"))m=!0,g="wiki";else if(0===n.context.indexOf("post")){p=AudioPlaylist.TYPE_WALL,g=n.context,m=!0;let e=n.context.replace("post","").split("_");A=e[0],y={postId:e[1]}}else if(0===n.context.indexOf("choose"))g=n.context;else if("feed"==u||0===n.context.indexOf("feed")||0===n.context.indexOf("feedsearch"))g="feed",m=!0,_=r((0,o.geByClass)("wall_text",d));else if("group_wall"==E||"user_wall"==E||0===n.context.indexOf("reply")||"wall"==u){p=AudioPlaylist.TYPE_WALL,A=cur.oid;let t=(f||"").split("_")[1],i=cur.wallQuery||"",s=(0,o.ge)("wall_search"),a=(0,l.inArray)(cur.wallType,["own","full_own"])?"own":"all";g=hashCode(a+"_"+i),m=!0,"wall"==cur.module&&(0,o.val)(s)&&(i=(0,o.val)(s)),t&&(y={postId:t,wallQuery:i,wallType:a}),0===n.context.indexOf("reply")&&(_=r([(0,o.gpeByClass)("_replies_list",e)]),g="reply"+g,m=!0);const u=(0,o.gpeByClass)("wide_column",e);if(u){const e=(0,o.geByClass)("wall_text",u);_=Array.isArray(e)&&e.length>0?_.concat(e):_.concat(r([d]))}else _=_.concat(r([d]))}else"article"==E&&(h=cur.articlePlaylist);return d||(d=(0,o.domPN)(e)),_=_.filter((function(e){return!!e})),_&&0!=_.length||(_=[d]),h=h||i.getPlaylist(p,A,g),"function"==typeof h.setIsFakeId&&h.setIsFakeId(m),h=h.getAudiosCount()?h:s.AudioUtils.initDomPlaylist(h,_),h.mergeWith(y||{}),-1==h.indexOfAudio(n)&&(h=s.AudioUtils.initDomPlaylist(h,[(0,o.domPN)(e)])),0===n.context.indexOf("im")&&h.setContext(`im:${cur.peer||""}`),{playlist:h,context:c}}},69951:(e,t,i)=>{function o(){return window.playlistAddRestoreInfo||(window.playlistAddRestoreInfo={}),window.playlistAddRestoreInfo}i.d(t,{getPlaylistAddRestoreInfo:()=>o})},33993:(e,t,i)=>{i.d(t,{hidePlaylistFromRecoms:()=>l});var o=i(82885),s=i(3895),a=i(23434);function l(e,t,i){ajax.post("al_audio.php?act=hide_playlist_from_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,a.showDoneBox)((0,s.getLang)("audio_playlist_recoms_was_hidden"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,s.getLang)("audio_playlist_recoms_show"),o.setAttribute("onclick","AudioUtils.showPlaylistInRecoms("+e+", "+t+", '"+i+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||(0,s.getLang)("global_unknown_error"))}})}},37450:(e,t,i)=>{i.d(t,{initDomPlaylist:()=>a});var o=i(39586),s=i(49343);function a(e,t){let i=[];return(0,o.each)(t,(function(e,t){t&&[...t.querySelectorAll("._audio_row")].forEach((e=>{i.push((0,s.getAudioFromEl)(e))}))})),e.pushAudio(i),e}},4772:(e,t,i)=>{i.d(t,{initRowPlaylistsChooser:()=>s});var o=i(56401);function s(e,t,i,s){let a,l=o.AudioUtils.audioTupleToAudioObject(e);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,o.AudioUtils.playlistsByAudioDataCache=o.AudioUtils.playlistsByAudioDataCache||{};let n=o.AudioUtils.playlistsByAudioDataCache,r=a+"_"+l.ownerId+"_"+l.id;n[r]?o.AudioUtils._showPlaylistsChooser(i,t,n[r],a,l,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:l.ownerId,audio_id:l.id},{onDone:(d,_,u)=>{let c=n[r]={playlists:d,morePlaylists:_,newPlaylistHash:u};o.AudioUtils._showPlaylistsChooser(i,t,c,a,l,e,s)},onFail:()=>!0})}},75419:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loadAllPlaylistAudios:()=>loadAllPlaylistAudios});var _web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39586),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49957);const AUDIO_LOAD_CHUNK_SIZE=1e3;let chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount;function loadAllPlaylistAudios(e,t,i=!1){if(e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===i,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,(()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))}))}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);let e=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(chunks,(function(t,i){i&&(e=e.concat(i))}));if((0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().getPlaylists().forEach((t=>{t.getId()===playlist.getId()&&(t._list=e)})),(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,{hasMore:!1}),onDone){onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}}function loadAllChunks(e,t){t=t||0;let i=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));if(isAttach&&t&&totalCount>preloadedCount&&i===t&&i++,i-t<=0)e();else{const o=new CallHub(e,i-t);for(let e=t;e<i;e++)loadChunk(e,(()=>{o.done()}))}}function loadChunk(chunkIndex,callback){const isPreload=isAttach&&!chunkIndex?1:0;let offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset:offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.intval)(nav.objLoc.claim),ref:playlist.getRef()},{onDone:function(data,tpl,langs,templatesScript){if(0===chunkIndex){if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},66894:(e,t,i)=>{i.d(t,{onAudioAddedToPlaylist:()=>l});var o=i(82753),s=i(49957),a=i(39586);function l(e,t,i,l){(0,s.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).pushAudio(l,0),(0,a.each)((0,o.geByClass)(`_audio_pl_${e}_${t}`),((e,t)=>{(0,o.domReplaceEl)(t,(0,o.se)(i))}))}},70526:(e,t,i)=>{function o(e,t){let i=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(i?":"+i:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})}i.d(t,{onPlaylistChoose:()=>o})},46880:(e,t,i)=>{i.d(t,{showAudioPlaylist:()=>p});var o=i(82753),s=i(56401),a=i(7659),l=i(49957),n=i(3895),r=i(23434),d=i(39586),_=i(96041),u=i(44734),c=i(4723),h=i(84415);function p(e,t,i,p,A,g){if(cur.apLayer)return(0,_.cancelEvent)(A);if(vk.widget)return!0;if(A&&(A.metaKey&&a.browser.mac||A.ctrlKey))return;let y=null;return window.Photoview&&window.cur&&cur.pvShown&&(y=(0,d.clone)(nav.objLoc),Photoview.hide(!0)),(0,r.boxRefreshCoords)(boxLoader),(0,o.show)(boxLoader),(0,o.show)(boxLayerWrap),window.stManager.add([window.jsc("web/auto_list.js"),"audio.css"],(function(){const a=(0,l.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i);let A,P;function E(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,A&&(0,_.removeEvent)(window.audioPlaylistLayerWrap,"click",A),P&&(0,_.removeEvent)(document.body,"keydown",P),delete cur.apLayer,delete cur.apLayerPlaylistId,(0,o.removeClass)(layerBG,"ap_layer_bg_dark"),y?nav.change(y):nav.change({z:!1}),layerQueue.pop()}a.setContext(p),a.setForceReload(!0),a.setFromId(cur.oid),a.loadAll((function(a,f){if((0,o.hide)(boxLoader),(0,o.hide)(boxLayerWrap),f){let e=(0,n.getLang)("audio_error_deleted_playlist_box").split("/");return new u.MessageBox({title:e[0]}).content(e[1]).setButtons((0,n.getLang)("global_close"),(function(){(0,r.curBox)().hide(),y&&nav.change(y)})).show(),void nav.setLoc((0,d.extend)(nav.objLoc,{z:!1}))}let w=(0,d.extend)(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(i?"/"+i:"")});nav.setLoc(w),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=(0,o.se)('<div class="ap_layer_wrap"></div>'),document.body.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";const m=a&&a.getAudiosList?a.getAudiosList().length:0,I=a.isBlocked&&a.isBlocked();let C=(0,h.getPlaylistUrl)(a.getOwnerId(),a.getPlaylistId(),a.getAccessHash()),v=(0,d.getTemplate)("audio_playlist_snippet",{title:a.getTitle(),subTitle:a.getSubtitle(),description:a.getDescription(),coverStyle:a.getCoverUrl()?"background-image:url('"+a.getCoverUrl()+"'); background-size: cover;":"",authorLine:a.getAuthorLine(),infoLine1:a.getInfoLine1(),infoLine2:a.getInfoLine2(),id:a.getPlaylistId(),ownerId:a.getOwnerId(),href:C,addCls:a.getAddClasses(),followHash:a.getFollowHash(),accessHash:a.getAccessHash(),editHash:a.getEditHash(),deleteHash:a.getDeleteHash(),replaceHash:a.getReplaceHash(),gridCovers:a.getGridCovers(),type:a.getType(),context:p,followButtonText:a.isFollowed()?(0,n.getLang)("audio_playlist_btn_added"):(0,n.getLang)("audio_playlist_btn_add")});if(cur.apLayer=(0,o.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${v}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),I){(0,o.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=(0,d.getTemplate)("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),(0,_.addEvent)(window.audioPlaylistLayerWrap,"click",A=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=(0,o.geByClass1)("_ap_layer__close",cur.apLayer)||layers&&layers.fullhide&&layers.fullhide()}),(0,_.addEvent)(document.body,"keydown",P=function(e){if(27==e.keyCode)return layers&&layers.fullhide&&layers.fullhide(),(0,_.cancelEvent)(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),(0,o.addClass)(layerBG,"ap_layer_bg_dark");const T=(0,o.geByClass1)("_audio_pl_snippet__list",cur.apLayer),b=s.AudioUtils.getAlbumParts(a);let D=0;m&&!I&&(cur.apLayerAutoList=new c.default(T,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){let i=[],o=a.getAudiosList();for(let e=t-=D;e<t+30;e++){const t=o[e];if(!t)break;if(b&&b.length&&b[0].offset===e){const e=b.shift();D++,i.push(s.AudioUtils.drawAlbumPartRow(e.number))}i.push(s.AudioUtils.drawAudio(t))}e(i)}}));(0,r.boxRefreshCoords)(cur.apLayer),(0,l.getAudioPlayer)().updateCurrentPlaying(),layers.fullhide=E,cur.apLayerPlaylistId=[e,t],g&&g()}))})),!1}},78410:(e,t,i)=>{i.d(t,{showPlaylistInRecoms:()=>l});var o=i(82885),s=i(3895),a=i(23434);function l(e,t,i){ajax.post("al_audio.php?act=show_playlist_in_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,a.showDoneBox)((0,s.getLang)("audio_playlist_recoms_was_showed"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,s.getLang)("audio_playlist_recoms_hide"),o.setAttribute("onclick","AudioUtils.hidePlaylistFromRecoms("+e+", "+t+", '"+i+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||(0,s.getLang)("global_unknown_error"))}})}},77570:(e,t,i)=>{i.d(t,{showPlaylistsChooser:()=>u});var o=i(82753),s=i(56401),a=i(3895),l=i(44734),n=i(39586),r=i(90600),d=i(80971),_=i(88446);function u(e,t,i,u,c,h,p){let A=i.playlists,g=i.newPlaylistHash,y=i.morePlaylists;s.AudioUtils.copiedToPlaylistAudios=s.AudioUtils.copiedToPlaylistAudios||{},s.AudioUtils.copiedToPlaylistAudiosHashes=s.AudioUtils.copiedToPlaylistAudiosHashes||{};let P=t,E=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,(0,a.getLang)("audio_add_to_new_pl"),"audio_row__action_playlist"]));if((0,o.domInsertAfter)(E,P),P=E,E.addEventListener("click",(()=>{s.AudioUtils.editPlaylist(u,!1,"edit",{addAudio:h,newPlaylistHash:g})})),(0,n.each)(A,((e,t)=>{let i=!0,a=t[0]+"_"+t[1]+"_"+c.fullId,l=s.AudioUtils.copiedToPlaylistAudios[a],u="audio_row__action_playlist";(t[3]||l)&&(i=!1,u+=" audio_row__more_playlist_added");let h=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],u]));(0,o.domInsertAfter)(h,P),P=h;let A=!1;h.addEventListener("click",(()=>{var e;if(A)return;A=!0;let l=c.ownerId,u=c.id,g=s.AudioUtils.copiedToPlaylistAudios[a];g&&(g=g.split("_"),l=g[0],u=g[1]),i&&(s.AudioUtils.copiedToPlaylistAudiosHashes[a]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:l,audio_id:u,do_add:(0,n.intval)(i)},{onDone:(e,o,l)=>{(0,d.onAdditionalEvent)(p,c,{type:i?r.TYPE_ADDED:r.TYPE_REMOVED,subtype:r.SUBTYPE_PLAYLIST}),s.AudioUtils.copiedToPlaylistAudios[a]=!!i&&l,t[4]=i?e:s.AudioUtils.copiedToPlaylistAudiosHashes[a],i=!i,A=!1},onFail:()=>!0}),(0,_.logSearchAudioClick)(_.SearchClickActionMap.ADD_TO_PLAYLIST,null==(e=c)?void 0:e.trackCode),(0,o.toggleClass)(h,"audio_row__more_playlist_added",i)}))})),y){let e=(0,o.se)((0,o.rs)(s.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,(0,a.getLang)("audio_row_show_all_playlists"),"audio_row__action_playlist"]));e.addEventListener("click",(()=>{(0,l.showBox)("al_audio.php?act=more_playlists_add",{owner_id:u,audio_owner_id:c.ownerId,audio_id:c.id},{params:{bodyStyle:"padding: 0px",width:560}})})),(0,o.domInsertAfter)(e,P),P=e}e.updatePosition()}},10950:(e,t,i)=>{i.d(t,{turnPlaylistDiscover:()=>s});var o=i(23434);function s(e,t){const i={act:"turn_playlist_discover",owner_id:e,playlist_id:t};ajax.post("al_audio.php",i,{onDone:e=>{(0,o.showDoneBox)(e)}})}},96564:(e,t,i)=>{i.d(t,{deleteEpisode:()=>s});var o=i(72278);function s(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.deleteEpisode(t.fullId,t.deleteHash)}))}},85010:(e,t,i)=>{i.d(t,{editEpisode:()=>s});var o=i(72278);function s(e,t){(0,o.isPodcast)(t)&&(cur.podcastEditData={audioId:t.fullId},window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.edit(t.fullId)})))}},97945:(e,t,i)=>{i.d(t,{faveEpisode:()=>l});var o=i(72278),s=i(87866),a=i(49957);function l(e,t){if(!e||!(0,o.isPodcast)(t))return;const i=(0,s.getAudioExtra)(t).faveHash;(0,a.bookmarkPodcast)(e.querySelector(".audio_row__action_fave"),t.fullId,i)}},69969:(e,t,i)=>{i.d(t,{isPrivatePodcast:()=>a});var o=i(72278),s=i(87866);function a(e){return!(!(0,o.isPodcast)(e)||!(0,s.getAudioExtra)(e).private)}},94132:(e,t,i)=>{i.d(t,{openEpisode:()=>l});var o=i(49957),s=i(76849),a=i(72278);function l(e,t){t=(0,s.audioTupleToAudioObject)(t),(0,a.isPodcast)(t)&&(0,o.showPodcast)(e,t.fullId,null,"audio")}},28021:(e,t,i)=>{i.r(t),i.d(t,{ACTION_HEARTBEAT:()=>n,ACTION_PAUSE:()=>a,ACTION_PLAY:()=>s,ACTION_SEEK:()=>l,ACTION_TIME_MARKER:()=>r,log:()=>d});var o=i(72278);const s="play",a="pause",l="seek",n="heartbeat",r="time_marker";function d(e,t){const i=t.audio;(0,o.isPodcast)(i)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.log(e,t)}))}},69956:(e,t,i)=>{i.d(t,{restoreEpisode:()=>s});var o=i(72278);function s(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.restoreEpisode(t.fullId,t.editHash)}))}},2377:(e,t,i)=>{function o(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)}i.d(t,{showRecoms:()=>o})},9947:(e,t,i)=>{i.d(t,{audioSearchPerformer:()=>s});var o=i(34892);function s(e,t,i){let s=!!window.AudioPage&&currentAudioPage(e),a=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){s&&a?(t=(0,o.unclean)(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:s.isLayer()})):nav.go(e,i)}),50)}},80971:(e,t,i)=>{i.d(t,{onAdditionalEvent:()=>_});var o=i(34788),s=i(90600),a=i(89827),l=i(49957),n=i(81483),r=i(72236),d=i(76849);function _(e,t,i={}){const _=new s.AudioStats(new a.WebPlayerAdapter((0,l.getAudioPlayer)())),u=t&&t.context||e&&(0,n.getContext)(e)||"",c=(0,l.getAudioPlayer)();let h,p=c.getCurrentAudio()?(0,d.audioTupleToAudioObject)(c.getCurrentAudio()):null;h=p&&t.fullId===p.fullId?c.getCurrentPlaylist():(0,r.getContextPlaylist)(e).playlist;const A=h?h.getFullId():"",g=(0,o._)({},t,{context:u,playlistId:A},i);_.sendCurrentAudioEvent({type:g.type,subtype:i.subtype||g.subtype||_.getPlaySubtype(),ownerId:g.ownerId,audioId:g.id,trackCode:g.trackCode,state:_.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:g.context,playlistId:g.playlistId})}},34265:(e,t,i)=>{i.d(t,{addAudioToOwner:()=>s});var o=i(96041);function s(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),(0,o.cancelEvent)(t)}},29398:(e,t,i)=>{i.d(t,{cancelReplacement:()=>s});var o=i(82753);function s(e,t,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),(0,o.re)(i)}},84549:(e,t,i)=>{i.d(t,{chooseAudioBox:()=>a});var o=i(82753),s=i(96041);function a(e,t,i){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,(0,o.removeClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.add;else{let i=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>i)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,(0,o.addClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return(0,s.cancelEvent)(i)}},59341:(e,t,i)=>{i.d(t,{claim:()=>l});var o=i(82753),s=i(30512),a=i(76849);function l(e,t,i){(0,o.addClass)(t,"audio_moder_claimed"),(0,s.onRowOver)(t,!1,!0),e=(0,a.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_claim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId})}},91268:(e,t,i)=>{i.d(t,{deleteAudio:()=>g});var o=i(11010),s=i(82753),a=i(49957),l=i(39586),n=i(1959),r=i(44734),d=i(3895),_=i(90600),u=i(80971),c=i(56401),h=i(53902),p=i(48041),A=i(44142);function g(e,t){const i=(0,p.partConfigEnabled)("add_audio_to_effector_web");if(i){const i=(0,A.ensureAudioPageService)();return i.setUserId(window.vk.id),void i.deleteAudioFromMyMusicLegacyFx({audioEl:e,audio:t})}function g(t){return(0,s.domData)(e,"in-progress",(0,l.intval)(t))}if(window.tooltips&&tooltips.hideAll(),(0,l.intval)((0,s.domData)(e,"in-progress")))return;g(!0);let y=!1;t.isClaimed&&(y=!0);let P=c.AudioUtils.getAddRestoreInfo(),E=P[t.fullId];E&&E.deleteAll?(0,r.showFastBox)({title:(0,d.getLang)("audio_delete_all_title"),dark:1,onHide:()=>g(!1)},E.deleteConfirmMsg||"",(0,d.getLang)("global_delete"),(function(e){let t=(0,l.extend)({act:"delete_all"},E.deleteAll);ajax.post("al_audio.php",t,{showProgress:()=>(0,n.lockButton)(e),onDone:function(){let e=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,E.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);(0,a.getAudioPlayer)().deletePlaylist(e),nav.reload()},onFail:()=>!0})}),(0,d.getLang)("global_cancel")):(y?(0,s.re)(e):(0,s.addClass)(e,"audio_row__deleted"),ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:(0,o._)((function*(o,s){const a=(0,h.ensureAudioDislikesInMyMusicWebService)();(0,u.onAdditionalEvent)(e,t,{type:_.TYPE_REMOVED}),y||g(!1),P[t.fullId]={state:"deleted",deleteAll:o,deleteConfirmMsg:s},i&&(yield a.deleteFromMyMusicFx({audio:t,audioEl:e,forceRemoveFromStoreParams:{oldIdentity:t,newIdentity:t}})),y&&c.AudioUtils.deleteDeletedAudios(),c.AudioUtils.onRowOver(e,!1,!0)})),onFail:()=>!0}),c.AudioUtils.onRowOver(e,!1,!0))}},35424:(e,t,i)=>{i.d(t,{deleteCurrentAudio:()=>a});var o=i(82753),s=i(49957);function a(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);const i=(0,s.getAudioPlayer)(),a=i.getPlaylistQueue();a&&(a.removeAudio(t.fullId),i.saveStateCurrentPlaylist()),(0,o.re)(e)}},46651:(e,t,i)=>{i.d(t,{deleteDeletedAudios:()=>r});var o=i(39586),s=i(49957),a=i(86135),l=i(48041),n=i(44142);function r(){if((0,l.partConfigEnabled)("add_audio_to_effector_web")){const e=(0,n.ensureAudioPageService)().$deletedFromMyMusicAudiosIdentitiesMap.getState();Object.keys(e).forEach((e=>{(0,s.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}else(0,o.each)((0,a.getAddRestoreInfo)(),((e,t)=>{"deleted"===t.state&&(0,s.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}},48849:(e,t,i)=>{i.d(t,{drawAudio:()=>h,getDurationMod:()=>c});var o=i(76849),s=i(56401),a=i(20143),l=i(39586),n=i(86812),r=i(59672);const d=600,_=3600,u=36e3;function c(e){return e<d?"s":e<_?"m":e<u?"l":"n"}function h(e,t){var i;let d=JSON.parse((0,l.getTemplate)("audio_bits_to_cls")),_=e[s.AudioUtils.AUDIO_ITEM_INDEX_FLAGS],u=[];for(let e=0;e<32;e++){let t=1<<e;_&t&&u.push(d[t])}const h=(0,o.audioTupleToAudioObject)(e),p=s.AudioUtils.isPodcast(e);p&&(u.push("audio_podcast"),s.AudioUtils.isPrivatePodcast(e)&&u.push("audio_podcast_private")),t&&u.push(t);const A=e[s.AudioUtils.AUDIO_ITEM_INDEX_COVER_URL],[g=""]=null==(i=A)?void 0:i.split(/(,(?!\d))/g).filter((e=>","!==e));let y,P=s.AudioUtils.getAudioPerformers(e),E=e[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION],f=(0,n.formatTime)(E),w=(0,l.clean)(JSON.stringify(e));try{const t=(0,l.getTemplate)("podcast_row",e);y=p&&t?t:(0,l.getTemplate)("audio_row",e)}catch(e){return""}let m="";return h.hasTrackPage&&(u.push("audio_has_track_page"),m=`/audio${h.trackPageId}`),(0,r.isRadio)(h)&&u.push("audio_row--radio"),y=y.replace(/%cls%/,(()=>u.join(" "))),y=y.replace(/%duration%/,(()=>f)),y=y.replace(/%serialized%/,(()=>w)),y=y.replace(/%cover_image%/,(()=>function(e,t){let i="";if(e)i=`<img class='audio_row__cover' alt='${t}' src='${e}' loading='lazy' decoding='async' width='40' height='40' />`;else{const{icon:e}=(0,a.getIcon24Song)();i=`<div class='audio_row__cover audio_row__without_cover'>${e}</div>`}return i}(g,h.title))),y=y.replace(/%performers%/,(()=>P)),y=y.replaceAll(/%track_url%/g,(()=>m)),y=y.replace(/%duration_mod%/,(()=>c(E))),y=y.replace(/%chart_info_position%/,(()=>{return(t=e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t})),y=y.replace(/%chart_info_state%/,(()=>function(e){let t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[s.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state))),y}},65046:(e,t,i)=>{i.d(t,{editAudio:()=>s});var o=i(44734);function s(e,t,i){(0,o.showBox)("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px;",hideButtons:1},dark:1})}},61776:(e,t,i)=>{i.d(t,{getActionIcon:()=>g});var o=i(80615),s=i(97307),a=i(16889),l=i(19802),n=i(64725),r=i(39651),d=i(57499),_=i(51783),u=i(94176),c=i(94292),h=i(21159),p=i(8567);const A={current_delete:(0,o.getIcon20Cancel)(),recoms_delete:(0,o.getIcon20Cancel)(),listened_delete:(0,o.getIcon20Cancel)(),delete:(0,o.getIcon20Cancel)(),restore_recoms:(0,s.getIcon20Add)(),more:(0,a.getIcon20More)(),edit:(0,l.getIcon20WriteOutline)(),recoms:(0,n.getIcon20Stars)(),lyrics:(0,r.getIcon20TextTtOutline)(),snippet:(0,d.getIcon20FlashOutline)()};function g(e){const t=A[e];let i="";if(t)i=y(t);else switch(e){case"add":i=y((0,_.getIcon20Check)())+y((0,s.getIcon20Add)());break;case"next":i=`<div class="audio_row__icon--horizontal">${y((0,u.getIcon20ListPlayOutline)())+y((0,c.getIcon20ListAddOutline)())}</div>`;break;case"fave":i=y((0,h.getIcon24FavoriteOutline)())+y((0,p.getIcon24Favorite)())}return i}function y(e){return`<div class="audio_row__icon audio_row__icon_${e.name}">${e.icon}</div>`}},86135:(e,t,i)=>{function o(){return window.audioAddRestoreInfo||(window.audioAddRestoreInfo={}),window.audioAddRestoreInfo}i.d(t,{getAddRestoreInfo:()=>o})},49343:(e,t,i)=>{i.d(t,{getAudioFromEl:()=>a});var o=i(82753),s=i(56401);function a(e,t){e=(0,o.domClosest)("_audio_row",e);let i=(0,o.data)(e,"audio")||JSON.parse((0,o.domData)(e,"audio"));if(!i)return null;if(t){i=s.AudioUtils.audioTupleToAudioObject(i),i.isDeleted=(0,o.hasClass)(e,"audio_row__deleted"),i.isCurrent=(0,o.hasClass)(e,s.AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=(0,o.hasClass)(e,s.AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!(0,o.gpeByClass)("_audio_section__current",e),i.isFromAutoplay=!!(0,o.gpeByClass)("Autoplay--container",e),i.isNumeric=!!(0,o.gpeByClass)("audio_numeric",e),i.isWithCovers=!!(0,o.gpeByClass)("audio_w_covers",e),i.withInlinePlayer=!i.isWithCovers&&!(0,o.gpeByClass)("audio_no_inline_player",e),i.isInSnippet=!!(0,o.gpeByClass)("_audio_pl_snippet__list",e),i.isInEditBox=!!(0,o.gpeByClass)("_audio_pl_edit_box",e),i.isInRecomsBlock=!!(0,o.gpeByClass)("_audio_recoms_blocks",e),i.isInFastChat=!!(0,o.gpeByClass)("fc_tab",e),i.isInAttach=!!(0,o.gpeByClass)("media_preview",e),i.isSetClaimed=(0,o.hasClass)(e,"audio_moder_claimed"),i.isPodcastListSnippet=(0,o.hasClass)(e,"podcast_list_snippet");const t=(0,o.gpeByClass)("_audio_pl",e);i.isCurrentAlbumSnippet=!!i.album&&!!t&&t.dataset.playlistId===`playlist_${i.album[0]}_${i.album[1]}`}return i}},50190:(e,t,i)=>{i.d(t,{onAudioChoose:()=>n});var o=i(39586),s=i(3895),a=i(82753),l=i(96041);function n(e,t,i,n){if((0,o.isUndefined)(t.selected)){let e=cur.attachCount&&cur.attachCount()||0;const o=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",o,n),(!cur.attachCount||cur.attachCount()>e)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,(0,a.addClass)((0,a.domPN)(t),"audio_selected");let e=(0,a.getSize)(t)[0];(0,a.setStyle)(t,"width",e),t.innerHTML=(0,s.getLang)("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,(0,a.removeClass)((0,a.domPN)(t),"audio_selected"),t.innerHTML=(0,s.getLang)("global_add_media");return(0,l.cancelEvent)(e)}},2907:(e,t,i)=>{i.d(t,{onRowLeave:()=>l});var o=i(82753),s=i(1033),a=i(48041);function l(e){if(!((0,a.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,a.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return void n(e);const t=s.AudioRowMoreTooltipController.ensure();t.isShown?t.events.once(s.AudioRowMoreTooltipControllerEventType.Closed,(()=>{var t,i;null==(i=window.tooltips)||null==(t=i.hideAll)||t.call(i,e),n(e)})):n(e)}function n(e){(0,o.data)(e,"leaved",!0);let t=(0,o.data)(e,"tt");if(t&&t.isShown())return;if(clearTimeout(window.audioRowHoverTO),!(0,o.data)(e,"actions"))return;let i=(0,o.geByClass1)("_audio_row__actions",e),s=(0,o.geByClass1)("_audio_row__duration",e);(0,o.re)(i),(0,o.setStyle)(s,"visibility","visible"),(0,o.data)(e,"actions",0)}},30512:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{onRowOver:()=>onRowOver});var _web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(82753),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(56401),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(49957),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3895),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(96041),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(39586),_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(61776),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(48041),_web_audio_components_AudioLongtap_showAudioLongtapModal__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(13412),_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(1033),_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(96183),_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(4801),_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(88446),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(48293),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5112),_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(44142);function onRowOver(audioEl,event,forceRedraw,audioLinkPathname,audioAccessKey){const longTapEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_longtap_web"),copyLinkEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_tooltip_copy_link_web"),showMoreTooltipRedesignEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled"),myMusicRefactoringEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("add_audio_to_effector_web");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_list_snippet")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_snippet__controls"))return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"leaved",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions")&&!forceRedraw)return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"no_extra"))return;clearTimeout(window.audioRowHoverTO);const ap=(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_2__.getAudioPlayer)();window.audioRowHoverTO=setTimeout((()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);let audio=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl),audioObject=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl,!0);showMoreTooltipRedesignEnabled&&unmountRowMoreTooltip();const playerUI=(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_2__.getAudioPlayerUI)();let actions=[],moreActions=[],context=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getContextPlaylist(audioEl,!0),[sectionContext,blockContext]=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.contextSplit(context),extra=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject);const copyAudioLink=()=>{var e;return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.COPY_LINK,null==(e=audio)?void 0:e.trackCode),audioLinkPathname?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLink.call(null,audioLinkPathname):_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLinkByIdentity.call(null,audioObject,audioAccessKey)};if(context=sectionContext,audioObject.isDeleted)if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{let e=!1;if(myMusicRefactoringEnabled){const t=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_13__.ensureAudioPageService)().$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState();e=audioObject.fullId in t}else{const t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();e=t[audioObject.fullId]&&t[audioObject.fullId].deleteAll}e&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{let actionsList=[!longTapEnabled&&"next","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actionsList=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isExternalStream(audioObject))actionsList=[];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=[longTapEnabled&&"snippet","recoms",!longTapEnabled&&"next","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)if("my_audios_block"===blockContext)actionsList=["recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else switch(context){case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),longTapEnabled&&actionsList.unshift("snippet");break;case"catalog":actionsList=[longTapEnabled&&"snippet","recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"album_page":actionsList=[longTapEnabled&&"snippet","recoms",!longTapEnabled&&"next","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=[longTapEnabled&&"snippet",playerUI.lyrics.enabled&&"lyrics","recoms","edit",!longTapEnabled&&"next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"my_audios_short":actionsList=[playerUI.lyrics.enabled&&"lyrics","recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"edit_playlist":actionsList=["add",!longTapEnabled&&"next","edit"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"apps_edit":actionsList=["apps_edit_delete"];break;case"clips":case"clip_effect_list":audioObject.isOriginalSound&&(actionsList=[]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),longTapEnabled&&actionsList.unshift("snippet")}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_5__.each)(extra.moder_actions,((i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])})),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter((e=>"open_album"!==e))),vk.id||(actionsList=actionsList.filter((e=>"open_album"===e)));const addDeleteAction=()=>{audioObject.isFromCurrentPlaylist?audioObject.isFromAutoplay||audioObject.isCurrent||actions.push(["current_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']):audioObject.canDelete&&!vk.widget&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"'])},currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget;actionsList.forEach((e=>{switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":let e=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(e=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=e&&actions.push(["add",(...e)=>{if(myMusicRefactoringEnabled){var t,i,o,s;const e=null==(i=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo())?void 0:i[null==(t=audioObject)?void 0:t.fullId];(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)("added"===(null==(o=e)?void 0:o.state)?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.ADD_TO_ME,null==(s=audioObject)?void 0:s.trackCode)}else{var a;const e=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__.ensureMyMusicService)().$identitiesMap.getState();(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)((0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in e?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.ADD_TO_ME,null==(a=audioObject)?void 0:a.trackCode)}return _web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio(...e)},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.replaceWithOriginal.bind(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils,audioEl,audioObject))},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":addDeleteAction();break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&actions.push(["fave",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"copy_link":copyLinkEnabled&&!audioObject.isClaimed&&moreActions.push(["copy_link",copyAudioLink,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_copy_audio_link")]);break;case"share":audioObject.isClaimed||moreActions.push(["share",(...e)=>{var t;return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.SHARE,null==(t=audioObject)?void 0:t.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.shareAudio(...e)},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",(...e)=>{var t;return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.OPEN_ALBUM,null==(t=audioObject)?void 0:t.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioAlbum(...e)},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_open_album")]);break;case"open_episode":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.openEpisode,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_podcast_open_episode")]);break;case"lyrics":audioObject.hasLyrics&&actions.push(["lyrics",()=>{playerUI.lyrics.open({audio:audio,playlist:context.playlist,context:audioObject.context||context.context})},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"snippet":actions.push(["snippet",()=>{var e;return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.SHOW_SNIPPET,null==(e=audioObject)?void 0:e.trackCode),(0,_web_audio_components_AudioLongtap_showAudioLongtapModal__WEBPACK_IMPORTED_MODULE_8__.showAudioLongtapModal)(audioObject,audioEl)},"",'onmouseover="audioShowActionTooltip(this)"']),moreActions.push(["next",(...e)=>{var t;return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_12__.SearchClickActionMap.LISTEN_NEXT,null==(t=audioObject)?void 0:t.trackCode),ap.setNext.apply(ap,e)},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_3__.getLang)("audio_set_next_audio")])}})),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__actions audio_row__actions"></div>');if(actions.forEach((t=>{let i=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getRowActionName(t[0],audioObject,audioEl),o=(0,_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_6__.getActionIcon)(t[0]),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<button\naria-label="${i}"\ndata-action="${t[0]}"\ndata-testid="audio_row_action_${t[0]}"\nclass="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${t[4]?" "+t[4]:""}" ${t[3]||""}>\n${t[2]||o}\n</button>`);t[1]&&s.addEventListener("click",(e=>(t[1]&&t[1].call(window,audioEl,audioObject),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(e)))),e.appendChild(s)})),myMusicRefactoringEnabled){const e=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_13__.ensureAudioPageService)().$myMusicIdentitiesMap.getState(),t=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in e;let i=!1;audioEl&&(audioEl.closest(".CatalogBlock__my_audios_block")||audioEl.closest(".CatalogBlock__my_audios"))&&(i=!0),t&&!i&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}else{const e=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAddRestoreInfo();let t=e[audioObject.fullId];t&&e[t.addedFullId]&&(t=null),t&&"added"===t.state&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added")}let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__info",audioEl),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__duration",audioEl),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__actions",audioEl);if(!t)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"visibility","hidden"),t.appendChild(e);let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__action_more",e);moreActions.length&&s&&(showMoreTooltipRedesignEnabled?mountRowMoreTooltip(s,{audioEl:audioEl,audioTuple:audio,audio:audioObject,audioLinkPathname:audioLinkPathname,audioAccessKey:audioAccessKey}):setMoreAction(audioEl,audio,audioObject,moreActions,s)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions",1)}audioObject.showInfo&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioInfo(audioEl,audioObject,!1)}),forceRedraw?0:10)}function setMoreAction(e,t,i,o,s){const a=_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_11__.AudioPageProxy.ensure().emitter,l=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_tooltip_copy_link_web"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("im-page_classic",e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history_w",e),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_chat_body_abs",e),u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("wk_history_audio_content",e),h=e.closest(".CatalogBlock"),p={};d?(p.getWrapEl=()=>n?null:_,p.appendTo=d):c?p.appendTo=c:h?p.appendTo=h:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("post",e)?p.appendTo=document.body:p.appendToParent=!0;const A=new ElementTooltip(s,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_5__.extend)({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:u,bottomGap:n&&r?parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(r,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"leaved")&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.onRowLeave(e)}},p));o.forEach((o=>{var s;const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,o));switch(null==(s=n)||s.setAttribute("data-testid",`audio_row_more_action_${o[0]}`),o[0]){case"add_to_playlist":let s,r;n.addEventListener("mouseenter",s=()=>{clearTimeout(r),r=setTimeout((()=>{n.removeEventListener("mouseenter",s),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,n,A,e)}),150)}),n.addEventListener("click",(()=>{r||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,n,A,e)})),n.addEventListener("mouseleave",(()=>{clearTimeout(r)}));break;case"copy_link":if(!l)break;n.addEventListener("click",(t=>(o[1].call(window,e,i).then((()=>{a.emit(_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_11__.AudioPageEventType.AudioLinkCopied)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t))));break;default:n.addEventListener("click",(t=>(o[1].call(window,e,i),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t))))}u.appendChild(n)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(s,"click",(e=>{A.isShown()||A.show(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"tt",A)}function mountRowMoreTooltip(e,t){var i,o;if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const s=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_9__.AudioRowMoreTooltipController.ensure(),a=(0,_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_9__.ensureAudioRowMoreTooltipService)(),l=null==(o=e)||null==(i=o.closest)?void 0:i.call(o,`.${_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_10__.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);e.addEventListener("mouseover",(()=>{var i,o,n;Boolean(null==(i=t)?void 0:i.audioEl)&&(null==(n=window.tooltips)||null==(o=n.hideAll)||o.call(n,t.audioEl));a.init(t),s.isShown||s.mount(e,l||void 0)})),e.addEventListener("click",(e=>{var t,i;null==(t=e)||t.preventDefault(),null==(i=e)||i.stopPropagation()}))}function unmountRowMoreTooltip(){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_7__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_9__.AudioRowMoreTooltipController.ensure().unmount()}},84648:(e,t,i)=>{i.d(t,{replaceWithOriginal:()=>r});var o=i(82753),s=i(49957),a=i(92414),l=i(48849),n=i(76849);function r(e,t,i){(t=t||(0,s.getAudioPlayer)().getCurrentAudio())&&(t=(0,n.audioTupleToAudioObject)(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(s){let n=JSON.parse(t.extra).claim.original;n[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=s,n[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;let r=(0,o.se)((0,l.drawAudio)(n));e.parentElement.insertBefore(r,e),e.parentElement.removeChild(e),i&&i()},onFail:()=>(i(),!0)}))}},54078:(e,t,i)=>{i.d(t,{shareAudio:()=>_});var o=i(90600),s=i(49957),a=i(44734),l=i(23434),n=i(80971),r=i(72278),d=i(76849);function _(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(!(t=t||(0,s.getAudioPlayer)().getCurrentAudio()))return;t=(0,d.audioTupleToAudioObject)(t);const i=(0,r.isPodcast)(t)?"podcast":"audio";return(0,n.onAdditionalEvent)(e,t,{type:o.TYPE_SHARE_AUDIO}),!(0,a.showBox)("like.php",{act:"publish_box",object:i+t.fullId,list:t.actionHash,to:"mail"},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,l.showDoneBox)(e),!0},params:{shareButtonElement:e}})}},78203:(e,t,i)=>{i.d(t,{showAudioRestriction:()=>E});var o=i(76849),s=i(3895),a=i(23434),l=i(39586),n=i(48849),r=i(92414),d=i(82753),_=i(99602),u=i(49957),c=i(44734),h=i(74752),p=i(34892),A=i(59427),g=i(84499),y=i(23688);function P(e){const t=A.FlatButton.render({children:(0,s.getLang)("global_close"),appearance:A.FlatButtonAppearance.PRIMARY,size:A.FlatButtonSize.M,restAttrs:{onclick:"curBox().hide()"}});(0,c.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()" aria-label="${(0,s.getLang)("global_close")}">\n      ${(0,g.getIcon24Cancel)().icon}\n    </button>\n    <div class="audio_restriction_box__icon">${(0,y.getIcon56PensiveFace)().icon}</div>\n    <div class="audio_restriction_box__title">${(0,s.getLang)("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n      ${t}\n    </div>\n  `)}function E(e,t={}){if(!e)return!1;if((e=(0,o.audioTupleToAudioObject)(e)).restrictionStatus){if(e.actionHash){(0,h.statlogsValueEvent)("audio_restriction_popup","show",e.restrictionStatus);const i=(0,c.showBox)("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){let i=(0,a.curBox)();(0,p.isFunction)(t.onShow)&&t.onShow(),i&&i.once("click:ok",(()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","click",e.restrictionStatus)}))},onHide:i=>{(0,p.isFunction)(t.onHide)&&t.onHide(),i||(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,i)=>{if(i&&i.play){t.hide();const s=function(e){const t=(0,d.geByClass)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;const i=(0,_.parseJSON)((0,d.domData)(t[0],"audio"));if(!i)return!1;const o=(0,_.parseJSON)(i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);o&&delete o.claim,i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(o);const s=(0,u.getAudioPlayer)().getCurrentPlaylist(),a=(0,d.se)((0,n.drawAudio)(i,"no_extra"));if(s){const e=i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],t=s.getAudio(e);t&&(t[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],t[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],t[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=i[r.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return(0,l.each)(t,((e,t)=>{const o=e>0?(0,d.se)((0,n.drawAudio)(i,"no_extra")):a;t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t)})),a}(i.audio?(0,o.audioTupleToAudioObject)(i.audio):e),a=(0,u.getAudioPlayer)();s&&a.toggleAudio(s,{target:s})}},onFail:()=>(i&&i.hide(),P(e),!0)})}else P(e);return!0}return!1}},30399:(e,t,i)=>{i.d(t,{toggleAddAudioLegacy:()=>I});var o=i(82753),s=i(56401),a=i(49957),l=i(23434),n=i(39586),r=i(92450),d=i(90600),_=i(80971),u=i(72236),c=i(34892),h=i(13870),p=i(3895),A=i(55878),g=i(96041),y=i(44734),P=i(48041),E=i(48293),f=i(5112),w=i(88535),m=i(82161);function I(e,t,i=(()=>{}),I=""){const C=window.vk.id;if(!function(e){return(0,w.isNumber)(e)&&m.Ranges.isUserId(e)}(C))return void console.error("The user is not authorized, it is impossible to add or delete audio");if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function v(t){return(0,o.domData)(e,"in-progress",(0,n.intval)(t))}if((0,n.intval)((0,o.domData)(e,"in-progress")))return;if(v(!0),!(t=t||s.AudioUtils.getAudioFromEl(e,!0)))return;const T=window.AudioPage&&currentAudioPage(e),b=(0,E.ensureMyMusicService)(),D=T&&T.getOwnerId()<0&&T.canAddToGroup()&&T.getOwnerId()!==t.ownerId;let O=D?-T.getOwnerId():0,L=s.AudioUtils.getAddRestoreInfo(),M=L[t.fullId];M&&L[M.addedFullId]&&(M=null);let U=(0,o.geByClass1)("_audio_row_"+t.fullId);U=U!=e&&U;let S=T&&T.getPageCurrentPlaylist();var R;const k=null!=(R=(0,u.getContextPlaylist)(e))?R:{context:I};let B={group_id:O,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:k&&k.context||"",track_code:t.trackCode};const x=(0,P.partConfigEnabled)("audio_longtap_web"),N=(0,P.partConfigEnabled)("audio_my_music_api_web_enabled");if(D||t.accessKey!==t.addHash&&t.accessKey!==t.deleteHash)if(M){if("deleted"==M.state)N?b.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:C}).then((()=>{s.AudioUtils.getAudioTrackCodeFromPlaylist(k.playlist,t).then((i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),v(!1)})).catch((t=>{var i,s;const a=null==(s=t)||null==(i=s.error)?void 0:i.error_msg;return a&&new y.MessageBox({title:(0,p.getLang)("global_error")}).content(a).setButtons((0,p.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),v(!1),!0})):A.ajax.post("al_audio.php",{act:"restore_audio",oid:t.ownerId,aid:t.id,hash:t.restoreHash,track_code:t.trackCode},{onDone:function(){s.AudioUtils.getAudioTrackCodeFromPlaylist(k.playlist,t).then((i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),v(!1)},onFail:()=>(v(!1),!0)}),(0,o.removeClass)(e,"audio_row__deleted"),delete L[t.fullId],s.AudioUtils.onRowOver(e,!1,!0);else if("added"==M.state){const i=()=>{s.AudioUtils.getAudioTrackCodeFromPlaylist(k.playlist,t).then((i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED,trackCode:i})}));const i=(0,a.getAudioPlayer)();i&&(i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,O?-O:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(M.addedFullId),i.notify(r.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),v(!1)},l=()=>(v(!1),!0);if(x&&!M.audio.deleteHash){var W;const{id:e,ownerId:o}=M.audio,s=(0,f.getAudioFullId)({id:e,ownerId:o}),a=null==(W=b.$identitiesMap.getState()[s])?void 0:W.id;a&&C&&b.deleteFx({identity:{id:a,ownerId:C,accessKey:t.accessKey}}).then(i).catch(l)}else A.ajax.post("al_audio.php",{act:"delete_audio",oid:M.audio.ownerId,aid:M.audio.id,hash:M.audio.deleteHash,track_code:t.trackCode},{onDone:i,onFail:l});if((0,o.removeClass)(e,"audio_row__added"),x&&!N){const e={id:t.id,ownerId:t.ownerId},i=(0,f.getAudioFullId)(e),o=b.$identitiesMap.getState()[i];b.removeFromStore({oldIdentity:e,newIdentity:o})}U&&(0,o.removeClass)(U,"audio_row__added"),delete L[t.fullId],(0,a.getAudioPlayer)().notify(r.events.REMOVED,t.fullId,M.addedFullId)}}else!D&&N?b.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:C}).then((({id:o,ownerId:l})=>{if(s.AudioUtils.getAudioTrackCodeFromPlaylist(k.playlist,t).then((i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),o&&l){let s=l+"_"+o;L[t.fullId]={state:"added",addedFullId:s,audio:t},(0,a.getAudioPlayer)().notify(r.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,c.isFunction)(i)&&i()}v(!1)})).catch((t=>{var i,s;const a=null==(s=t)||null==(i=s.error)?void 0:i.error_msg;return a&&new y.MessageBox({title:(0,p.getLang)("global_error")}).content(a).setButtons((0,p.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),v(!1),!0})):A.ajax.post("al_audio.php?act=add",B,{onDone:function(l,n){if(s.AudioUtils.getAudioTrackCodeFromPlaylist(k.playlist,t).then((i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:i})})),l){let d=l[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+l[s.AudioUtils.AUDIO_ITEM_INDEX_ID];L[t.fullId]={state:"added",addedFullId:d,audio:s.AudioUtils.audioTupleToAudioObject(l)},x&&b.addToStore({oldIdentity:{id:t.id,ownerId:t.ownerId},newIdentity:{id:l[s.AudioUtils.AUDIO_ITEM_INDEX_ID],ownerId:l[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}}),(0,a.getAudioPlayer)().notify(r.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),(0,c.isFunction)(i)&&i(),function(e,t){var i,s;if(!t||!t.id)return;const a=null==(s=e)||null==(i=s.parentElement)?void 0:i.querySelector(".audio_page_player_share");if(!a)return;const l=(0,o.se)(`\n    <div class="ta_l">\n      <div>${t.text}</div>\n    </div>\n `),n=()=>{window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t.hash,hint_id:t.id})};(0,g.addEvent)(l,"click",n);const r=new h.ElementTooltip(a,{appendToParent:!0,cls:"feature_intro_tt feature_intro_blue_tt feature_intro_blue_tt--heightSmall",content:l,offset:[0,10],align:h.ElementTooltip.ALIGN_RIGHT,onHide:n});r.show(),a.addEventListener("mouseenter",(()=>{r.hide()}))}(e,n)}v(!1)},onFail:function(t){return t&&new y.MessageBox({title:(0,p.getLang)("global_error")}).content(t).setButtons((0,p.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),v(!1),!0}}),(0,o.addClass)(e,"audio_row__added"),U&&(0,o.addClass)(U,"audio_row__added"),(0,a.getAudioPlayer)().notify(r.events.ADDED,t.fullId),T&&S&&T.onUserAction(t,S);else{const i=()=>{v(!1)};if(M){if("added"==M.state){const s=()=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED,trackCode:t.trackCode});const i=(0,a.getAudioPlayer)();i&&(i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,O?-O:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(M.addedFullId),i.notify(r.events.MUSIC_AUDIOS_DELETE,t,{audioElement:e})),v(!1)};b.deleteFx({identity:{id:t.id,ownerId:window.vk.id,accessKey:t.accessKey}}).then(s).catch(i),(0,o.removeClass)(e,"audio_row__added"),U&&(0,o.removeClass)(U,"audio_row__added"),delete L[t.fullId],(0,a.getAudioPlayer)().notify(r.events.REMOVED,t.fullId,M.addedFullId)}}else{const s=i=>{(0,_.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED,trackCode:t.trackCode}),L[t.fullId]={state:"added",addedFullId:(0,f.getAudioFullId)({ownerId:i.ownerId,id:i.id}),audio:{}},(0,a.getAudioPlayer)().notify(r.events.MUSIC_AUDIOS_ADD,t,{audioElement:e}),v(!1)};b.addFx({trackedIdentity:{id:t.id,ownerId:t.ownerId,trackCode:t.trackCode,accessKey:t.accessKey},userId:window.vk.id}).then(s).catch((()=>{(0,o.removeClass)(e,"audio_row__added"),i()})),(0,o.addClass)(e,"audio_row__added"),U&&(0,o.addClass)(U,"audio_row__added"),(0,a.getAudioPlayer)().notify(r.events.ADDED,t.fullId),T&&S&&T.onUserAction(t,S)}}}},81313:(e,t,i)=>{i.d(t,{toggleAudioLyrics:()=>a});var o=i(82753),s=i(56401);function a(e,t){let i=(0,o.geByClass1)("_audio_row__lyrics",e);if(i){if((0,o.toggle)(i)){let t=(0,o.getSize)(e)[1],s=(0,o.getSize)(i)[1];(0,o.setStyle)(e,"height",t+s),(0,o.data)(e,"prevHeight",t)}else{let t=(0,o.data)(e,"prevHeight");(0,o.setStyle)(e,"height",t)}}else{(0,o.addClass)(e,"audio_loading");const a={act:"get_lyrics",aid:t.fullId,lid:t.lyrics};s.AudioUtils.isPodcast(t)&&(a.podcast=!0),ajax.post("al_audio.php",a,{onDone:function(a){(0,o.removeClass)(e,"audio_loading"),i=(0,o.se)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${a}</div></div>`),(0,o.geByClass1)("_audio_row_content",e).appendChild(i),s.AudioUtils.toggleAudioLyrics(e,t)},onFail:()=>!0})}}},11310:(e,t,i)=>{i.d(t,{unclaim:()=>l});var o=i(82753),s=i(30512),a=i(76849);function l(e,t,i){(0,o.removeClass)(t,"audio_moder_claimed"),(0,s.onRowOver)(t,!1,!0),e=(0,a.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_unclaim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})}},30090:(e,t,i)=>{i.d(t,{initUpload:()=>p});var o=i(34788),s=i(82753),a=i(56401),l=i(7659),n=i(13996),r=i(3895),d=i(23434),_=i(39586),u=i(65076),c=i(48041),h=i(57458);function p(e,t,i,p,A,g,y,P,E,f,w,m){cur.loadAudioDone=function(t,i){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,i),cur.boxClose){delete cur.boxClose;let t=cur.audiosLoaded>1?(0,r.getLang)("audio_success_msg_multiple"):(0,r.getLang)("audio_success_msg");e.setOptions({title:(0,r.getLang)("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(t),(0,s.hide)(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],(0,n.globalHistoryDestroy)(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+i[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone(){cur.__phinputs=cur.__phinputs||[],(0,n.globalHistoryDestroy)(nav.objLoc[0])}})},cur.loadAudioFailed=function(i,o){(0,s.hide)(e.progress),Upload.embed(i);let a=(0,s.ge)("audio_new_error"),l=a&&(0,s.domFC)(a),n=o.split("|");if(!l)return;o=n[0],n=n[1];let d=(0,_.intval)(o);(0,c.partConfigEnabled)("audio_show_upload_real_error_code")&&(d=o),(0,h.statlogsValueEvent)("load_audio_failed_code",d),l.innerHTML=n||(t[o]||(0,r.getLang)("audio_loading_error").replace("{code}",d)),(0,s.show)(a)},Upload.init("audio_add_upload_btn",i,p,{file_name:"file",file_size_limit:A,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:g,onUploadStart:function(t,i){"form"===Upload.types[t]&&(0,s.show)(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||((0,s.geByClass1)("file",(0,s.ge)("audio_add_upload_btn")).disabled=!0),(0,d.curBox)().changed=!0},onUploadProgress:function(e,t,i){if(!(0,s.ge)("form"+e+"_progress")){let t=Upload.obj[e],i=(0,s.getSize)(t)[1]/2+10,o=t.firstChild;for(;o;)1===o.nodeType&&(o.id==="uploader"+e&&l.browser.msie?(0,s.setStyle)(o,{position:"relative",left:"-5000px"}):(0,s.setStyle)(o,{visibility:"hidden"})),o=o.nextSibling;t.appendChild((0,s.ce)("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:i+"px",marginTop:-i+"px"}))}let o=(0,_.intval)(t/i*100);(0,s.setStyle)((0,s.ge)("form"+e+"_progress"),{width:o+"%"})},onUploadComplete:function(e,t){let i;this.use_go_uploader||(t=t.replace(/\+/g," "));try{i=JSON.parse(t)}catch(e){i=(0,u.fromQueryString)(t)}let s={};this.use_go_uploader?s={act:"done_add",upldr:1,go_uploader_response:t}:(i.title=decodeURIComponent(i.title),i.artist=decodeURIComponent(i.artist),s=(0,o._)({},i,{act:"done_add",upldr:1})),i.code?cur.loadAudioFailed(e,i.code):ajax.post("al_audio.php",s,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:y,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:P,error:E,error_hash:f,dropbox:"choose_audio_dropbox",use_go_uploader:m}),e.setControlsText(w)}},60447:(e,t,i)=>{i.d(t,{getUMAInfo:()=>s});var o=i(44734);function s(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})}},18867:(e,t,i)=>{i.d(t,{getUMAInfoAlbum:()=>s});var o=i(44734);function s(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})}},56401:(e,t,i)=>{i.d(t,{AudioUtils:()=>Fe});var o=i(34788),s=i(92414),a=i(9947),l=i(81313),n=i(89829),r=i(30512),d=i(2907),_=i(66894),u=i(77570),c=i(4772),h=i(62050),p=i(2377),A=i(54078),g=i(87339),y=i(94132),P=i(84648),E=i(65046),f=i(85010),w=i(35424),m=i(91268),I=i(96564),C=i(69956),v=i(46651),T=i(97945),b=i(79282),D=i(46880),O=i(50190),L=i(70526),M=i(34116),U=i(87483),S=i(64538),R=i(77673),k=i(76784),B=i(82641),x=i(28758),N=i(86135),W=i(69951),F=i(91862),K=i(34265),j=i(84549),H=i(28500),Y=i(37637),V=i(48849),X=i(29280),Q=i(49343),$=i(99794),G=i(76849),q=i(37450),z=i(72236),J=i(78403),Z=i(71513),ee=i(59341),te=i(11310),ie=i(60447),oe=i(18867),se=i(50023),ae=i(29398),le=i(60139),ne=i(15113),re=i(72278),de=i(27026),_e=i(89190),ue=i(93398),ce=i(69969),he=i(28021),pe=i(99110),Ae=i(78203),ge=i(21222),ye=i(86314),Pe=i(1660),Ee=i(53864),fe=i(38523),we=i(15674),me=i(97877),Ie=i(37392),Ce=i(49659),ve=i(61863),Te=i(30090),be=i(10950),De=i(33993),Oe=i(78410),Le=i(93938),Me=i(75109),Ue=i(77362),Se=i(11973),Re=i(87866),ke=i(48269),Be=i(59672),xe=i(80143),Ne=i(35716),We=i(7122);const Fe=(0,o._)({},s.AUDIO_PLAYER_ENUMS,{audioSearchPerformer:a.audioSearchPerformer,toggleAudioLyrics:l.toggleAudioLyrics,getRowActionName:n.getRowActionName,initRowPlaylistsChooser:c.initRowPlaylistsChooser,addToPlaylistsBoxInit:h.addToPlaylistsBoxInit,showRecoms:p.showRecoms,shareAudio:A.shareAudio,showAudioAlbum:g.showAudioAlbum,openEpisode:y.openEpisode,replaceWithOriginal:P.replaceWithOriginal,editAudio:E.editAudio,editEpisode:f.editEpisode,deleteCurrentAudio:w.deleteCurrentAudio,deleteAudio:m.deleteAudio,deleteEpisode:I.deleteEpisode,restoreEpisode:C.restoreEpisode,deleteDeletedAudios:v.deleteDeletedAudios,faveEpisode:T.faveEpisode,contextSplit:b.contextSplit,showAudioPlaylist:D.showAudioPlaylist,editPlaylist:M.editPlaylist,followPlaylist:U.followPlaylist,getAudioTrackCodeFromPlaylist:S.getAudioTrackCodeFromPlaylist,getLayer:R.getLayer,updateQueueReceivedPost:k.updateQueueReceivedPost,toggleAudioHQBodyClass:B.toggleAudioHQBodyClass,hasAudioHQBodyClass:x.hasAudioHQBodyClass,getAddRestoreInfo:N.getAddRestoreInfo,getPlaylistAddRestoreInfo:W.getPlaylistAddRestoreInfo,toggleAddAudio:F.toggleAddAudio,addAudioToOwner:K.addAudioToOwner,chooseAudioBox:j.chooseAudioBox,getAudioArtistsString:H.getAudioArtistsString,getAudioPerformers:Y.getAudioPerformers,drawAudio:V.drawAudio,isClaimedAudio:X.isClaimedAudio,getDurationMod:V.getDurationMod,getAudioExtra:Re.getAudioExtra,mergeAudioExtra:ke.mergeAudioExtra,getAudioFromEl:Q.getAudioFromEl,getAudioFullId:$.getAudioFullId,audioTupleToAudioObject:G.audioTupleToAudioObject,initDomPlaylist:q.initDomPlaylist,getContextPlaylist:z.getContextPlaylist,renderAudioDiag:Z.renderAudioDiag,claim:ee.claim,unclaim:te.unclaim,getUMAInfo:ie.getUMAInfo,getUMAInfoAlbum:oe.getUMAInfoAlbum,showAudioInfo:se.showAudioInfo,cancelReplacement:ae.cancelReplacement,removeFromGroup:le.removeFromGroup,addToGroupBox:ne.addToGroupBox,showAudioRestriction:Ae.showAudioRestriction,isPodcast:re.isPodcast,isArticleTts:de.isArticleTts,isRadio:Be.isRadio,isExternalStream:xe.isExternalStream,isMarusiaTrack:_e.isMarusiaTrack,isMarusiaTale:ue.isMarusiaTale,isPrivatePodcast:ce.isPrivatePodcast,followArtist:Pe.followArtist,unfollowArtist:Ee.unfollowArtist,followCurator:fe.followCurator,unfollowCurator:we.unfollowCurator,followOwner:me.followOwner,unfollowOwner:Ie.unfollowOwner,trackArtistToOfficial:Ce.trackArtistToOfficial,PodcastsLogs:he,copyAudioLink:We.copyAudioLink,copyAudioLinkByIdentity:Ne.copyAudioLinkByIdentity,copyPlaylistLink:pe.copyPlaylistLink,getAlbumParts:ge.getAlbumParts,drawAlbumPartRow:ye.drawAlbumPartRow,onRowOver:r.onRowOver,onRowLeave:d.onRowLeave,onAudioAddedToPlaylist:_.onAudioAddedToPlaylist,onAudioChoose:O.onAudioChoose,onPlaylistChoose:L.onPlaylistChoose,claimPlaylist:ve.claimPlaylist,initUpload:Te.initUpload,turnPlaylistDiscover:be.turnPlaylistDiscover,hidePlaylistFromRecoms:De.hidePlaylistFromRecoms,showPlaylistInRecoms:Oe.showPlaylistInRecoms,hideCatalogBlock:Le.hideCatalogBlock,mergeAudioTupleWithoutContext:Me.mergeAudioTupleWithoutContext,followRadiostation:Ue.followRadiostation,unfollowRadiostation:Se.unfollowRadiostation,_showPlaylistsChooser:u.showPlaylistsChooser,debugLog:J.debugLog})},58827:(e,t,i)=>{i.d(t,{connectListenQueue:()=>g});var o=i(64118),s=i(56401),a=i(49957),l=i(44734),n=i(84163),r=i(48041);const d=3e4;let _=null,u=null,c=!1,h=0;const p=new o.WebQueueListener((function(e){if(e.failed)return void g(!0);const t=(0,a.getAudioPlayer)(),i=t.isPlaying(),o=t.getCurrentAudio(),n=s.AudioUtils.isPodcast(o);for(let o=0;o<e.events.length;o++){let s=e.events[o].data;if("start"===s.type&&AudioPlayer.getDeviceId()!==s.uuid&&!u&&!n&&i){t.pausedByQueue=Date.now(),t.pause(),u=(0,l.showBox)("al_audio.php",{act:"start_playback_box",uuid:s.uuid,device_name:s.device_name},{params:{hideButtons:!0,onHide:()=>{u=!1}},containerClass:"audio_playback_box"});break}}})),A=new o.WebQueueListener((function(e){e.events.length&&e.events.forEach((e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)}))}));function g(e){if(!window.Notifier||!vk.id)return;let t=window.ap&&(0,a.getAudioPlayer)(),i=t&&t.getCurrentAudio(),o=window.Notifier&&!vk.widget,l=!c&&i?p.listenQueueKey:A.listenQueueKey,u=s.AudioUtils.isPodcast(i);(e||o&&!u&&!l)&&(i||(0,r.partConfigEnabled)("audio_subscription_update"))&&(i=i?s.AudioUtils.audioTupleToAudioObject(i):{},function(e={},t=(()=>{}),i=(()=>!0)){ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:i})}(i,(e=>{const t=function(e){const t=(0,n.unpackQueues)(e);t.audio&&p.connect(t.audio);t.subscription&&A.connect(t.subscription);return t}(e);c=!i||!t.audio,(t.audio||t.subscription)&&(_&&clearTimeout(_),_=window.setTimeout((()=>g(!0)),d))}),(()=>(h++,h<3&&g(!0),!0))))}},79282:(e,t,i)=>{i.d(t,{contextSplit:()=>s});var o=i(34892);function s(e){return(0,o.isObject)(e)&&(e=e.context),(e||"").split(":")}},78403:(e,t,i)=>{function o(){}i.d(t,{debugLog:()=>o})},81483:(e,t,i)=>{i.d(t,{getContext:()=>a});var o=i(72236),s=i(79282);function a(e){const t=window.currentAudioPage&&window.currentAudioPage(e),i=t&&t.getPageCurrentPlaylist();let a,l=(0,o.getContextPlaylist)(e,!0);return l&&(l=(0,s.contextSplit)(l),Array.isArray(l)&&l.length>0&&(a=l[0])),("search"===a&&i&&i.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(a="search:external"),a}},77673:(e,t,i)=>{function o(){let e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e}i.d(t,{getLayer:()=>o})},84415:(e,t,i)=>{i.d(t,{getPlaylistUrl:()=>s});var o=i(50722);function s(e,t,i,s=!1){const a=`/music/${o.Ranges.isOfficialPlaylist(e)?"album":"playlist"}/${e}_${t}${i?`_${i}`:""}`;return s?`${location.protocol}//${location.host}${a}`:a}},50023:(e,t,i)=>{i.d(t,{showAudioInfo:()=>a});var o=i(12263),s=i(23434);function a(e,t,i){if(!t.showInfo)return;if(e.dataset.showedInfo)return;e.dataset.showedInfo=!0;const a=t.performer.split("], "),l=a.length>1?a[1]:a[0],n=encodeURI(l+" - "+t.title),r=`<a href="/search?c[section]=audio&c[q]=${n}" target="_blank">Найти VK</a>`,d=`<a href="${t.adminUrl}?act=audio&raw_id=${t.fullId}" target="_blank">Admin</a>`,_=`<a href="/away.php?to=${encodeURIComponent(t.umaQueryUrl+"?query="+n)}" target="_blank">Найти UMA</a>`,u=document.createElement("div");u.classList.add("AudioInfo__container"),u.innerHTML=" • "+_+" • "+r+" • "+d,u.style.fontSize="x-small",i&&u.classList.add("AudioInfo__container--secondary");const c=document.createElement("span");c.innerText="ID: "+t.fullId,c.classList.add("AudioInfo__copyLink"),c.onclick=e=>{(0,o.copyTextToClipboard)(t.fullId).then((()=>{(0,s.showDoneBox)("ID аудиозаписи скопирован в буфер обмена")}))},e.parentElement.insertBefore(u,e.nextSibling),u.prepend(c)}},96183:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AUDIO_LAYER_CONTAINER_CLASS_NAME:()=>AUDIO_LAYER_CONTAINER_CLASS_NAME});var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(24915),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(86136),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(82753),_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(47524);const AUDIO_LAYER_CONTAINER_CLASS_NAME="audio_layer_container";class AudioLayer{static prepare(e){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/suggester.js"),window.jsc("web/auto_list.js"),window.jsc("web/indexer.js")],(()=>{e&&e()}))}toggle(e,t){this._initTooltip();let i=this._els.tooltip,o=void 0!==e?e:!i.isShown();o&&this.initPage(),o?(i.show(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__.cancelStackPush)("top_audio",(()=>{this.toggle(!1,!0)}),!0)):(t||(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__.cancelStackPop)(),i.hide()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(this._els.topNotaBtn,"TopNavBtn--active",o)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.layerPlace),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)("ts_wrap")[0]-e[0]-1,i=0;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.isVisible)(this._els.topNotaBtnGroup)){i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.topNotaBtn)[0]-e[0])+15}else{i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.topPlayBtn)[0]-e[0])+3}return{left:t,top:-1,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="${AUDIO_LAYER_CONTAINER_CLASS_NAME}">\n        <div class="top_audio_loading">\n          ${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||((0,_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_3__.ensureAutoplayService)().init(),ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){(0,_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_page_layout",this._els.container),data),this._initSection=data.initSection||void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0}))}constructor(){this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.ge)("top_audio_layer_place"),topPlayBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_top_audio_player_play"),topNotaBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("TopNavBtn__audio"),topNotaBtnGroup:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.ge)("top_audio_btn_group")}}}},73674:(e,t,i)=>{i.d(t,{AUDIO_PLAYER_INITED_EVENT:()=>ue,AudioPlayer:()=>ce});var o=i(11010),s=i(34788),a=i(68949),l=i(26312),n=i(56401),r=i(7659),d=i(49305),_=i(49957),u=i(3895),c=i(24915),h=i(34892),p=i(44734),A=i(57458),g=i(96041),y=i(85164),P=i(23434),E=i(82079),f=i(39586),w=i(70027),m=i(47987),I=i(82753),C=i(89827),v=i(9476),T=i(90600),b=i(63517),D=i(73242),O=i(59040),L=i(92450),M=i(72045),U=i(45701),S=i(98022),R=i(76849),k=i(86591),B=i(91686),x=i(11749),N=i(58827),W=i(56782),F=i(98690),K=i(75109),j=i(99794),H=i(48041),Y=i(28612),V=i(10524),X=i(38115),Q=i(61810),$=i(94271),G=i(92414),q=i(1036),z=i(59672),J=i(53698),Z=i(43418),ee=i(62624),te=i(27026),ie=i(50316),oe=i(29538),se=i(29633),ae=i(88446),le=i(49254),ne=i(81044),re=i(13613);let de={};const _e=(0,W.throttledPromise)((()=>{}),1500,!0),ue="audio_player_inited";class ce{static getVersion(){return 15}static _sendLCNotification(){const e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){return void 0===e?!!ce._lsGet(ce.LS_SHOW_HQ_LABEL):(e=!!e,ce._lsSet(ce.LS_SHOW_HQ_LABEL,e),n.AudioUtils.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return(0,I.geByClass)(`_audio_row_${e}`,t)}static getDeviceId(){let e=ce._lsGet(ce.LS_UUID);return e||(e=(0,M.default)(),ce._lsSet(ce.LS_UUID,e)),e}static showSubscriptionPopup(){(0,p.showBox)("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return ce._lsGet(ce.LS_DURATION_TYPE)}static _setTabIcon(e){(0,d.setFavIcon)(ce.tabIcons[e])}static _getLsFullKey(e){return`${ce.LS_PREFIX}${e}_${vk.id}`}static _lsGet(e){return ls.get(ce._getLsFullKey(e))}static _lsSet(e,t){return ls.set(ce._getLsFullKey(e),t)}static _lsRemove(e){return ls.remove(ce._getLsFullKey(e))}static _podcastGetStates(){return(ce._lsGet(ce.LS_PODCASTS)||de).states||{}}static _podcastSetStates(e){const t=ce._lsGet(ce.LS_PODCASTS)||de;t.states=e,ce._lsSet(ce.LS_PODCASTS,t),de=t}static podcastToggleFave(e,t){if(!t)return;t=n.AudioUtils.audioTupleToAudioObject(t);const i=n.AudioUtils.getAudioExtra(t).faveHash;i&&window.bookmarkPodcast(e,t.fullId,i)}static podcastGetPlaybackRate(){return(ce._lsGet(ce.LS_PODCASTS)||de).rate||1}static getLang(e){const t=(0,_.getAudioPlayer)();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){ce._iterateCacheKeys((e=>e===ce.LS_VER))}static clearOutdatedCacheKeys(){(ce._lsGet(ce.LS_SAVED)||0)<(0,h.vkNow)()-72e5&&ce._iterateCacheKeys(((e,t)=>!(0,f.inArray)(t,[ce.LS_PL,ce.LS_TRACK,ce.LS_PROGRESS])))}getCurrentAudioLs(){return ap.getCurrentAudio()||ce._lsGet(ce.LS_TRACK)||null}static clearAllCacheKeys(){ce._iterateCacheKeys((()=>!1)),(0,E.setCookie)("remixcurr_audio","",-1)}static _iterateCacheKeys(e){B.vkLocalStorage.getPrefixedKeys(`${ce.LS_KEY_PREFIX}_`).forEach((t=>{const[,i,o]=t.split("_");e(i,o)||B.vkLocalStorage.removeItem(o)}))}_initImpl(){this._impl&&this._impl.destroy();let e=0,t=!1;const i=t=>{if(-1===e)return;if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;const t=new window.MessageBox({title:(0,u.getLang)("global_error")}).content((0,u.getLang)("audio_error_loading")).setButtons("Ok",(function(){e=0,(0,P.curBox)().hide()}));return t.show(),(0,D.setWorkerTimeout)((function(){e=0,t.hide()}),3e3),this.notify(L.events.ENDED),void this.notify(L.events.FAILED)}const i=this.getCurrentAudio(),o=this.getCurrentAudioData();if(n.AudioUtils.isPodcast(i))this.setIsPlaying(!1),this.notify(L.events.PAUSE),this.notify(L.events.ENDED),this.stop();else if(this._repeatCurrent)this._autoNext=!0,this.notify(L.events.ENDED),this.notify(L.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),(0,D.setWorkerTimeout)((()=>{this._impl&&this._impl.clearAudioNode&&(o&&this.emitter.emit("stopAudio",{reason:t?re.AudioPlayerStopAudioEventReason.Error:re.AudioPlayerStopAudioEventReason.Repeat,audio:o,progressTime:this.getCurrentProgressTime()}),this._impl.stop(),o&&this.emitter.emit("playAudio",{reason:re.AudioPlayerPlayAudioEventReason.Repeat,audio:o,progressTime:0}),this._implSetUrl(i)),this._implPlay()}));else{if(this.setIsPlaying(!1),o){let e;e=t?re.AudioPlayerStopAudioEventReason.Error:this.ads.isActive?re.AudioPlayerStopAudioEventReason.Adv:re.AudioPlayerStopAudioEventReason.QueueContinuation,this.emitter.emit("stopAudio",{reason:e,audio:o,progressTime:this.getCurrentProgressTime()})}this.notify(L.events.ENDED),this._playNextMarked({auto:!0,reason:t?re.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError:re.AudioPlayerPlayAudioEventReason.QueueContinuation})}},o={onPause:()=>{this.setIsPlaying(!1),this.setIsPaused(!0),this.notify(L.events.PAUSE),t=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setIsPaused(!1),this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(L.events.PLAY),t=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{this.notify(L.events.BUFFERED,e)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(L.events.CAN_PLAY),onProgressUpdate:(e,i)=>{const o=this.getCurrentAudio();if(this._muteProgressEvents||!o)return;const s=this._impl.getDuration()||o[n.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(L.events.PROGRESS,e,s,i),!vk.id&&s-i<ce.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*ce.UNAUTH_FADE_TIME))},onFrequency:e=>{this.notify(L.events.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new b.AudioPlayerHTML5(o),this.implTaskManager=new x.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}get nextEvents(){return this.emitter.listenable}get events(){return this.nextEvents}fadeIn(e=300){this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(e=300){this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){if(this.getCurrentAudio())switch(e.keyCode){case 179:this.isPlaying()?this.pauseByButton():this.playByButton();break;case 178:this._stopAudio({reason:re.AudioPlayerStopAudioEventReason.Unknown}),this._seek({amount:0});break;case 177:this.playPrevByButton();break;case 176:this.playNextByButton()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(let t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach((i=>{i.getId()===e.getId()&&i.getOwnerId()===e.getOwnerId()&&(i.hasMore()?i.mergeWith(t):i.mergeInfo(t))}))}deleteCurrentPlaylist(){(0,H.partConfigEnabled)("audio_player_stats_web")&&this.stop(re.AudioPlayerStopAudioEventReason.Clear),this.getPlaylistQueue().removeSortedList(),this._currentAudio=null,this.setCurrentPlaylist(null),this.notify(L.events.UPDATE),this.notify(L.events.PLAYLIST_CHANGED),(0,H.partConfigEnabled)("audio_player_stats_web")||this.stop(re.AudioPlayerStopAudioEventReason.Clear),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;const t=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());let i=[];if(t){const e=(0,I.geByClass)("_audio_row_"+t.fullId);i=i.concat([].slice.call(e))}const o=document.querySelectorAll(".AudioRadiostationItem"),s=(0,z.isRadio)(t)&&this.isPlaying();Array.from(o).forEach((e=>{e.classList.toggle("AudioRadiostationItem--playing",s&&parseInt(e.dataset.id)===t.id)}));for(let t=0,o=this._currentPlayingRows.length;t<o;t++){const o=this._currentPlayingRows[t];o&&!(0,f.inArray)(o,i)&&this.toggleCurrentAudioRow(o,!1,e)}if(t)for(let t=0,o=i.length;t<o;t++){const o=i[t];if(o){if((0,I.gpeByClass)("article_editor_canvas",o))continue;this.toggleCurrentAudioRow(o,!0,e)}}this._currentPlayingRows=i,(0,f.each)((0,I.geByClass)("_audio_pl"),((e,t)=>(0,I.removeClass)(t,"audio_pl__playing")));const a=this.getCurrentPlaylist();if(this.isPlaying()&&a){const e=(0,I.geByClass)(`_audio_pl_${a.getOwnerId()}_${a.getPlaylistId()}`);e&&(0,f.each)(e,((e,t)=>(0,I.addClass)(t,"audio_pl__playing")))}}scrollToCurrentPlaying(e,t){const i=ce.getAudioElementsByAudioId(e);window.AudioPage&&i.forEach((e=>{const i=window.currentAudioPage(e);if(i&&i._scroll){const e=i.getCurrentSectionEl()||i.getPageContainer();ce.getAudioElementsByAudioId(t,e).length||i.drawMore(),i.scrollIntoView(ce.getAudioElementsByAudioId(t,e)[0],150)}}))}toggleCurrentAudioRow(e,t,i){const o=n.AudioUtils.getAudioFromEl(e,!0);(0,I.addClass)(e,n.AudioUtils.AUDIO_CURRENT_CLS),o.withInlinePlayer&&(0,I.toggleClass)(e,"audio_row__player_transition",i),(i=!!o.withInlinePlayer&&i)?setTimeout((()=>this._updateAudioEl(t,e,o,i)),0):this._updateAudioEl(t,e,o,i)}_updateAudioEl(e,t,i,o){const s=(0,I.geByClass1)("_audio_row__play_btn",t),a=(0,I.geByClass1)("_audio_row__title",t),l=(0,I.geByClass1)("_audio_row__duration",t);let r=n.AudioUtils.getDurationMod(e?i.duration:i.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&((0,I.removeClass)(t,"audio_row__playing"),s&&(0,I.attr)(s,"aria-label",(0,u.getLang)("global_audio_play")),a&&(0,I.attr)(a,"role",""));let d=(e,t="")=>{if(l){let i=n.AudioUtils.getDurationMod(e);l.innerHTML=t+(0,y.formatTime)(e),i!==r&&((0,I.replaceClass)(l,n.AudioUtils.AUDIO_DURATION_CLS+"-"+r,n.AudioUtils.AUDIO_DURATION_CLS+"-"+i),r=i)}};if(i.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[L.events.PLAY,L.events.PLAY_REQUESTED],(e=>{n.AudioUtils.audioTupleToAudioObject(e).fullId===i.fullId&&((0,I.addClass)(t,n.AudioUtils.AUDIO_PLAYING_CLS),s&&(0,I.attr)(s,"aria-label",(0,u.getLang)("global_audio_pause")),a&&(0,I.attr)(a,"role","heading"))})),this.on(t,L.events.PROGRESS,((e,t,o)=>{if(!i.withInlinePlayer&&this.ads.isActive)return void d(i.duration);o=parseInt(o);let s=0,a="";ce.getDurationType()?(s=Math.round(o-t*o),a="-"):s=Math.round(t*o),d(s,a)}));let e=(0,I.data)(t,"bars");if(!e&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(e=(0,I.se)('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?(0,I.geByClass1)("podcast_list_snippet__cover",t).appendChild(e):t.appendChild(e),e.width=n.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,h.isRetina)()?2:1),e.height=n.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,h.isRetina)()?2:1),e.style.width=n.AudioUtils.AUDIO_ROW_COVER_SIZE,e.style.height=n.AudioUtils.AUDIO_ROW_COVER_SIZE,(0,h.isRetina)()){e.getContext("2d").scale(2,2)}const o=getComputedStyle(e).color;this.on(t,L.events.FREQ_UPDATE,((t,i)=>he(e,i,o))),he(e,[0,0,0,0],o),(0,I.data)(t,"bars",e)}(0,I.toggleClass)(t,n.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),(0,I.removeClass)(t,n.AudioUtils.AUDIO_PLAYING_CLS),(0,I.removeClass)(t,n.AudioUtils.AUDIO_CURRENT_CLS),d(i.duration),s&&(0,I.attr)(s,"aria-label",(0,u.getLang)("global_audio_play")),a&&(0,I.attr)(a,"role","");let e=(0,I.data)(t,"bars");e&&((0,I.re)(e),(0,I.data)(t,"bars",null))}o?setTimeout((()=>{const e=n.AudioUtils.getAudioFromEl(t,!0);(0,I.toggleClass)(t,n.AudioUtils.AUDIO_CURRENT_CLS,!!e.isCurrent)}),0):(0,I.toggleClass)(t,n.AudioUtils.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){(0,I.removeClass)(e,n.AudioUtils.AUDIO_CURRENT_CLS);const t=(0,I.data)(e,"player_inited");if(!t)return;setTimeout((()=>(0,I.re)((0,I.geByClass1)("_audio_inline_player",e))),200);const i=(0,I.geByClass1)("_audio_duration",e);i&&(i.innerHTML=(0,y.formatTime)(n.AudioUtils.getAudioFromEl(e,!0).duration)),this.off(e),(0,f.each)(t.sliders,((e,t)=>t.destroy())),(0,I.data)(e,"player_inited",!1);const o=(0,I.geByClass1)("has_audio_player",e);o&&(0,I.removeClass)(o,"has_audio_player")}_addRowPlayer(e){if((0,I.geByClass1)("_audio_inline_player",e)||(0,I.hasClass)(e,"podcast_list_snippet")||(0,I.hasClass)(e,"podcast_snippet__controls")||(0,I.hasClass)(e,"PodcastWidget__player"))return;const t=(0,I.se)(vk.audioInlinePlayerTpl||(0,f.getTemplate)("audio_inline_player")),i=(0,I.geByClass1)("_audio_player__place",e);i.appendChild(t),(0,I.addClass)(i,"has_audio_player");const o=new window.Slider((0,I.geByClass1)("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),s=new window.Slider((0,I.geByClass1)("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>(0,y.formatTime)(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{const i=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());i&&n.AudioUtils.isPodcast(i)&&this.podcastSetActionRef(i,n.AudioUtils.PodcastsLogs.ACTION_SEEK,"",t),this.seekBySlider(e)}});this.ads.isActive&&s.toggleAdState(!0),vk.id||s.setBlocked(!0),this.on(e,L.events.AD_DEINITED,(()=>{})),this.on(e,L.events.AD_READY,(()=>{})),this.on(e,L.events.AD_STARTED,(()=>{s.toggleAdState(!0),s.setBackValue(0)})),this.on(e,L.events.AD_COMPLETED,(()=>s.toggleAdState(!1))),this.on(e,L.events.START_LOADING,(()=>s.toggleLoading(!0))),this.on(e,L.events.CAN_PLAY,(()=>s.toggleLoading(!1))),this.on(e,L.events.BUFFERED,((e,t)=>s.setBackValue(t))),this.on(e,L.events.PROGRESS,((e,t)=>{s.toggleLoading(!1),s.setValue(t)})),this.on(e,L.events.VOLUME,((e,t)=>{o.setValue(t,!0)})),(0,I.data)(e,"player_inited",{sliders:[o,s]})}hasStatusExport(){for(let e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e,t=!1){this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){ce._lsSet(ce.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=(0,h.isObject)(e)||(0,h.isArray)(e)?n.AudioUtils.audioTupleToAudioObject(e).fullId:e,(0,f.each)(this._playlists,((t,i)=>i.removeAudio(e))),this.getPlaylistQueue().removeAudio(e),this.saveStateCurrentPlaylist()}updateAudio(e,t){let i="";return(0,h.isString)(e)?i=e:(0,h.isArray)(e)&&(i=n.AudioUtils.audioTupleToAudioObject(e).fullId),t||(t=e),(0,f.each)(this._playlists,((o,s)=>{const a=s.getAudiosList();for(let o=0,s=a.length;o<s;o++)n.AudioUtils.getAudioFullId(a[o])===i&&(a[o]=(0,K.mergeAudioTupleWithoutContext)(e,t))})),this._currentAudio&&n.AudioUtils.getAudioFullId(this._currentAudio)===i&&(this.setCurrentAudio((0,K.mergeAudioTupleWithoutContext)(e,t)),this.notify(L.events.CURRENT_CHANGED)),this.notify(L.events.UPDATE),e}_triggerTNSPixel(){const e=ce._lsGet("tns_triggered_time_v3")||0,t=(0,h.vkNow)();t-e<864e5||(ce._lsSet("tns_triggered_time_v3",t),(0,h.vkImage)().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${(0,h.irand)(1,1e9)}`)}_restoreVolumeState(){ce.clearDeprecatedCacheKeys(),ce.clearOutdatedCacheKeys();const e=ce._lsGet(ce.LS_VOLUME);this._userVolume=null==e||!1===e?U.DEFAULT_VOLUME:e}restoreState(){if(vk.widget)return;if(ce.clearDeprecatedCacheKeys(),ce.clearOutdatedCacheKeys(),window.cur.audioPreventRestoreTrack)return;this.setCurrentAudio(ce._lsGet(ce.LS_TRACK));let e=ce._lsGet(ce.LS_PL);if(e){e=JSON.parse(e);const t=this.hasPlaylist(e.type,e.ownerId,e.albumId);e.type===w.AudioPlaylist.TYPE_RADIO&&t?this.setCurrentPlaylist(t):(this.setCurrentPlaylist(new w.AudioPlaylist(e)),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this.getPlaylistQueue().setSortedQueue(e.list,e.source),this._initPlayingContext(this._currentPlaylist.getContext())}this._currentPlaylist&&this._currentAudio?this.notify(L.events.UPDATE):(this.setCurrentPlaylist(null),this.setCurrentAudio(null));const t=this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_DURATION];let i=0;if(n.AudioUtils.isPodcast(this._currentAudio)){const e=ce._podcastGetStates(),o=`${this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_ID]}`;i=((e[o]||{}).position||0)/t}else i=ce._lsGet(ce.LS_PROGRESS)||0;this._currentAudio&&this._impl&&this._implSetUrl(this._currentAudio,!0).then((()=>i&&i<1?this.implTaskManager.seek(i):this.implTaskManager.setVolume(0))).then((()=>{this.emitter.emit("stateRestore",{audio:(0,k.toTrackedAudioData)(this._currentAudio),progressTime:i*t*1e3})})).catch((()=>{this.deleteCurrentPlaylist()})).finally((()=>{this.notify(L.events.CURRENT_CHANGED)})),this._updatePlaybackRate(),this._currentAudio?this.mediaFocusChannel.start():this.mediaFocusChannel.stop()}_implPlay(){const e=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());return this.implTaskManager.play().then((()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!r.browser.safari,e.actionHash&&((0,N.connectListenQueue)(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:ce.getDeviceId()},{onFail:()=>!0})),n.AudioUtils.isPodcast(e)){const t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,n.AudioUtils.PodcastsLogs.ACTION_PLAY)}this.notify(L.events.IMPL_PLAY)}))}_implSetUrl(e,t){this.implTaskManager.clearTask(x.TaskName.URL),t||this.notify(L.events.START_LOADING);const i=(0,R.audioTupleToAudioObject)(e);return this._ensureHasURL(i).then((e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch((()=>{this.implTaskManager.clearAllTasks(),this.notify(L.events.FAILED),this.isPlaying()&&this._playNextMarked({auto:!0,reason:re.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError})}));throw new Error}))}toggleDurationType(){const e=ce._lsGet(ce.LS_DURATION_TYPE);ce._lsSet(ce.LS_DURATION_TYPE,!e),this.notify(L.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}getCurrentProgressTime(){var e;const t=this.getCurrentAudio();var i,o;const s=null!=(o=null!=(i=this._impl.getDuration())?i:null==(e=t)?void 0:e[n.AudioUtils.AUDIO_ITEM_INDEX_DURATION])?o:0;return this.getCurrentProgress()*s*1e3}_initEvents(){const e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",(()=>{this.audioPlayersSwitch.pause(),(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel()),this.pausedByVideo=null})),e.addRecvClbk(se.PreviewAudioPlayerNotification.start,"audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByPreview=Date.now())})),e.addRecvClbk(se.PreviewAudioPlayerNotification.stop,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk(se.PreviewAudioPlayerNotification.pause,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk("video_start","audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","audio",(()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.resumeChannel(),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","audio",(()=>{cur.loggingOff=!0,ce.clearAllCacheKeys(),this.stop()})),e.addRecvClbk("stories_video_start","audio",(()=>{this.isPlaying()&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByStories=(0,h.vkNow)())})),e.addRecvClbk("stories_video_end","audio",(()=>{!this.isPlaying()&&this.pausedByStories&&((0,h.vkNow)()-this.pausedByStories<18e4&&this.resumeChannel(),this.pausedByStories=null)}))),new ee.RadiostationEventsHandling}addPlaylist(e){const t=this.hasPlaylist(e.getId());t?(t.mergeWith(e.asObject()),t.getType()===w.AudioPlaylist.TYPE_RADIO&&this._currentPlaylist===t&&this.getPlaylistQueue().setSortedQueue(t.getAudiosList())):this._playlists.push(e)}_cleanUpPlaylists(){let e=0,t=-1;for(let i=this._playlists.length-1;i>=0;i--){const o=this._playlists[i];if(!o.isReference()&&(e+=o.getAudiosCount(),e>4e3)){t=i;break}}if(-1===t)return;t+=1;const i=this._playlists.slice(0,t),o=this.getCurrentPlaylist(),s=[];for(let e=0;e<i.length;e++){let a=i[e];if(o===a&&(a=!1),a&&!a.isReference())for(let e=t;e<this._playlists.length;e++){const t=this._playlists[e];t.isReference()&&t.getSelf()===a&&(a=!1)}a&&s.push(e)}for(let e=0;e<s.length;e++){const t=s[e];this._playlists.splice(t,1)}s.length&&(0,c.debugLog)("AudioPlayer - "+s.length+" playlists removed")}hasPlaylist(e,t,i,o){let s;if(o)return this._playlists.find((e=>e.getBlockId()===o||e.getAlbumId()===o))||!1;s=void 0!==t&&void 0!==i?`${e}_${t}_${i}`:e;for(let e=0;e<this._playlists.length;e++){let t=this._playlists[e];if(!t.isReference()&&t.getId()===s)return t}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter((t=>t.getType()===e))||null}getPlaylist(e,t,i,o,s=""){!e||t||i||([e,t,i]=w.AudioPlaylist.splitId(e));const a=this.hasPlaylist(e,t,i,s);return a?(a.mergeWith({accessHash:o}),a):new w.AudioPlaylist({type:e,ownerId:t,albumId:i,hasMore:e!==w.AudioPlaylist.TYPE_TEMP,accessHash:o,blockId:s})}getPlaylistQueue(){return this._playlistQueue}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||n.AudioUtils.getAudioFullId(this._currentAudio)===n.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return window.Widgets.oauth(),!1;const i="audio_row__added_next";if(!(0,I.hasClass)(e,i)){(0,I.addClass)(e,i);const o=this.getCurrentPlaylist(),s=this.getPlaylistQueue();if(o){const e=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(e&&t.fullId===e.fullId)return;const i=s.indexOfAudio(e);if(-1===i)return;this.notify(L.events.PLAY_NEXT,e.fullId,t.fullId);const o=this.getPlaylistQueue(),a=s.indexOfAudio(t);-1!==a?o.moveAudio(a,i+1):(o.addAudio((0,F.serializeAudio)(t),i+1),this.getCurrentPlaylist().pushAudio((0,F.serializeAudio)(t),i+1)),this.saveStateCurrentPlaylist()}else{const i=n.AudioUtils.getContextPlaylist(e);this._play(t,i.playlist,i.context)}const a=window.AudioPage&&window.currentAudioPage(e);if(a){const e=a.getPageCurrentPlaylist();e&&a.onUserAction(t,e)}}}on(e,t,i){(0,h.isArray)(t)||(t=[t]);const o=(...e)=>i(...e);for(const i of t)this.subscribers.push({context:e,et:i,cb:o});return()=>{this.subscribers=this.subscribers.filter((e=>e.cb!==o))}}off(e){this.subscribers=this.subscribers.filter((t=>t.context!==e))}connectEvents(){this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isActive&&this._muteProgressEvents&&(0,f.inArray)(e,[L.events.BUFFERED,L.events.PROGRESS])),this.eventBus.onAnyCallBack=(e,...t)=>this.onEvent(e,...t),this.subscribe(L.events.VOLUME,(()=>ce._lsSet(ce.LS_VOLUME,this._userVolume))),this.subscribe(L.events.PLAY_REQUESTED,(()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),ce._setTabIcon("play")})),this.subscribe(L.events.IMPL_PLAY,(()=>{this._sendStatusExport()})),this.subscribe(L.events.PLAY,(()=>{this.updateCurrentPlaying(!0),ce._setTabIcon("play")})),this.subscribe(L.events.PLAYLIST_CHANGED,(()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()}));var e=this;this.subscribe(L.events.PROGRESS,(0,o._)((function*(t,i,o){const s=e.getCurrentAudio(),a=(0,R.audioTupleToAudioObject)(s);if(e._listenedTime=o,n.AudioUtils.isPodcast(a))t&&o&&e._podcastUpdateState(a,t,o,n.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!e.ads.isActive){let t=e._impl.getCurrentProgress();if(vk.widget||ce._lsSet(ce.LS_PROGRESS,t),!vk.widget&&e._allowPrefetchNext&&t>=.8){const t=yield e.getNextAudio();t&&e._impl.isFullyLoaded()&&(e._allowPrefetchNext=!1,e._prefetchAudio(t))}}}))),this.subscribe(L.events.PAUSE,(()=>{this.updateCurrentPlaying(!0);const e=this.getCurrentAudio(),t=(0,R.audioTupleToAudioObject)(e);n.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),n.AudioUtils.PodcastsLogs.ACTION_PAUSE),ce._setTabIcon("pause")})),this.subscribe(L.events.SEEK,(e=>{const t=this.getCurrentAudio(),i=(0,R.audioTupleToAudioObject)(t);e.reason&&this.emitter.emit("seek",(0,s._)({},e,{progressTime:this.getCurrentProgressTime()})),n.AudioUtils.isPodcast(i)&&this._podcastUpdateState(i,this.getCurrentProgress(),this._impl.getPlayedTime(),n.AudioUtils.PodcastsLogs.ACTION_SEEK)})),this.subscribe(L.events.ENDED,(()=>{const e=this.getCurrentAudio(),t=(0,R.audioTupleToAudioObject)(e);n.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),n.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT),window.vk&&!window.vk.widget&&!window.vk.id&&(0,H.partConfigEnabled)("audio_unauth_preview_box")&&(this.stop(),V.Unauthorized.showMoreBox(null,0,Y.UnauthorizedSourceType.AUDIO))})),this.subscribe(L.events.AD_STARTED,(()=>{var e;const t=null==(e=this.ads.getCurrentAd())?void 0:e.id;t?this.emitter.emit("playAdv",{reason:re.AudioPlayerPlayAudioEventReason.Unknown,advId:t,progressTime:this.getCurrentProgressTime()}):pe("playAdv")})),this.subscribe(L.events.RADIOSTATION_FOLLOW,(e=>(0,Z.updateFaveStatusAfterFollow)(e,!0))),this.subscribe(L.events.RADIOSTATION_UNFOLLOW,(e=>(0,Z.updateFaveStatusAfterFollow)(e,!1)))}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,i,o){(0,f.inArray)(e,[L.events.PLAY,L.events.PLAY_REQUESTED,L.events.PAUSE])&&(this.subscribers=this.subscribers.filter((e=>!(e.context instanceof Element)||bodyNode.contains(e.context)))),(0,f.each)(this.subscribers||[],((s,a)=>{a.et===e&&a.cb(this.getCurrentAudio(),t,i,o)}))}notify(e,...t){this.eventBus.emit(e,...t)}addWithReplacePlaylists(e){const t=e.reduce(((e,t)=>(e[w.AudioPlaylist.getFullIdFromData(t)]=t,e)),{}),i={};this._playlists.forEach(((e,o)=>{const s=e.getFullId();if(t[s]){this._playlists.slice(o,1);const e=t[s];new w.AudioPlaylist(e),i[s]=!0}})),Object.keys(t).forEach((e=>{i[e]||new w.AudioPlaylist(t[e])}))}_sendPlayerErrorStats(e){const t=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!t)return;const{full_id:i}=t,o=(0,f.extend)({audio:i,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",o)}playLive(e,t){const i=this.getPlaylist(w.AudioPlaylist.TYPE_LIVE,vk.id,I.data[0]),o=this.getPlaylistQueue();i.mergeWith({live:e,hasMore:!1}),e=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},(0,f.extend)(t,{onDone:(e,t,s)=>{i.mergeWith({title:t&&t.title,list:[e]}),o.addAudio(e),this.playByButton({audio:e,livePlaylist:i,context:s})},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",(e=>{if(e.key===ce.LS_PREFIX+ce.LS_STATUS_EXPORT){const e=ce._lsGet(ce.LS_STATUS_EXPORT);this.setStatusExportInfo(e),cur.audioPage&&cur.audioPage.updateStatusExportControls()}}))}_sendStatusExport(){var e;const t=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!t)return;const i=this.statusSent?this.statusSent.split(","):[!1,0],o=(0,h.vkNow)()-parseInt(i[1]),s=t.accessKey,a=Boolean(this.isRepeatCurrentAudio())||Boolean(this.isRepeatAll())&&1===(null==(e=this.getPlaylistQueue())?void 0:e.length);if(this.hasStatusExport()&&!n.AudioUtils.isPodcast(t)&&(a||t.id!=i[0]||o>3e5)){const e=this.getCurrentPlaylist(),i=e?e.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:t.fullId,hash:vk.statusExportHash,top:i&&(i.top_audio||i.top)?1:0,access_key:s},{onFail:()=>!0}),0),this.statusSent=t.id+","+(0,h.vkNow)()}}saveStateCurrentPlaylist(){const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();if(vk.widget||!e||!t||(0,te.isArticleTts)(this._currentAudio))return;const i=this._getPreparePlayQueueForSaving(e,t);ce._lsSet(ce.LS_PL,i),ce._lsSet(ce.LS_SAVED,(0,h.vkNow)())}_getPreparePlayQueueForSaving(e,t){const i=e.asObject();i.type&&(i.type=w.AudioPlaylist.TYPE_TEMP);let o=this.getCurrentAudio(),a=Math.max(0,t.indexOfAudio(o));const l=(0,s._)({},i,{list:(0,f.clone)(t.list.slice(Math.max(0,a-100),a+300),!0),source:t.source});return(0,f.each)(l.list,(function(e,t){(0,z.isRadio)(t)||(t[n.AudioUtils.AUDIO_ITEM_INDEX_URL]="")})),JSON.stringify(l)}_saveStateCurrentAudio(){if(vk.widget)return;const e=this.getCurrentAudio();if(!e||(0,te.isArticleTts)(e))ce._lsSet(ce.LS_TRACK,null),(0,E.setCookie)("remixcurr_audio",null,1);else{const t=(0,f.clone)(e);(0,z.isRadio)(e)||(t[n.AudioUtils.AUDIO_ITEM_INDEX_URL]=""),ce._lsSet(ce.LS_TRACK,t),(0,E.setCookie)("remixcurr_audio",`${e[n.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[n.AudioUtils.AUDIO_ITEM_INDEX_ID]}`,1)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isActive)return!1;const i=(t=t||10)/n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()).duration;let o=this.getCurrentProgress()+(e?i:-i);o=Math.max(0,Math.min(1,o)),this.seekByButton(o)}setVolume(e,t=!1){const i=Math.min(1,Math.max(0,e));this._userVolume!==i&&(this._userVolume=i,this.notify(L.events.VOLUME,i)),this.implTaskManager.setVolume(i,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seekByButton(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?re.AudioPlayerSeekEventReason.TapBack:re.AudioPlayerSeekEventReason.TapForward})}seekBySlider(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?re.AudioPlayerSeekEventReason.SliderBack:re.AudioPlayerSeekEventReason.SliderForward})}seek(e){return this._seek({amount:e,reason:re.AudioPlayerSeekEventReason.Unknown})}_seek({amount:e,reason:t}){const i=this.getCurrentAudioData(),o=this.getCurrentProgressTime();this.implTaskManager.seek(e),this.notify(L.events.SEEK,{reason:t,audio:i,fromTime:o})}seekToTimeByButton(e,t){const i=this._seekTimeToAmount(e),o=i-this.getCurrentProgress();return this._seekToTime({amount:i,ref:t,reason:o<0?re.AudioPlayerSeekEventReason.TapBack:re.AudioPlayerSeekEventReason.TapForward})}seekToTime(e,t){return this._seekToTime({amount:this._seekTimeToAmount(e),ref:t,reason:re.AudioPlayerSeekEventReason.Unknown})}_seekToTime({amount:e,ref:t,reason:i}){const o=this.getCurrentAudio();if(!o)return 0;if(this._seek({amount:e,reason:i}),n.AudioUtils.isPodcast(o)){let e="";const i=n.AudioUtils.audioTupleToAudioObject(o);t&&(e=n.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(i,n.AudioUtils.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(i,progress,0,e)}return progress}_seekTimeToAmount(e){const t=this.getCurrentAudio();if(!t)return 0;let i=e/t[n.AudioUtils.AUDIO_ITEM_INDEX_DURATION];return i=Math.max(0,i),i=Math.min(i,1),i}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};const t=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);const i=this.getPlaylistQueue(),o=i.indexOfAudio(e);return o>=0?i.getAudioAt(o).then((e=>n.AudioUtils.audioTupleToAudioObject(e))):(this._currentUrlEnsure[e.fullId]||t.push(e.fullId+"_"+e.actionHash+"_"+e.urlHash),(()=>{let i;return!t.length&&this.currentEnsureUrlPromise?i=this.currentEnsureUrlPromise:(i=new Promise(((e,i)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=i,_e().then((()=>this.fetchAudioUrls(t))).then((t=>{this.ensureUrlReject=null,e(t)})).catch((o=>{switch(o){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(t).then((e=>this.fetchAudioUrls(e))).then(e).catch((()=>!0));break;case"no_audios":this.ensureUrlReject=null,i()}return!0}))})),this.currentEnsureUrlPromise=i),i.then((t=>(Array.isArray(t)&&t.forEach((t=>{if(e.fullId===(0,j.getAudioFullId)(t)){const i=(0,R.audioTupleToAudioObject)(t);e.url=i.url,e.ads=i.ads,e.flags=i.flags,e.extra=i.extra}})),e)))})())}fetchAudioUrls(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,i,o)=>{this.setStatusExportInfo(i),o&&this._podcastSaveData(o),(0,f.each)(e,((e,t)=>{t=n.AudioUtils.audioTupleToAudioObject(t);let i={};i[n.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,i[n.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,i[n.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,i[n.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,i),this._currentAudio&&(0,j.getAudioFullId)(this._currentAudio)===t.fullId&&(this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[n.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]})),t(e)},onFail:e=>(i(e),!0)})}))}fetchAudios(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{const o=[],s=this.getCurrentPlaylist().getAudiosList();if(!Array.isArray(e))return void i();const a=e.reduce(((e,t)=>(e[(0,j.getAudioFullId)(t)]=t,e)),{});for(let e=0;e<s.length;e++){const t=(0,j.getAudioFullId)(s[e]);if(a[t]){s[e]=a[t];const i=(0,R.audioTupleToAudioObject)(a[t]);o.push(`${i.fullId}_${i.actionHash}_${i.urlHash}`)}}t(o)}})}))}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!(0,H.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;if((0,I.domClosest)("_audio_row__tt",t.target))return(0,g.cancelEvent)(t);const i=(0,I.domClosest)("_audio_row",e),o=n.AudioUtils.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){const e=window.getSelection().getRangeAt(0);if(e){const{commonAncestorContainer:t}=e;if(t&&(0,I.domClosest)("_audio_row",t)===i&&e.startOffset!==e.endOffset)return!1}}if(t&&(0,I.hasClass)(t.target,"mem_link"))return nav.go((0,I.attr)(t.target,"href"),t,{navigateToUploader:!0}),(0,g.cancelEvent)(t);if((0,I.hasClass)(t.target,"_audio_row__title_inner")){if(n.AudioUtils.isPodcast(o))return(0,_.showPodcast)(i,o.fullId),(0,g.cancelEvent)(t);if(o.lyrics&&!o.isInAttach&&!(0,H.partConfigEnabled)("audio_use_web_new_version_lyrics"))return n.AudioUtils.toggleAudioLyrics(i,o),(0,g.cancelEvent)(t);if(o.hasTrackPage&&!o.isClaimed)return;(0,g.cancelEvent)(t)}if((0,I.hasClass)(t.target.parentNode,"audio_row__performers")){if((0,g.checkEvent)(t)||vk.widget)return!0;if(!(0,I.gpeByClass)("_ape_audio_item",t.target)){const e=(0,I.domData)(t.target,"performer");if(e)return n.AudioUtils.audioSearchPerformer(t.target,e,t),(0,g.cancelEvent)(t)}return!0}let s=cur.cancelClick||t&&((0,I.hasClass)(t.target,"audio_lyrics")||(0,I.domClosest)("_audio_duration_wrap",t.target)||(0,I.domClosest)("_audio_inline_player",t.target)||(0,I.domClosest)("audio_performer",t.target));const a=(0,I.hasClass)(t.target,"slider")||(0,I.domClosest)("slider",t.target),l=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===(0,I.geByClass1)("audio_inline_player_progress",i)||cur._sliderMouseUpNowEl===(0,I.geByClass1)("audio_inline_player_volume",i));if((a||l)&&(s=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,s)return!0;if(n.AudioUtils.isClaimedAudio(o)||o.isReplaceable){const e=n.AudioUtils.getAudioExtra(o).claim;if(e)return void((0,I.hasClass)(i,"no_actions")||o.isInEditBox||window.showAudioClaimWarning(o,e,n.AudioUtils.replaceWithOriginal.bind(n.AudioUtils,i,o)))}if(this.podcastSetActionRef(o,o.isPlaying?n.AudioUtils.PodcastsLogs.ACTION_PAUSE:n.AudioUtils.PodcastsLogs.ACTION_PLAY,"",i),o.isPlaying){var r;this.pauseByButton(),(0,ae.logSearchAudioClick)(ae.SearchClickActionMap.PAUSE,null==(r=o)?void 0:r.trackCode)}else{var d;const t=n.AudioUtils.getContextPlaylist(i),s=this.getPlaylistQueue();if((0,ae.logSearchAudioClick)(ae.SearchClickActionMap.PLAY,null==(d=o)?void 0:d.trackCode),s.shuffled&&window.AudioPage){const i=window.currentAudioPage(e),o=i&&i.getCurrentSection();(!i||!(o&&"current"===o&&("placeholder_audios_wrapper"===t.context||"autoplay"===t.context)))&&this.getPlaylistQueue().resetShuffle()}if(s.isAutoplaySupported&&"autoplay"===t.context?this.playAudioItem({audio:o.fullId,playlist:null,context:o.context}):(this.playAudioItem({audio:o.fullId,playlist:t.playlist,context:o.context||t.context}),cur.audioPage&&cur.audioPage.onUserAction(o,t.playlist)),this._specialProjectController){const e=(0,J.getSpecialProjectId)(o);e&&this._specialProjectController.tryModal(e,o.trackCode)}}n.AudioUtils.onRowOver(i,!1,!0)}playNextPlaylist(e,t,i){const o=this.getPlaylist(w.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();e?(e.pushAudio(o.getAudiosList()),t.addPlaylist(o)):(t.addPlaylist(o),this.setCurrentPlaylist(new w.AudioPlaylist(o)),t.getAudioAt(0).then((e=>{e&&(this.setCurrentAudio(e),this.notify(L.events.UPDATE),this.notify(L.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.playList({audio:e.fullId,playlist:o}))}))),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}))}setNextPlaylist(e,t,i){const o=this.getPlaylist(w.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{var e;const t=this.getCurrentPlaylist(),i=this.getPlaylistQueue(),s=o.getAudiosList(),a=this._currentAudio?i.indexOfAudio(this._currentAudio):-1;var l;const n=this._currentAudio&&null!=(l=null==(e=t)?void 0:e.indexOfAudio(this._currentAudio))?l:-1;i.addAudio(s,a+1),t?t.pushAudio(s,n+1):(this.setCurrentPlaylist(new w.AudioPlaylist(o)),i.getAudioAt(0).then((e=>{if(e&&(this.setCurrentAudio(e),this.notify(L.events.UPDATE),this.notify(L.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),!this.isPlaying())){const[t,i]=e,o=`${i}_${t}`;this._play(o,this._currentPlaylist)}})))}))}playPlaylist(e,t,i,o,s){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,H.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;this.playNextInPlaylist(e,t,i,o,{shuffled:s,preDoPlay:e=>{s&&(e.shuffled&&e.resetShuffle(),e.shuffle(!0,!0),cur.audioPage&&cur.audioPage.updateShuffleButton())}})}playBlock(e,t,i,o,s,a="default"){this.playNextInPlaylist(e,t,i,o,{type:s,trackType:a,shuffled:!1})}playNextInPlaylist(e,t,i,o,s={}){const a=this.getCurrentPlaylist(),l=this.getPlaylist(s.type||w.AudioPlaylist.TYPE_PLAYLIST,e,t,i),n=this.getPlaylistQueue();if(l.setContext(o),a&&a.getId()===l.getId()&&this.isPlaying()&&!s.shuffled)this.pauseByButton();else{let e=!1;const t=()=>{e||(n.setSortedQueue(l.getAudiosList()),e=!0,s.shuffled&&this.setCurrentPlaylist(l),s.preDoPlay&&s.preDoPlay(n),n.getFirstAudio().then((e=>{if(e){if(this._specialProjectController){const t=(0,J.getSpecialProjectId)(e);t&&this._specialProjectController.tryModal(t,e.trackCode)}this.playList({audio:e,playlist:l,context:o})}})))};if(l.getAudiosCount()&&!s.shuffled&&!l.isExpired())return void t(l);this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),l.load(0,t,null,s.trackType)}}_initPlayingContext(e){this._playingContext=e}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}resume({reason:e}={}){this.isPaused()&&this._playMarked({reason:e})}playByButton({audio:e,playlist:t,context:i}={}){var s=this;return(0,o._)((function*(){return s._playMarked({audio:e,playlist:t,context:i,reason:re.AudioPlayerPlayAudioEventReason.PlayButton})}))()}playAudioItem({audio:e,playlist:t,context:i}={}){var s=this;return(0,o._)((function*(){return s._playMarked({audio:e,playlist:t,context:i,reason:re.AudioPlayerPlayAudioEventReason.AudioButton})}))()}playList({audio:e,playlist:t,context:i}={}){var s=this;return(0,o._)((function*(){return s._playMarked({audio:e,playlist:t,context:i,reason:re.AudioPlayerPlayAudioEventReason.ListButton})}))()}playShuffledList({audio:e,playlist:t,context:i}={}){var s=this;return(0,o._)((function*(){return s._playMarked({audio:e,playlist:t,context:i,reason:re.AudioPlayerPlayAudioEventReason.MixAndPlayButton})}))()}resumeChannel({audio:e,playlist:t,context:i}={}){var s=this;return(0,o._)((function*(){return s._playMarked({audio:e,playlist:t,context:i,reason:re.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}))()}_playMarked({audio:e,playlist:t,context:i,seq:s,autoNext:a,reason:l}){var n=this;return(0,o._)((function*(){return n._play(e,t,i,s,a,l)}))()}play(e,t,i,s,a,l){var n=this;return(0,o._)((function*(){return n._play(e,t,i,s,a,l)}))()}_play(e,t,i,s,a,l){var r=this;return(0,o._)((function*(){if(l=null!=l?l:re.AudioPlayerPlayAudioEventReason.Unknown,cur.loggingOff)return;if(!r._impl)return;let d;r._seq=s,r._autoNext=a,r._prevAudio=r._currentAudio,((0,h.isObject)(e)||(0,h.isArray)(e))&&(d=e,(e=n.AudioUtils.audioTupleToAudioObject(e))&&(e=e.fullId));const _=r.getPlaylistQueue(),{isAutoplaySupported:u,isAutoplayEnabled:p}=_;let A=n.AudioUtils.audioTupleToAudioObject(r._currentAudio),g=r.getCurrentPlaylist();!e&&A&&(e=A.fullId);let y=!1,P=e&&A&&e==A.fullId;const E=(0,o._)((function*(i){if(r.mediaFocusChannel.start(),!P){const e=p&&t&&t.getNoConsecutivePlay();i&&t&&(e?yield _.addNoConsecutivePlaylist(t,i):yield _.addPlaylist(t)),t&&!e&&_.list.length<t.getAudiosCount()&&_.addAudio(t.getAudiosList()),t&&t.getType()===w.AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(i)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),A&&n.AudioUtils.isPodcast(A)&&r.isPlaying()&&r._podcastUpdateState(A,r.getCurrentProgress(),r._impl.getPlayedTime(),n.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),r.ads.isActive||r.ads.deinit()}if(ce._sendLCNotification(),P){if(r.ads.isActive){var o;const e=null==(o=r.ads.getCurrentAd())?void 0:o.id;r.ads.resume(),e?r.emitter.emit("playAdv",{reason:l,advId:e,progressTime:r.getCurrentProgressTime()}):pe("playAdv")}else if(!r.isPlaying()){var d;(null==(d=_.autoplayQueue)?void 0:d.source)||_.setAutoplaySourceFromPlaylist(t),r.setIsPlaying(!0),r.implTaskManager.clearAllTasks(),r.emitter.emit("playAudio",{reason:l,audio:(0,k.toTrackedAudioData)(A),progressTime:r.getCurrentProgressTime()}),r._implSetUrl(A).then((()=>{r._implPlay(),r._updatePlaybackRate(),r.implTaskManager.setVolume(r.getVolume(),!!r._impl.getCurrentProgress()),n.AudioUtils.isPodcast(i)&&r._podcastUpdateState(n.AudioUtils.audioTupleToAudioObject(i),r.getCurrentProgress(),r._impl.getPlayedTime())})).catch((()=>{}))}}else if(e&&i){const t=r.getCurrentAudioData(),o=(0,re.getStopReasonForPlayReason)(l);if(t&&o&&!P&&r.emitter.emit("stopAudio",{reason:o,audio:t,progressTime:r.getCurrentProgressTime()}),!a&&A&&r._impl.setUrl(U.SILENCE),r.setCurrentAudio(i),r.setIsPlaying(!0),r.ads.isActive){var u;const e=null==(u=r.ads.getCurrentAd())?void 0:u.id;r.ads.resume(),e?r.emitter.emit("playAdv",{reason:l,advId:e,progressTime:r.getCurrentProgressTime()}):pe("playAdv")}else r.notify(L.events.PLAY_REQUESTED,!0,parseInt(s),a),r._muteProgressEvents=!0,r.implTaskManager.clearAllTasks(),r._impl.preparePlay&&r._impl.preparePlay(),r.ads.startPlay(n.AudioUtils.audioTupleToAudioObject(i),(()=>r.playAfterAd(l))),r.notify(L.events.PROGRESS,0);r.updateCurrentPlaying(!0),A&&r.scrollToCurrentPlaying(A.fullId,e)}}));if(u&&"autoplay"===i||(0,h.isArray)(d)&&"autoplay"===d[n.AudioUtils.AUDIO_ITEM_INDEX_CONTEXT]){const t=_.autoplayQueue.getAudioById(e);if(t)return r.eventBus.emit(L.AudioPlayerEventType.PLAY_TRACK_FROM_AUTOPLAY,t),E(t)}if(t?g&&(y=P?t.getFullId()===g.getSelf().getFullId():t===g.getSelf()||t===g):(t=g,y=!0),y||i||(0,c.debugLog)("New playlist play init without context"),i&&(r._prevContext=r._playingContext,r._initPlayingContext(i)),!y){if(r._cleanUpPlaylists(),r._currentPlaylist)if(r._prevPlaylist=r._currentPlaylist,r._prevAudio=r._currentAudio,p&&t.getNoConsecutivePlay()){t.getAudio(e);const i=Array.isArray(d)?d:t.getAudio(e);yield _.addNoConsecutivePlaylist(t,i)}else yield _.setSortedQueueByPlaylist(t);r.setCurrentPlaylist(new w.AudioPlaylist(t)),r.notify(L.events.PLAYLIST_CHANGED)}if(!(_.indexOfAudio(e)>=0)){var f;let i=null==(f=t)?void 0:f.getAudio(e);!i&&d&&(i=d),_.addAudio(i)}E(yield _.getAudio(e))}))()}playAfterAd(e){this.notify(L.events.CURRENT_CHANGED);const t=this.getCurrentAudio();t&&(this.emitter.emit("playAudio",{reason:e,audio:(0,k.toTrackedAudioData)(t),progressTime:this.getCurrentProgressTime()}),this.notify(L.events.UPDATE),this._implSetUrl(t).then((()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*ce.UNAUTH_FADE_TIME),this._triggerTNSPixel()})).catch((()=>(this._pauseAudio({reason:re.AudioPlayerPauseAudioEventReason.Unknown}),!0))))}instantPlay(e,t,i){const o=!r.browser.safari&&t&&t.shiftKey;this.playPlaylist(vk.id,w.AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",o),(0,A.statlogsValueEvent)("client_header_play_button",o?"shuffle":"play"),setTimeout((()=>{(0,I.addClass)(e,"loading")}),400)}_prefetchAudio(e){(e=n.AudioUtils.audioTupleToAudioObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){return this._currentPlaylist}setCurrentPlaylist(e){this._currentPlaylist=e}getPlaylists(){return(0,f.clone)(this._playlists)}pauseByButton(){return this._pauseAudio({reason:re.AudioPlayerPauseAudioEventReason.PauseButton})}pauseByMediaSession(){return this._pauseAudio({reason:re.AudioPlayerPauseAudioEventReason.MediaSession})}pauseByChangeChannel(){return this._pauseAudio({reason:re.AudioPlayerPauseAudioEventReason.ChannelAutoPause})}pause(){return this._pauseAudio({reason:re.AudioPlayerPauseAudioEventReason.Unknown})}_pauseAudio({reason:e}){const t=this.getCurrentAudioData(),i=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){var s;const t=null==(s=this.ads.getCurrentAd())?void 0:s.id;this.ads.resume(),t?this.emitter.emit("pauseAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):pe("pauseAdv")}else this.emitter.emit("pauseAudio",{reason:e,audio:t,progressTime:i})}_stopCurrentAudio({reason:e}){const t=this.getCurrentAudioData(),i=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){var s;const t=null==(s=this.ads.getCurrentAd())?void 0:s.id;t?this.emitter.emit("stopAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):pe("stopAdv")}else this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:i})}stop(e){if(this.setIsPlaying(!1),this.ads.isActive){var t;const i=null==(t=this.ads.getCurrentAd())?void 0:t.id;this.ads.stop(),e&&(i?this.emitter.emit("stopAdv",{reason:e,advId:i,progressTime:this.getCurrentProgressTime()}):pe("stopAdv"))}else{const t=this.getCurrentAudioData();t&&e&&this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:this.getCurrentProgressTime()}),this._impl.stop()}this.notify(L.events.STOP),this.switchConnection.emit("stop"),this.mediaFocusChannel.stop()}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e,this.notify(L.events.PLAYER_IS_PLAYING_CHANGED,e)}isPaused(){return this._isPaused}setIsPaused(e){this._isPaused=e}getCurrentAudio(){if(this._currentAudio&&!this._currentAudio[G.EAudioTupleIndex.CONTEXT]){const e=this._getPlayingContext();e&&(this._currentAudio[G.EAudioTupleIndex.CONTEXT]=e)}return this._currentAudio}setCurrentAudio(e){this._currentAudio=e}getCurrentAudioData(){return(0,k.toTrackedAudioData)(this.getCurrentAudio())||null}getPreviousAudio(){return this._prevAudio}playNextByButton(e){this._playNextMarked({auto:e,reason:re.AudioPlayerPlayAudioEventReason.NextButton})}playNextByMediaSession(e){this._playNextMarked({auto:e,reason:re.AudioPlayerPlayAudioEventReason.NextMediaSession})}playPrevByButton(){this._playPrevMarked({reason:re.AudioPlayerPlayAudioEventReason.PrevButton})}playPrevByMediaSession(){this._playPrevMarked({reason:re.AudioPlayerPlayAudioEventReason.PrevMediaSession})}_playNextMarked({auto:e,reason:t}){this.playNext(e,t)}_playPrevMarked({reason:e}){this.playPrev(e)}playNext(e,t){this._playNext(1,e,t)}playPrev(e){this._playNext(-1,void 0,e)}_playNext(e,t,i){if(this.ads.isActive)return;const s=this.getCurrentAudio(),a=this.getCurrentPlaylist(),l=this.getPlaylistQueue(),r=(e,o)=>{n.AudioUtils.isClaimedAudio(e)||this._playMarked({audio:e,playlist:a,context:!1,seq:o,autoNext:t,reason:i})};if(s&&a)if(e>0){var d=this;l.getNextAudio(s,{ignoreClaimed:!0,repeat:this.isRepeatAll()&&!a.isLoadable()}).then((0,o._)((function*(e){if(e)r(e,1);else if(a.isLive())d._muteProgressEvents=!0,a.fetchNextLiveAudio((e=>{if(e){const t=d.getPlaylistQueue(),i=t.indexOfAudio(e);i>=0?t.moveAudio(i,t.length-1):t.addAudio(e)}r(e)}));else if(a.isLoadable()){const e=yield a.fetchNextAudio();if(e){d.getPlaylistQueue().addAudio(e),d.getCurrentPlaylist().pushAudio(e)}r(e)}else l.getFirstAudio(!0).then((t=>{if(t){if(e=t,!d.isRepeatAll()){if(l.indexOfAudio(s)+1===l.length)return d.implTaskManager.seekImmediate(0),d.stop(),void(n.AudioUtils.isClaimedAudio(e)||(d.setCurrentAudio(e),d._implSetUrl(d._currentAudio),d.updateCurrentPlaying(!0),d.notify(L.events.CURRENT_CHANGED),d.notify(L.events.UPDATE)))}r(e,1)}}))})))}else{l.indexOfAudio(this._currentAudio)<1||this._impl.getCurrentTime()>5?this.seekByButton(0):l.getPrevAudio(s,{ignoreClaimed:!0}).then((e=>{e?r(e,-1):this.seekByButton(0)}))}}getPrevAudio(){var e=this;return(0,o._)((function*(){const t=e.getPlaylistQueue(),i=e.getCurrentAudio();return i?t.getPrevAudio(i,{ignoreClaimed:!0,repeat:e.isRepeatAll()}):t.getLastAudio(!0)}))()}getNextAudio(){var e=this;return(0,o._)((function*(){const t=e.getPlaylistQueue(),i=e.getCurrentAudio();return i?t.getNextAudio(i,{ignoreClaimed:!0,repeat:e.isRepeatAll()}):t.getFirstAudio(!0)}))()}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,i,o,s){const a=ce._podcastGetStates(),l=Math.round(e.duration*t);a[e.fullId]={t:(0,h.vkNow)(),position:l},ce._podcastSetStates(a),o&&this._podcastSendLogs(o,e,i,l,s)}_podcastSendLogs(e,t,i,o,s){if(!t||!e||!n.AudioUtils.isPodcast(t)||cur._podcastsActionId&&cur._podcastsActionId[e]&&this._podcastsActionLastId[e]===cur._podcastsActionId[e])return;const a=this._podcastsActionRef[t.fullId]||{},l=a[e]||{};n.AudioUtils.PodcastsLogs.log(e,(0,f.extend)({audio:t,position:o,listen:i},l,s||{})),delete a[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}podcastSetActionRef(e,t,i,o){e=n.AudioUtils.audioTupleToAudioObject(e),t&&n.AudioUtils.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:i,refEl:o},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=(0,h.irand)(0,1e6))}toggleRadio(e,t){const i=this.getPlaylist(w.AudioPlaylist.TYPE_RADIO,t,w.AudioPlaylist.RADIO_PLAYLIST_ID),o=i.getAudiosList().find((t=>t[G.EAudioTupleIndex.ID]===e));o&&(this.isPlaying()&&(0,z.isRadio)(this._currentAudio)&&o[G.EAudioTupleIndex.ID]===this._currentAudio[G.EAudioTupleIndex.ID]?this.pauseByButton():this.playAudioItem({audio:o,playlist:i}))}_podcastCleanStates(){const e=ce._podcastGetStates();let t=!1;return(0,f.each)(e,((i,o)=>{Date.now()-o.t>2419200&&(delete e[i],t=!0)})),t&&ce._podcastSetStates(e),e}_podcastSaveData(e){const t=ce._podcastGetStates();(0,f.each)(e,((e,i)=>{const o=i.state;if(!o)return;const s=+o[1];(!t[e]||!t[e][1]||s&&s>t[e][1])&&(t[e]={position:+o[0],t:Date.now()})})),ce._podcastSetStates(t)}_podcastRestoreState(){const e=n.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!n.AudioUtils.isPodcast(e))return 0;let t=0;if(cur.podcastSeekToTime)t=this._seekToTime({amount:cur.podcastSeekToTime,ref:cur.podcastSeekToTimeRef}),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef;else{t=((ce._podcastGetStates()[e.fullId]||{}).position||0)/e.duration,t&&t<1&&this.implTaskManager.seek(t)}return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!n.AudioUtils.isPodcast(this._currentAudio)&&n.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){const e=n.AudioUtils.isPodcast(this._currentAudio)||n.AudioUtils.isArticleTts(this._currentAudio),t=!this.ads.isActive&&e?ce.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(e){const t=ce._lsGet(ce.LS_PODCASTS)||de;let i=t.rate||1;e?i-=ce.PLAYBACK_RATE_STEP:i+=ce.PLAYBACK_RATE_STEP,!e&&i>ce.PLAYBACK_RATE_MAX?i=1:e&&i<1&&(i=ce.PLAYBACK_RATE_MAX),t.rate=i,ce._lsSet(ce.LS_PODCASTS,t),de=t,this._updatePlaybackRate()}playAudio(e){let t=w.AudioPlaylist.TYPE_TEMP;(0,te.isArticleTts)(e)&&(t=w.AudioPlaylist.TYPE_ARTICLE_TTS);const i=new w.AudioPlaylist(t);i.mergeWith({list:[e]}),this.playAudioItem({audio:e,playlist:i})}updateAudioDislikeStatus(e,t){var i,o;if(!((0,H.partConfigEnabled)("dislikes_web_enabled")||(0,H.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const s=null==(o=this.getCurrentPlaylist())||null==(i=o.getAudiosList())?void 0:i.find((t=>n.AudioUtils.getAudioFullId(t)===e));if(!s)return;let a={dislike:t};Boolean(s[G.EAudioTupleIndex.EXTRA])&&(a=n.AudioUtils.mergeAudioExtra(n.AudioUtils.getAudioExtra(s[G.EAudioTupleIndex.EXTRA]),a)),s[G.EAudioTupleIndex.EXTRA]=a,Boolean(this._currentAudio)&&n.AudioUtils.getAudioFullId(this._currentAudio)===e&&(this._currentAudio[G.EAudioTupleIndex.EXTRA]=a,this._saveStateCurrentAudio()),this.saveStateCurrentPlaylist(),this.notify(L.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE)}constructor(){if(this.ensureUrlReject=null,this.playerListener=null,this.mediaFocusChannel=l.MediaFocus.ensure().createChannel("audio"),this._currentAudio=null,this._isPlaying=!1,this._isPaused=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,this._specialProjectController=(0,H.partConfigEnabled)("audio_special_project_web")?ie.SpecialProjectController.init(oe.showWebSpecialProjectModal):null,vk.isBanned)return;n.AudioUtils.debugLog("Player creation"),this.emitter=(0,re.createAudioPlayerEventEmitter)(),this.eventBus=new S.EventBus,this.audioPlayersSwitch=le.AudioPlayersSwitch.ensure(),this.switchConnection=this.audioPlayersSwitch.connect({resume:({reason:e})=>{this.resume({reason:e})},pause:()=>{this.pauseByChangeChannel()},stop:()=>{this.stop()}}),this._playlistQueue=new v.PlaylistQueue(new $.FetchService,this.eventBus);const e=new C.WebPlayerAdapter(this);(0,H.partConfigEnabled)("audio_player_stats_web")&&(this.playerListener=new ne.AudioPlayerStatsListener(e)),this.stats=new T.AudioStats(e),this.lyrics=new q.AudioLyricsProvider,this.ads=new O.AudioAds(this,ce.getVersion()),this.connectEvents(),(0,N.connectListenQueue)(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),(0,m.onDomReady)((()=>{const e=()=>{try{this.restoreState()}catch(e){ce._lsRemove(ce.LS_TRACK),ce._lsRemove(ce.LS_PL)}n.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()};window.ap?e():window.addEventListener(ue,e,{once:!0})}));const t=new Q.WebMediaSessionAdapter(this);new X.AudioMediaSession(t,this.mediaFocusChannel.mediaSession).init(),(0,H.partConfigEnabled)("audio_mobx")&&(0,a.makeObservable)(this,{_isPlaying:a.observable,_isPaused:a.observable,_currentAudio:a.observable,_currentPlaylist:a.observable,setIsPlaying:a.action,setIsPaused:a.action,setCurrentAudio:a.action,setCurrentPlaylist:a.action})}}function he(e,t,i){let o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),o.fillStyle=i;for(let e=0;e<4;e++){let i=2+12*t[e];o.fillRect(13+4*e,12-i+14,2,i)}}function pe(e){console.warn(`Missed stat event ${e}`)}ce.UNAUTH_FADE_TIME=.8,ce.LS_VER="v20",ce.LS_KEY_PREFIX="audio",ce.LS_PREFIX=ce.LS_KEY_PREFIX+"_"+ce.LS_VER+"_",ce.LS_STATUS_EXPORT=ce.LS_KEY_PREFIX+"_status_export",ce.LS_VOLUME="vol",ce.LS_PL="pl",ce.LS_TRACK="track",ce.LS_SAVED="saved",ce.LS_PROGRESS="progress",ce.LS_PODCASTS="podcasts",ce.LS_DURATION_TYPE="dur_type",ce.LS_UUID="uuid",ce.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",ce.LS_SHOW_HQ_LABEL="_audio_show_hq_label",ce.PLAYBACK_RATE_STEP=.5,ce.PLAYBACK_RATE_MAX=r.browser.safari?2:3,ce.tabIcons={def:"/images/icons/favicons/fav_logo.ico",play:"/images/icons/favicons/fav_play.ico",pause:"/images/icons/favicons/fav_pause.ico"}},97877:(e,t,i)=>{i.d(t,{followOwner:()=>a});var o=i(92450),s=i(49957);function a(e,t){window.ajax.post("/al_audio.php?act=follow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,s.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_FOLLOW)}})}},37392:(e,t,i)=>{i.d(t,{unfollowOwner:()=>a});var o=i(92450),s=i(49957);function a(e,t){window.ajax.post("/al_audio.php?act=unfollow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,s.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_UNFOLLOW)}})}},64538:(e,t,i)=>{i.d(t,{getAudioTrackCodeFromPlaylist:()=>s});var o=i(11010);function s(e,t){return a.apply(this,arguments)}function a(){return(a=(0,o._)((function*(e,t){var i,o;if(!e)return t.trackCode;return(null==(o=yield e.getAudioIds())||null==(i=o.find((e=>{var i;return(null==(i=e)?void 0:i.audio_raw_id)===t.fullId})))?void 0:i.track_code)||t.trackCode}))).apply(this,arguments)}},62624:(e,t,i)=>{i.d(t,{RadiostationEventsHandling:()=>n});var o=i(42885),s=i(49957),a=i(77362),l=i(11973);class n{connectFollowingEvents(){this.tq.setInteractiveHandler("Music/follow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,a.followRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{e.target instanceof HTMLElement&&(e.target.dataset.taskClick="Music/unfollow_radiostation")}))}))}connectUnFollowingEvents(){this.tq.setInteractiveHandler("Music/unfollow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,l.unfollowRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{e.target instanceof HTMLElement&&(e.target.dataset.taskClick="Music/follow_radiostation")}))}))}connectPlayToggleEvent(){this.tq.setInteractiveHandler("Music/toggle_radio_play",(({payload:e})=>{if(e.dataAttrs){const{stationId:t,playlistOwnerId:i}=e.dataAttrs;if(!t||!i)return;const o=(0,s.getAudioPlayer)();o&&o.toggleRadio(parseInt(t,10),parseInt(i,10))}}))}constructor(){try{this.tq=(0,o.tq)()}catch(e){return}this.connectFollowingEvents(),this.connectUnFollowingEvents(),this.connectPlayToggleEvent()}}},77362:(e,t,i)=>{i.d(t,{followRadiostation:()=>n});var o=i(94271),s=i(49957),a=i(92450),l=i(4801);function n(e,t){const i=new o.FetchService,n=l.AudioPageProxy.ensure().emitter;return i.followRadiostation(e,t).then((t=>{if(t){const t=(0,s.getAudioPlayer)();t&&t.notify(a.events.RADIOSTATION_FOLLOW,e),n.emit(l.AudioPageEventType.RadioStationFollowed)}}))}},11973:(e,t,i)=>{i.d(t,{unfollowRadiostation:()=>l});var o=i(94271),s=i(49957),a=i(92450);function l(e,t){return(new o.FetchService).unfollowRadiostation(e,t).then((t=>{if(t){const t=(0,s.getAudioPlayer)();t&&t.notify(a.events.RADIOSTATION_UNFOLLOW,e)}}))}},43418:(e,t,i)=>{i.d(t,{updateFaveStatusAfterFollow:()=>_});var o=i(59672),s=i(92414),a=i(70027),l=i(49343),n=i(87866),r=i(49957),d=i(92450);function _(e,t){const i=(0,r.getAudioPlayer)();i.getPlaylistsByType(a.AudioPlaylist.TYPE_RADIO).forEach((i=>{i.getAudiosList().forEach((i=>{i[s.EAudioTupleIndex.ID]===e&&u(i,t)}))})),Array.from(document.querySelectorAll(".audio_player_radio_station._audio_page_player")).forEach((i=>{const o=(0,l.getAudioFromEl)(i);o&&o[s.EAudioTupleIndex.ID]===e&&(u(o,t),i.dataset.audio=JSON.stringify(o))}));const n=i.getCurrentPlaylist();n&&n.getType()===a.AudioPlaylist.TYPE_RADIO&&i.saveStateCurrentPlaylist();const _=i.getCurrentAudio();(0,o.isRadio)(_)&&(u(_,t),i._saveStateCurrentAudio(),_[s.EAudioTupleIndex.ID]===e&&i.notify(d.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,t))}function u(e,t){const i=(0,n.getAudioExtra)(e);i&&i.fave!==t&&(i.fave=t,e[s.EAudioTupleIndex.EXTRA]=i)}},7122:(e,t,i)=>{i.d(t,{copyAudioLink:()=>a});var o=i(11010),s=i(9274);function a(e){return l.apply(this,arguments)}function l(){return(l=(0,o._)((function*(e){const t=function(e){if(!new RegExp(/^\/?audio\-?\d+\_\-?\d+(\_[A-Za-z\d]+)*$/).test(e))return console.error("Invalid audio URL for audio pathname",e),null;try{return new URL(e,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio pathname",e),null}}(e);if(t)return(0,s.copyToClipboard)(t)}))).apply(this,arguments)}},35716:(e,t,i)=>{i.d(t,{copyAudioLinkByIdentity:()=>l});var o=i(11010),s=i(9274),a=i(99813);function l(e,t){return n.apply(this,arguments)}function n(){return(n=(0,o._)((function*(e,t){var i,o,l;if(!(null==(i=e)?void 0:i.id)||!(null==(o=e)?void 0:o.ownerId))return void console.error("Invalid AudioIdentity object",e);const n=function(e){const t=(0,a.getAudioAccessId)(e),i=`audio${t}`;try{return new URL(i,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio identity",e),null}}({id:e.id,ownerId:e.ownerId,accessKey:(null==(l=e)?void 0:l.accessKey)||t||void 0});return n?(0,s.copyToClipboard)(n):void 0}))).apply(this,arguments)}},91862:(e,t,i)=>{i.d(t,{toggleAddAudio:()=>l});var o=i(44142),s=i(30399),a=i(48041);function l(e,t,i=(()=>{}),l=""){if((0,a.partConfigEnabled)("add_audio_to_effector_web")){const s=(0,o.ensureAudioPageService)();s.setUserId(window.vk.id),s.toggleAddAudioFx({audioEl:e,audio:t,onSuccess:i,audioRef:l})}else(0,s.toggleAddAudioLegacy)(e,t,i,l)}},93036:(e,t,i)=>{i.d(t,{unLogF:()=>o});const o=e=>Math.log(1+34*e)/Math.log(35)},29633:(e,t,i)=>{i.d(t,{PreviewAudioPlayer:()=>T,PreviewAudioPlayerNotification:()=>v});var o=i(11010),s=i(34788),a=i(68922),l=i(81044),n=i(48041),r=i(11749),d=i(63517),_=i(98022),u=i(92450),c=i(35539),h=i(51508),p=i(45701),A=i(96349),g=i(34892),y=i(49254),P=i(86591),E=i(13613);let f;const w=1.5,m={from:0,to:0},I={url:"",clip:m},C=e=>e/1e3,v={start:"audio_preview_start",stop:"audio_preview_stop",pause:"audio_preview_pause"};class T{get events(){return this.emitter.listenable}getCurrentPreview(e){return c.audioPreviewsService.$audioPreviewEntities.getState()[e]||I}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{var e;if(!this.playing&&(null==(e=this.currentAudio)?void 0:e.url)&&this.pausedByVideo){if(Date.now()-this.pausedByVideo<18e4){var t;const{url:e}=this.getCurrentPreview((null==(t=this.currentAudio)?void 0:t.url)||"");this.play(e,this.volume,E.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByVideo=null}})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,g.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{if(!this.playing&&this.pausedByStories){if((0,g.vkNow)()-this.pausedByStories<18e4){var e;const{url:t}=this.getCurrentPreview((null==(e=this.currentAudio)?void 0:e.url)||"");this.play(t,this.volume,E.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByStories=null}}))):console.log("[PreviewAudioPlayer]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return f||(f=new T),f}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}implPlay(e){var t=this;return(0,o._)((function*(){t.impl.preparePlay(),yield t.taskManager.setUrl(e),t.taskManager.clearAllTasks(),yield t.taskManager.play(),t.sendLCNotification(v.start),t._playing=!0}))()}seek(e){var t=this;return(0,o._)((function*(){const i=t.getPlayingAudio(),o=t.getCurrentProgressTime(),s=t.getCurrentProgress(),a=e-s;yield t.taskManager.seek(e),i&&t.emitter.emit("seek",{reason:a<0?E.AudioPlayerSeekEventReason.SliderBack:E.AudioPlayerSeekEventReason.SliderForward,audio:i,fromTime:o,progressTime:t.getCurrentProgressTime()})}))()}fallbackPlay(e,t){var i=this;return(0,o._)((function*(){const[o,s]=e.split("_");let a=t||"";if(!a){var l;const t=(0,A.ensureAudiosService)();yield t.fetchAudiosFx([{ownerId:+o,id:+s}]);var n;a=null!=(n=null==(l=t.$audioEntities.getState()[e])?void 0:l.url)?n:""}const r=i.getCurrentPreview(`${o}_${s}`).clip.from;yield i.implPlay(a),i.fadeIn(1500),i.seek(r/1e3)}))()}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){var e;const t=null==(e=this.currentAudio)?void 0:e.fullId;if(t){const e=this.getCurrentPreview(t);if(!e)return 0;const{clip:i}=e;return C(i.to-i.from)}return 0}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}stop(e){const t=this.getPlayingAudio(),i=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(v.stop),this.switchConnection.emit("stop"),t&&this.emitter.emit("stopAudio",{audio:t,reason:null!=e?e:E.AudioPlayerStopAudioEventReason.Unknown,progressTime:i})}resume(e){var t,i;if(!this._paused||!(null==(t=this.currentAudio)?void 0:t.url))return;const{url:o}=this.getCurrentPreview((null==(i=this.currentAudio)?void 0:i.url)||"");this.play(o,this.volume,e)}pause(e){var t=this;return(0,o._)((function*(){const i=t.getPlayingAudio(),o=t.getCurrentProgressTime();yield t.taskManager.setVolume(0,!0),yield t.taskManager.pause(),t.sendLCNotification(v.pause),i&&t.emitter.emit("pauseAudio",{audio:i,reason:null!=e?e:E.AudioPlayerPauseAudioEventReason.Unknown,progressTime:o})}))()}play(e,t,i){var s=this;return(0,o._)((function*(){var o;s.volume=t||p.DEFAULT_VOLUME,s.taskManager.setVolume(0,!1),s.resetFailedAudio();const{url:a,clip:l}=s.getCurrentPreview(e);var n;if(s._timelinePosition=null!=(n=null==(o=l)?void 0:o.from)?n:0,a){s.seek(0),yield s.implPlay(a),s.fadeIn(1500);const e=s.getPlayingAudio();e&&s.emitter.emit("playAudio",{audio:e,reason:null!=i?i:E.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:s.getCurrentProgressTime()})}}))()}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,P.toTrackedAudioData)(e);if(!t)return null;if(t.type!==a.AudioType.MusicTrack)throw new Error(`Invalid preview audio type: ${t.type}`);return(0,s._)({},t,{type:a.AudioType.MusicSnippet})}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){var e;const t=(null==(e=this.getPlayingAudio())?void 0:e.duration)||0;return this.getCurrentProgress()*t*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=new h.Emitter,this._playing=!1,this._paused=!1,this.failedAudio=null,this.fading=!1,this._playbackDuration=0,this._timelinePosition=0,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.switchConnection=y.AudioPlayersSwitch.ensure().connect({resume:()=>{this.resume(E.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(u.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this._paused=!0,this.fading=!1,this.failedAudio||(this.notify(u.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this._paused=!1,this.fading=!1,this._playbackDuration=0,this.notify(u.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(u.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||this.notify(u.events.END_PREVIEW,this.currentAudio)},onFail:e=>{var t,i,o,s;if(this.failedAudio)return this.resetFailedAudio(),void this.stop(E.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;s=null==(t=this.currentAudio)?void 0:t.url;var a;this.stop(E.AudioPlayerStopAudioEventReason.Error);let l=null!=(a=null==(i=this.failedAudio)?void 0:i.fullId)?a:"";this.fallbackPlay(l,null==(o=this.failedAudio)?void 0:o.url)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const i=this.impl.getDuration();let o=m;this.listenedTime=t,this.currentAudio&&(o=this.getCurrentPreview(this.currentAudio.fullId).clip),this.failedAudio&&(o=this.getCurrentPreview(this.failedAudio.fullId).clip),i&&i-t<w&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const s=(o.to-o.from)/1e3,a=(l=e,n=i,Math.round(l*n));var l,n,r,d;if(this._playbackDuration=a,this._timelinePosition=(r=C(o.from),d=this._playbackDuration,r+d),this.currentAudio){const i=Math.round(C(o.from)+t);return void this.notify(u.events.PROGRESS_PREVIEW,e,i)}if(a&&a===this._playbackDuration)return;const _=a?a-o.from/100:0,c=_/s,h=Math.round(t);Math.round(C(o.from)-t);this.notify(u.events.PROGRESS_PREVIEW,c,h);_>o.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new _.EventBus,this.impl=new d.AudioPlayerHTML5(e),this.taskManager=new r.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,w),this.initEvents(),(0,n.partConfigEnabled)("audio_player_stats_web")&&new l.AudioPlayerStatsListener(this)}}},64118:(e,t,i)=>{i.d(t,{WebQueueListener:()=>s});var o=i(54504);class s extends o.QueueListener{connect(e){e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},((e,t)=>this.queueHandler(t))))}constructor(e){super(e)}}},61877:(e,t,i)=>{i.d(t,{voiceMessagePlayerLoader:()=>o});const o=()=>window.AudioMessagePlayer&&window.AudioMessagePlayer.loaded?Promise.resolve(window.AudioMessagePlayer):Promise.all([i.e(4927),i.e(9375)]).then(i.bind(i,44679)).then((()=>window.AudioMessagePlayer))},61404:(e,t,i)=>{i.r(t);var o=i(78801),s=i(63361);const a={isSupport(){return!(!window.AudioContext||!(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))},getAvailableMicrophones(){return o.AudioRecorder.isSupport()?o.AudioRecorder.getAvailableMicrophones():Promise.resolve([])},newRecorder(){return window.Promise||(window.Promise=Promise),new o.AudioRecorder},resample(e,t,i){return(0,s.fastResample)(e,t,i)},createVisualization:i(34713).createVisualization};window.Speech=a},44679:(e,t,i)=>{i.r(t);var o=i(48712),s=i(96041),a=i(82753),l=i(63361),n=i(39586);const r="audio-msg-track--transcriptToggle",d="audio-msg-track--transcript_on";let _=null;function u(e){let t=(0,a.geByClass)("audio-msg-track--wave-wrapper",e),i=0;for(let e=0;e<t.length;e++){try{i=parseInt(window.getComputedStyle(t[e],null).getPropertyValue("width"))}catch(o){i=parseInt(t[e].currentStyle.width)}if(i>0)break}return i}function c(e,t){t=Math.round(t),e.length!=t&&(e=(0,l.fastResample)(e,t));let i="",o=0;for(let t=0;t<e.length;t++)o=Math.floor(10*Number(e[t])*.95),0==o&&(o=.5),i+="M"+(3*t+1)+","+(10-o)+"v"+2*o+"Z";return`<svg class="audio-msg-track--wave" width="${3*e.length}px"><path d="${i}"></path></svg>`}function h(){let e=(0,a.geByClass)("audio-msg-track");for(let t=0;t<e.length;t++){let i=(0,a.attr)(e[t],"data-wave");(0,a.hasClass)(e[t],"audio-msg-player")&&t>0&&(i=(0,a.attr)(e[t-1],"data-wave"));let o=u(e[t]);if(i&&o){i=i.split(",");let s=(0,a.geByClass)("audio-msg-track--wave",e[t]),l=c(i,o/3);for(let e=0;e<s.length;e++){let t=(0,a.ce)("div",{innerHTML:l}).firstChild;s[e].parentNode.replaceChild(t,s[e])}}}}function p(){if(!_){const e='<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button>'+(0,n.getTemplate)("sImAudioMsgPlayerASRToggle")+'<div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>',t="audio-msg-track--with-asr-toggle",i="audio-msg-track--shortened";_=new o.VoiceMessagePlayer({onListened:e=>{window.AudioMessagePlayer.events.emit("listened",e)},voiceMessageHTML:e,onInit:(e,o)=>{var s,a;(e.classList.contains(t)&&o.classList.add(t),e.classList.contains(i)&&o.classList.add(i),null==(s=e.querySelector(`.${r}`))?void 0:s.classList.contains(d))&&(null==(a=o.querySelector(`.${r}`))||a.classList.add(d));window.AudioMessagePlayer.events.emit("initialized",e)},onPlay:e=>{window.AudioMessagePlayer.events.emit("playing",e)},onPause:e=>{window.AudioMessagePlayer.events.emit("paused",e)},onEnd:e=>{window.AudioMessagePlayer.events.emit("finished",e)},onProgress:(e,t)=>{window.AudioMessagePlayer.events.emit("progress",e,t)},fcOnPause:e=>{window.AudioMessagePlayer.events.emit("fc_paused",e)}})}return _}(0,s.addEvent)(window,"orientationchange",(()=>setTimeout(h,500))),window.mail&&window.mail.onMessagesRepainted&&(window.onDOMReady(h),window.mail.onMessagesRepainted(h)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e){let t=p(),i=t.attachTo(e);!0===i?t.play():i.then((()=>{t.play()}))},toggle:function(){p().toggle()},seek:function(e){p().seek(e)},detachPlayer:function(e){p().detach(e)},pauseGlobalMedia:function(){o.VoiceMessagePlayer.pauseGlobalMedia()},resumeGlobalMedia:function(){o.VoiceMessagePlayer.resumeGlobalMedia()},redrawWaves:h,getWave:c,toggleTranscript:function(e,t){(0,s.cancelEvent)(t),e.classList.toggle(d),this.events.emit("transcription_toggle",e)}}},61810:(e,t,i)=>{i.d(t,{WebMediaSessionAdapter:()=>s});var o=i(11010);class s{play(){return this.player.playByButton()}pause(){return this.player.pauseByMediaSession()}isPlaying(){var e;const t=this.player.getCurrentPlaylist();return!!(null==(e=t)?void 0:e.isLive)&&t.isLive()||!1}getPrevAudio(){var e=this;return(0,o._)((function*(){return e.player.getPrevAudio()}))()}getNextAudio(){var e=this;return(0,o._)((function*(){return e.player.getNextAudio()}))()}next(){return this.player.playNextByMediaSession()}prev(){return this.player.playPrevByMediaSession()}seek(e){return this.player.seekByButton(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()}subscribe(e,t){var i;return null==(i=this.player.eventBus)?void 0:i.subscribe(e,t)}unsubscribe(e,t){var i;return null==(i=this.player.eventBus)?void 0:i.unsubscribe(e,t)}getCurrentAudio(){return this.player.getCurrentAudio()}getCurrentProgress(){return this.player.getCurrentProgress()}constructor(e){this.player=e,this.player.eventBus&&(this.subscriptions=this.player.eventBus.subscriptions),this.ads=this.player.ads}}}}]);try{stManager.done("dist/api/widgets/chunks/audioplayer-lib.87844cce.js")}catch(e){}