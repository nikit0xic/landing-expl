"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[41674],{861184:(e,t,n)=>{n.d(t,{default:()=>a});const a={counter:"BadgeCounter-module__counter--ZG07d"}},430935:(e,t,n)=>{n.d(t,{default:()=>a});const a={wrapper:"BadgeItem-module__wrapper--UDxg1"}},838455:(e,t,n)=>{n.d(t,{default:()=>a});const a={root:"BadgeItems-module__root--MdiCD"}},565293:(e,t,n)=>{n.d(t,{default:()=>a});const a={items:"BadgesOwnerBlockSkeleton-module__items--b27KV"}},259688:(e,t,n)=>{n.d(t,{default:()=>a});const a={card:"BadgesOwnerInfoCard-module__card--1VfEo",preview:"BadgesOwnerInfoCard-module__preview--xOjSA",title:"BadgesOwnerInfoCard-module__title--J0JB9",description:"BadgesOwnerInfoCard-module__description--jpXGI",users:"BadgesOwnerInfoCard-module__users--ylWIJ"}},368079:(e,t,n)=>{n.d(t,{default:()=>a});const a={items:"BadgesOwnerInfoModal-module__items--_C8HX",counter:"BadgesOwnerInfoModal-module__counter--dcVke",layout:"BadgesOwnerInfoModal-module__layout--H96gr",body:"BadgesOwnerInfoModal-module__body--xEx7W",settings:"BadgesOwnerInfoModal-module__settings--Cxf6L",previewItems:"BadgesOwnerInfoModal-module__previewItems--wFB2n",previewItem:"BadgesOwnerInfoModal-module__previewItem--pGWtg"}},395595:(e,t,n)=>{n.d(t,{Cache:()=>d});var a,s,r,o=n(11010),i=n(891047);!function(e){e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number"}(s||(s={})),function(e){e.HELP_HINTS="helpHints"}(r||(r={}));class d{getHelpHints(){return this.getItem(r.HELP_HINTS)}setHelpHints(e){return this.setItem(r.HELP_HINTS,e)}clear(){return(0,i.clear)(this.store)}getItem(e){var t=this;return(0,o._)((function*(){const n=t.buildItemKey(e),a=d.cache.get(n);return(0,i.get)(n,t.store).then((e=>e||a)).catch((()=>a))}))()}setItem(e,t){var n=this;return(0,o._)((function*(){const a=n.buildItemKey(e);d.cache.set(a,t),yield(0,i.set)(a,t,n.store).catch((()=>{}))}))()}deleteItem(e){const t=this.buildItemKey(e);return(0,i.del)(t,this.store)}buildItemKey(e){return`${e}-${d.VERSION}-${this.userId}`}getItemSync(e,t){const n=this.buildSyncItemKey(e);try{let e=localStorage.getItem(n);if(!e)return;switch(t){case s.OBJECT:try{e=JSON.parse(e)}catch(e){return}break;case s.NUMBER:e=Number(e)||0;break;case s.STRING_NUMBER:e=Number(e)||e;break;case s.BOOLEAN:e=Boolean(Number(e))}return e}catch(e){return d.cache.get(n)}}setItemSync(e,t,n){const a=this.buildSyncItemKey(e);switch(n){case s.OBJECT:t=JSON.stringify(t);break;case s.BOOLEAN:t=String(Number(t))}try{localStorage.setItem(a,t)}catch(e){d.cache.set(a,t)}}buildSyncItemKey(e){return`${d.DB_NAME}_${e}_${d.VERSION}_${this.userId}`}constructor({userId:e=(null==(a=window.vk)?void 0:a.id),categories:t}={}){var n;this.userId=e||0;let s="cache";(null==(n=t)?void 0:n.length)&&(s=`${s}-${t.join("-")}`),this.store=(0,i.createStore)(d.DB_NAME,s)}}d.DB_NAME="help-hints",d.VERSION=1,d.CACHE_UPDATE_EVENT_NAME=`${d.DB_NAME}_cache_update`,d.cache=new Map},822257:(e,t,n)=>{n.d(t,{HelpHint:()=>a});class a{get id(){return this.hint.id}get title(){return this.hint.title}get description(){return this.hint.description}getResource(e){var t,n;return null==(n=this.hint.resources)||null==(t=n.find((({key:t})=>t===e)))?void 0:t.value}constructor(e){this.hint=e}}},717731:(e,t,n)=>{n.d(t,{HelpHints:()=>c});var a=n(11010),s=n(434788),r=n(413151),o=n(166695),i=n(822257),d=n(395595),l=n(650640);class c{static setAPI(e){this.api=e}static setUserId(e){this.cacheOptions.userId=e,this.cache=void 0}static setCategories(e){Array.isArray(e)||(e=[e]),this.cacheOptions.categories=e,this.cache=void 0}static get(e){var t=this;return(0,a._)((function*(){return yield t.reload(),t.getSync(e)}))()}static getSync(e){var t;const n=null==(t=this.helpHints)?void 0:t.items.find((({id:t})=>t===e));if(n)return new i.HelpHint(n)}static show(e){return e instanceof i.HelpHint&&(e=e.id),this.api.account.showHelpHint({hint_id:e})}static hide(e){var t=this;return(0,a._)((function*(){e instanceof i.HelpHint&&(e=e.id);let n=!1;var a;(yield t.reloading,t.helpHints)&&(t.helpHints.items=t.helpHints.items.filter((({id:t})=>(t===e&&(n=!0),t!==e))),null==(a=t.cache)||a.setHelpHints(t.helpHints));return n?t.api.account.hideHelpHint({hint_id:e}):Promise.resolve()}))()}static getResource(e,t){var n=this;return(0,a._)((function*(){const a=yield n.get(e);if(a)return a.getResource(t)}))()}static reload(){var e=this;return(0,a._)((function*(){return yield e.reloading,e.cache||(e.cache=new d.Cache(e.cacheOptions)),e.reloading=new Promise((0,a._)((function*(t){var n,o;if(!e.api.options.token&&"function"!=typeof e.api.options.requestMethod){const n=yield e.getAccessToken();if(!n)return t();e.api=new r.API({token:n}),e.api.onTokenRegenerate((0,a._)((function*(n){const a=yield e.getAccessToken();if(!a)return t();n(a)})))}if(e.helpHints=yield null==(n=e.cache)?void 0:n.getHelpHints(),e.helpHints&&Date.now()-e.helpHints.date<l.TEN_MINUTES&&!e.isDevMode())return t();const{categories:i}=e.cacheOptions;e.helpHints=yield e.api.account.getHelpHints({categories:i?String(i):void 0}).then((e=>(0,s._)({},e,{date:Date.now()}))).catch((()=>{})),yield null==(o=e.cache)?void 0:o.setHelpHints(e.helpHints),e.refresh(),t()}))),e.reloading}))()}static refresh(){try{localStorage.setItem(d.Cache.CACHE_UPDATE_EVENT_NAME,""),localStorage.removeItem(d.Cache.CACHE_UPDATE_EVENT_NAME)}catch(e){}}static getAccessToken(){return(0,a._)((function*(){const e=yield(0,o.login)("web_token").catch((()=>{}));if(!e)return;const{access_token:t}=e;return t}))()}}c.api=new r.API({token:""}),c.cacheOptions={},c.reloading=Promise.resolve(),c.isDevMode=()=>localStorage.getItem("help-hints-dev"),window.addEventListener("storage",(({key:e,newValue:t})=>{e===d.Cache.CACHE_UPDATE_EVENT_NAME&&null!==t&&c.reload()}))},952258:(e,t,n)=>{var a,s;n.d(t,{HelpHintId:()=>s}),function(e){e.DEFAULT="default",e.STICKERS_UGC="stickers_ugc"}(a||(a={})),function(e){e.KEYBOARD_STICKERS_VMOJI="keyboard:stickers_vmoji",e.POSTING_POST_FEED_BADGES="posting:post_feed_badges",e.POSTING_POST_BADGES_ONBOARDING="posting:post_badges_onboarding",e.POSTING_POST_FEED_BADGES_UNSEEN="posting:post_feed_badges_unseen",e.POSTING_POST_BADGES_PAGE_UNSEEN="posting:post_badges_page_unseen",e.POSTING_POST_BADGES_CATALOG_USER="posting:post_badges_catalog_user",e.POSTING_POST_BADGES_FEEDBACK_USER="posting:post_badges_feedback_user",e.POSTING_POST_BADGES_FEEDBACK_USER_UNSEEN="posting:post_badges_feedback_user_unseen",e.STICKERS_UGC_SETTINGS_UNSEEN="stickers:ugc_settings_unseen",e.STICKERS_UGC_KEYBOARD_ONBOARDING="stickers:ugc_keyboard_onboarding",e.STICKERS_UGC_APP_ONBOARDING_MODAL="stickers:ugc_app_onboarding_modal",e.STICKERS_UGC_KEYBOARD_ONBOARDING_TOOLTIP="stickers:ugc_keyboard_onboarding_tooltip"}(s||(s={}))},650640:(e,t,n)=>{n.d(t,{TEN_MINUTES:()=>a});const a=6e5},38114:(e,t,n)=>{n.d(t,{WebStatEvents:()=>i});var a=n(11010),s=n(166695),r=n(413151),o=n(400643);const i=new class{setAPI(e){this.api=e}setUserId(e){this.userId=e}add(e){var t=this;return(0,a._)((function*(){var n,a,s,i,d;(yield t.init(),null!=(a=e).id||(a.id=(0,r.getRandomId)()),null!=(s=e).prev_id||(s.prev_id=null==(n=t.previousEvent)?void 0:n.id),null!=(i=e).timestamp||(i.timestamp=String((0,o.nowMicroseconds)())),"undefined"!=typeof window)&&(null!=(d=e).url||(d.url=window.location.href));e.type_navgo&&t.previousNavigationEvent&&(e.type_navgo.prev_navgo_id=t.previousNavigationEvent.id,e.type_navgo.prev_navgo_timestamp=t.previousNavigationEvent.timestamp),t.previousEvent=e,e.type_navgo&&(t.previousNavigationEvent=e),t.queue.add(e),t.send()}))()}init(){var e=this;return(0,a._)((function*(){if(e.initialized)return;if(e.initialized=!0,e.api)return;const t=yield(0,s.login)("web_token").catch((()=>{}));if(!t)return void(e.initialized=!1);const{access_token:n}=t;e.api=new r.API({token:n}),e.api.onTokenRegenerate((0,a._)((function*(t){const n=yield(0,s.login)("web_token").catch((()=>{}));if(!n)return void(e.initialized=!1);const{access_token:a}=n;t(a)})))}))()}send(){this.api&&this.queue.size&&(this.api.statEvents.addWeb({events:JSON.stringify([...this.queue.values()]),user_id:this.userId}),this.queue.clear())}constructor(){var e;this.userId="undefined"!=typeof window&&(null==(e=window.vk)?void 0:e.id)||0,this.queue=new Set,this.initialized=!1}}},400643:(e,t,n)=>{n.d(t,{nowMicroseconds:()=>s});const a=performance.timeOrigin||performance.timing.navigationStart||Date.now();function s(){return Math.floor(1e3*(a+performance.now()))}},4483:(e,t,n)=>{n.d(t,{useUniqId:()=>r});var a=n(667294),s=n(659397);function r(){return`:r${(0,a.useRef)((0,s.getRandomString)(6)).current}:`}},593163:(e,t,n)=>{n.d(t,{getUserFullName:()=>a});const a=e=>{const{first_name:t,last_name:n}=e;return`${t} ${n}`}},714332:(e,t,n)=>{n.d(t,{BadgeCounter:()=>d});var a=n(434788),s=n(512796),r=n(785893),o=n(86894),i=n(861184);const d=e=>{var t=(0,a._)({},(0,s._)(e));return(0,r.jsx)(o.Counter,(0,a._)({className:i.default.counter,mode:"inherit"},t))}},375050:(e,t,n)=>{n.d(t,{BadgeSenderItem:()=>h});var a=n(434788),s=n(820224),r=n(785893),o=n(846539),i=n(493829),d=n(38114),l=n(877926),c=n(636322),g=n(629309),u=n(593163),_=n(796299);function h(e){var{entry:t,user:{id:n,first_name:h,last_name:p,domain:b,photo_100:B,photo_200:I}}=e,v=(0,s._)(e,["entry","user"]);const m=(0,u.getUserFullName)({first_name:h,last_name:p}),f=((0,c.isRetina)()?I:B)||B||"";let w=null;return t.object_description&&(w=(0,g.parseReactWikiLinks)(t.object_description,{target:"_blank"})),w=(0,r.jsxs)(r.Fragment,{children:[w,(0,r.jsx)("br",{}),t.is_private&&l.getLang("awards_private_text")]}),(0,r.jsx)(o.RichCell,(0,a._)({before:(0,r.jsx)(i.Avatar,{size:100,src:f,title:m}),caption:w,href:b?`/${b}`:void 0,target:"_blank",onClick:()=>{d.WebStatEvents.add({screen:"badge",type:"type_click",type_click:{type:"type_badges_screen_item",item:{type:"badges",id:n},type_badges_screen_item:{type_badges_event:{event_name:_.BadgesEventName.OPEN_SENDER}}}})}},v,{children:m}))}},242535:(e,t,n)=>{n.d(t,{BadgeItem:()=>g,BadgeItemWrapper:()=>c});var a=n(785893),s=n(383147),r=n(772418),o=n(93977),i=n(796299),d=n(714332),l=n(430935);const c=({children:e})=>(0,a.jsx)("div",{className:l.default.wrapper,children:e}),g=({badge:e,counter:t,onClick:n})=>{if(!e)return null;const l=(0,o.getBadgeImage)(e.image,i.BADGE_IMAGE_SIZE_128);return(0,a.jsx)(c,{children:(0,a.jsx)(s.RichImage,{src:l,size:56,withBorder:!1,transparent:!0,onClick:()=>n(e.id),children:(0,a.jsx)(r.Image.Badge,{children:(0,a.jsx)(d.BadgeCounter,{size:"s",children:t})})})})}},393023:(e,t,n)=>{n.d(t,{BadgeItems:()=>d});var a=n(785893),s=n(667294),r=n(86894),o=n(242535),i=n(838455);const d=({counters:e,badges:t,onBadgeClick:n})=>{const d=(0,s.useMemo)((()=>{var s;return((null==(s=e)?void 0:s.filter((e=>"total"!==e.type)))||[]).map((({value:e,badge_id:s})=>{if(!s)return null;const r=t.find((({id:e})=>s===e));return(0,a.jsx)(o.BadgeItem,{counter:e,badge:r,onClick:n},s)}))}),[e,t,n]);return(0,a.jsx)(r.HorizontalScroll,{arrowSize:"m",children:(0,a.jsx)("div",{className:i.default.root,tabIndex:0,role:"button",children:d})})}},983756:(e,t,n)=>{n.d(t,{BadgesOwnerBlockSkeleton:()=>_});var a=n(434788),s=n(785893),r=n(667294),o=n(902379),i=n(806660),d=n(249779),l=n(659397),c=n(242535),g=n(565293);const u=(0,l.createArray)(4),_=e=>{const t=(0,r.useMemo)((()=>u.map(((e,t)=>(0,s.jsx)(c.BadgeItemWrapper,{children:(0,s.jsx)(o.Skeleton,{width:56,height:56,circle:!0})},t)))),[56,4]);return(0,s.jsx)(i.Group,(0,a._)({header:(0,s.jsx)(d.Header,{children:(0,s.jsx)(o.Skeleton,{width:192})})},e,{children:(0,s.jsx)("div",{className:g.default.items,children:t})}))}},712113:(e,t,n)=>{n.d(t,{BadgesOwnerInfoCard:()=>_});var a=n(785893),s=n(86894),r=n(383147),o=n(772418),i=n(942205),d=n(471828),l=n(93977),c=n(796299),g=n(714332),u=n(259688);const _=({badge:e,counter:t,recentSenderUsers:n,sendersCount:_,onClick:h})=>{var p;const b=null==(p=n)?void 0:p.slice(0,3).map((({photo_200:e})=>String(e)));return(0,a.jsxs)(s.Tappable,{className:u.default.card,onClick:h,children:[(0,a.jsx)(r.RichImage,{className:u.default.preview,"aria-label":e.title,src:(0,l.getBadgeImage)(e.image,c.BADGE_IMAGE_SIZE_128),size:c.BADGE_IMAGE_SIZE_128,transparent:!0,withBorder:!1,children:(0,a.jsx)(o.Image.Badge,{children:(0,a.jsx)(g.BadgeCounter,{children:t})})}),(0,a.jsx)(s.Title,{className:u.default.title,level:"2",weight:"1",children:e.title}),(0,a.jsx)(s.Text,{className:u.default.description,weight:"3",children:e.description}),Boolean(n.length)&&(0,a.jsx)("div",{className:u.default.users,children:(0,a.jsx)(i.UsersStack,{size:"l",photos:b,children:d.getLang("awards_senders_count",_).replace("{count}",String(_))})})]})}},182897:(e,t,n)=>{n.d(t,{BadgesOwnerInfoModal:()=>R});var a=n(434788),s=n(785893),r=n(667294),o=n(688538),i=n(189690),d=n(166695),l=n(38114),c=n(169447),g=n(784118),u=n(86894),_=n(242453),h=n(480164),p=n(800856),b=n(379956),B=n(383147),I=n(772418),v=n(252797),m=n(60811),f=n(49169),w=n(712113),E=n(375050),S=n(410069),O=n(714332),y=n(261712),A=n(471828),N=n(93977),k=n(9376),C=n(57436),L=n(796299),T=n(963169),j=n(368079);class R extends r.Component{componentDidMount(){const{ownerId:e,eventRef:t,badgeId:n}=this.props,a=`${n?"open_badges_collection_badge":"open_badges_collection_all"}__${o.Ranges.isUserId(e)?"u":"c"}`;this.sendStatEvent(a,t),this.fetchOwnerInfo()}componentWillUnmount(){window.removeEventListener("online",this.fetchOwnerInfo),window.removeEventListener("online",this.fetchOwnerEntries)}componentDidUpdate(){const{currentBadgeId:e}=this.state;e&&!this.getBadgeEntries(e)&&this.fetchOwnerEntries()}renderHeader(){const{isOwnerInfoLoaded:e,currentBadgeId:t,isAdmin:n}=this.state,{ownerId:a}=this.props;return(0,s.jsx)(_.ModalHeader,{closeAriaLabel:A.getLang("awards_back_button"),onClose:this.props.close,before:e&&t&&(0,s.jsxs)(h.ModalHeaderButton,{"aria-label":A.getLang("awards_back_button"),onClick:()=>this.selectBadge(null),children:[(0,s.jsx)(c.Icon20ChevronLeftOutline,{}),A.getLang("awards_back_button")]}),after:n&&(0,s.jsx)(p.Link,{className:j.default.settings,href:(()=>{const e=`${location.protocol}//${window.vk.host}`;let t;return o.Ranges.isGroupId(a)?(t=new URL(`public${Math.abs(a)}`,e),t.searchParams.set("act","sections")):(t=new URL("settings",e),t.searchParams.set("act","privacy"),t.searchParams.set("hl","badges")),t.toString()})(),target:"_blank",children:(0,s.jsx)(g.Icon20GearOutline,{})}),children:e&&!t?this.renderHeaderTitle():null})}renderHeaderTitle(){const{ownerId:e}=this.props,{totalCount:t}=this.state,n=t>0?(0,s.jsx)("span",{className:j.default.counter,children:t}):null;let a="";return a=e===window.vk.id?A.getLang("awards_my_badges"):o.Ranges.isGroupId(e)?A.getLang("awards_group_block_header"):A.getLang("awards_profile_block_header"),(0,s.jsxs)(s.Fragment,{children:[a," ",n]})}renderContent(){const{counters:e,currentBadgeId:t}=this.state;return t?this.renderBadgeInfo():(0,s.jsx)("div",{className:j.default.items,children:e.map((({badge_id:e,value:t,recent_sender_ids:n,senders_count:a})=>e?(0,s.jsx)(w.BadgesOwnerInfoCard,{badge:this.getBadgeById(e),counter:t,recentSenderUsers:this.getUsersById(n||[]),sendersCount:a||0,onClick:()=>this.selectBadge(e,L.BadgesEventRef.COLLECTON_ALL)},e):((0,T.badgesLogger)("No badge_id in list in BadgesOwnerInfoModal"),null)))})}renderBadgeInfo(){var e,t;const{currentBadgeId:n,counters:a}=this.state,r=this.getBadgeEntries(n||0),o=this.getBadgeById(n||0),i=(null==(e=a.find((e=>e.badge_id===n)))?void 0:e.value)||0;return r?(0,s.jsxs)(k.ReexportInfiniteScroll,{hasMore:Boolean(r.next_query),loadMore:this.fetchOwnerEntries,children:[(0,s.jsx)(b.ModalHeaderCard,{before:(0,s.jsx)(B.RichImage,{"aria-label":o.title,src:(0,N.getBadgeImage)(o.image,L.BADGE_IMAGE_SIZE_100),size:L.BADGE_IMAGE_SIZE_100,withBorder:!1,transparent:!0,children:(0,s.jsx)(I.Image.Badge,{children:(0,s.jsx)(O.BadgeCounter,{children:i})})}),title:(0,s.jsx)(u.Title,{Component:"span",level:"2",weight:"2",children:o.title}),subtitle:o.description,transparent:!0}),(0,s.jsx)(v.SeparatorSpacing,{size:50}),(0,s.jsx)("div",{className:j.default.previewItems,children:null==(t=r.entries)?void 0:t.map(((e,t)=>{const n=e.sender_id;return n?(0,s.jsx)(E.BadgeSenderItem,{className:j.default.previewItem,entry:e,user:this.getUserById(n)},t):null}))})]}):(0,s.jsx)(u.Spinner,{})}getBadgeById(e){return this.state.badges[e]}getUserById(e){return this.state.users[e]}getUsersById(e){return e.map((e=>this.getUserById(e)))}getBadgeEntries(e){return this.state.loadedBadgeEntries[e]}static convertBadges(e){return e.reduce(((e,t)=>(0,a._)({},e,{[t.id]:t})),{})}static convertUsers(e){return e.reduce(((e,t)=>(0,a._)({},e,{[t.id]:t})),{})}render(){const{currentBadgeId:e}=this.state,{isOwnerInfoLoaded:t}=this.state;return(0,s.jsxs)(m.ModalBox,{children:[this.renderHeader(),(0,s.jsx)(S.WithCustomScrollView,{withCustomScrollView:!e,className:j.default.layout,autoHideScrollbar:!0,children:(0,s.jsx)(f.ModalBody,{insetLevel:e?0:2,className:j.default.body,children:t?this.renderContent():(0,s.jsx)(u.Spinner,{})})})]})}constructor(e){super(e),this.sendStatEvent=(e,t,n)=>{var a;const{ownerId:s}=this.props,r={screen:"badge",type:"type_navgo",type_navgo:{type:"type_badges_screen_item",subtype:"go",item:{type:"badges",id:null==(a=n)?void 0:a.badgeId,owner_id:s},type_badges_screen_item:{type_badges_event:{event_name:e},type_badges_event_ref:{event_name:t}}}};l.WebStatEvents.add(r)},this.fetchOwnerInfo=()=>{window.removeEventListener("online",this.fetchOwnerInfo);const{ownerId:e}=this.props;return(0,d.api)("badges.getOwnerInfo",{owner_id:e,with_senders:1,fields:"photo_100,photo_200,domain"}).then((({owner_info:e,badges:t,users:n})=>{var a,s,r;this.setState({isOwnerInfoLoaded:!0,totalCount:(null==(a=((null==(s=e)?void 0:s.counters)||[]).find((e=>e.type===C.CounterType.total)))?void 0:a.value)||0,counters:((null==(r=e)?void 0:r.counters)||[]).filter((e=>e.type!==C.CounterType.total)),badges:R.convertBadges(t||[]),users:R.convertUsers(n||[])})})).catch((e=>{var t,n;(0,y.topError)((null==(n=e)||null==(t=n.error)?void 0:t.error_msg)||A.getLang("global_unknown_error")),(0,i.isNetworkError)(e)?window.addEventListener("online",this.fetchOwnerInfo):this.props.close()}))},this.fetchOwnerEntries=()=>{var e;window.removeEventListener("online",this.fetchOwnerEntries);const{ownerId:t}=this.props,{loadedBadgeEntries:n,currentBadgeId:s}=this.state;if(!s)return Promise.resolve();const r=this.getBadgeEntries(s),o={fields:"photo_100,photo_200,domain"};return(null==(e=r)?void 0:e.next_query)?Object.assign(o,{query:r.next_query}):Object.assign(o,{owner_id:t,badge_id:s,count:100}),(0,d.api)("badges.getOwnerEntries",o).then((({entries:e,badges:t,next_query:o,users:i})=>{var d;this.setState({isOwnerInfoLoaded:!0,users:(0,a._)({},this.state.users,R.convertUsers(i||[])),badges:(0,a._)({},this.state.badges,R.convertBadges(t||[])),loadedBadgeEntries:(0,a._)({},n,{[s]:{entries:[...(null==(d=r)?void 0:d.entries)||[],...e||[]],next_query:o}})})})).catch((e=>{var t,n;(0,y.topError)((null==(n=e)||null==(t=n.error)?void 0:t.error_msg)||A.getLang("global_unknown_error")),(0,i.isNetworkError)(e)&&window.addEventListener("online",this.fetchOwnerEntries)}))},this.selectBadge=(e,t)=>{const n=o.Ranges.isUserId(this.props.ownerId);e&&this.sendStatEvent("open_badges_collection_badge__"+(n?"u":"c"),t,{badgeId:e}),this.setState({currentBadgeId:e})};const{isAdmin:t=!1,badgeId:n}=e;this.state={isOwnerInfoLoaded:!1,totalCount:0,counters:[],badges:{},users:{},currentBadgeId:n||null,loadedBadgeEntries:{},isAdmin:t}}}},533142:(e,t,n)=>{n.d(t,{GroupBadges:()=>B});var a=n(785893),s=n(667294),r=n(86894),o=n(780891),i=n(806660),d=n(249779),l=n(796299),c=n(166695),g=n(451151),u=n(471828),_=n(393023),h=n(132018),p=n(934437),b=n(963169);const B=(0,h.withErrorBoundary)((e=>{var t,n,h,B,I,v;const{ownerId:m,isAdmin:f}=e,[w,E]=(0,s.useState)(),[S,O]=(0,s.useState)(l.LoadingStatus.pending);if((0,s.useEffect)((()=>{O(l.LoadingStatus.pending),(0,c.api)("badges.getOwnerInfo",{fields:String(["photo_100","photo_200","domain"]),owner_id:m}).then(E).then((()=>{O(l.LoadingStatus.loaded)})).catch((e=>{O(l.LoadingStatus.failed),(0,b.badgesLogger)("Failed badges.getOwnerInfo in GroupBadges",e)}))}),[m]),S!==l.LoadingStatus.loaded&&S!==l.LoadingStatus.failed)return(0,a.jsx)(p.BadgesOwnerBlockSkeleton,{separator:"hide"});if(!(null==(n=w)||null==(t=n.badges)?void 0:t.length)||S===l.LoadingStatus.failed)return null;const{badges:y,owner_info:A}=w,N=(null==(I=A)||null==(B=I.counters)||null==(h=B.find((e=>"total"===e.type)))?void 0:h.value)||0,k=e=>{(0,g.initBadgesOwnerInfo)({ownerId:m,isAdmin:f,badgeId:e,eventRef:e?l.BadgesEventRef.COLLECTION_BLOCK:void 0})};return(0,a.jsx)(o.AppRootProvider,{viewWidth:r.ViewWidth.DESKTOP,children:(0,a.jsx)(i.Group,{header:(0,a.jsx)(d.Header,{indicator:N,onClick:()=>k(),children:u.getLang("awards_profile_block_header")}),separator:"hide",children:(0,a.jsx)(_.BadgeItems,{badges:y,counters:null==(v=A)?void 0:v.counters,onBadgeClick:k})})})}))},132018:(e,t,n)=>{n.d(t,{withErrorBoundary:()=>g});var a=n(434788),s=n(785893),r=n(667294),o=n(806660),i=n(258037),d=n(441430),l=n(471828),c=n(963169);function g(e){return t=>(0,s.jsx)(u,{children:(0,s.jsx)(e,(0,a._)({},t))})}class u extends r.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){(0,c.badgesLogger)("Rendering error has happened in component GroupBadges",e)}render(){return this.state.hasError?(0,s.jsx)(o.Group,{separator:"hide",children:(0,s.jsx)(i.Placeholder,{header:l.getLang("global_error"),action:(0,s.jsx)(d.Button,{mode:"tertiary",loading:this.state.isReloading,onClick:this.onClick,children:l.getLang("global_reload")}),children:l.getLang("awards_group_block_unknown_error")})}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1,isReloading:!1},this.onClick=()=>{this.setState({isReloading:!0}),window.nav.reload({force:!0})}}}},410069:(e,t,n)=>{n.d(t,{WithCustomScrollView:()=>i});var a=n(434788),s=n(820224),r=n(785893),o=n(715201);const i=e=>{var{withCustomScrollView:t,children:n}=e,i=(0,s._)(e,["withCustomScrollView","children"]);return t?(0,r.jsx)(o.CustomScrollView,(0,a._)({},i,{children:n})):(0,r.jsx)(r.Fragment,{children:n})}},934437:(e,t,n)=>{n.r(t),n.d(t,{BadgesOwnerBlockSkeleton:()=>d.BadgesOwnerBlockSkeleton,BadgesOwnerInfo:()=>c,GroupBadges:()=>l.GroupBadges});var a=n(785893),s=n(182897),r=n(963169),o=n(284658),i=n(796299),d=n(983756),l=n(533142);const c={init({ownerId:e,isAdmin:t,badgeId:n,eventRef:d}){e?(0,o.showMessageBoxModal)((({onClose:r})=>(0,a.jsx)(s.BadgesOwnerInfoModal,{ownerId:e,isAdmin:t,close:r,badgeId:n,eventRef:d})),{width:i.BADGES_BOX_WIDTH}):(0,r.badgesLogger)(`Wrong arguments: ownerId=${e}`)}}},796299:(e,t,n)=>{n.d(t,{BADGES_BOX_WIDTH:()=>a,BADGES_RESTRICTED_CLASS_SELECTOR_FOR_POST:()=>I,BADGE_COMMENT_SELECTOR:()=>l,BADGE_IMAGE_SIZE_100:()=>_,BADGE_IMAGE_SIZE_128:()=>u,BADGE_IMAGE_SIZE_20:()=>B,BADGE_IMAGE_SIZE_28:()=>b,BADGE_IMAGE_SIZE_64:()=>p,BADGE_IMAGE_SIZE_96:()=>h,BadgesEventName:()=>i,BadgesEventRef:()=>o,BadgesObjectType:()=>d,DONUT_BADGE_ID:()=>g,ERRORS:()=>r,LINK_TO_HELP_FOR_AUTHORS:()=>s,LoadingStatus:()=>c});const a=640,s="/@authors-badges";var r;!function(e){e[e.ERROR_PARAM=100]="ERROR_PARAM",e[e.NEED_CONFIRMATION=24]="NEED_CONFIRMATION",e[e.BALANCE=504]="BALANCE"}(r||(r={}));const o={TAB:"tab",SENDER_LIST:"sender_list",POST_BTN:"post_btn",COLLECTION_BLOCK:"collection_block",COLLECTON_ALL:"collecton_all",NOTIFICATION:"notification",PUSH:"push",PIN:"pin",COMMENT_IMG:"comment_img",COMMENT_LINK:"comment_link",PROFILE_DETAILS:"profile_details"},i={OPEN_BADGE:"open_badge",OPEN_BADGES_ALL:"open_badges_all"};var d;!function(e){e[e.WALL=11]="WALL"}(d||(d={}));const l="BadgeComment";var c;!function(e){e[e.pending=0]="pending",e[e.loaded=1]="loaded",e[e.failed=2]="failed"}(c||(c={}));const g=38,u=128,_=100,h=96,p=64,b=28,B=20,I="post--badgesRestricted"},93977:(e,t,n)=>{n.d(t,{buildBadgesStackHtml:()=>_,buildHtmlAttributesString:()=>g,getBadgeImage:()=>c,getBadgesPlacementInPostActionStatusBarToUpdate:()=>u,isBadgesDisabledForOwner:()=>p,openHelpPage:()=>b,updateNewPostHTMLForBadges:()=>h});var a=n(636322),s=n(963169),r=n(2190),o=n(471828),i=n(796299),d=n(172613),l=n(977053);function c(e,t,n=!1){const{base_url:s,version:r}=e,o=r?`?${r}`:"";return!n&&(0,a.isRetina)()&&(t*=2),`${s}/${t}.png${o}`}const g=e=>Object.entries(e).reduce(((e,[t,n])=>{if(n){e+=` ${t}="${(0,a.escapeAttr)(String(n))}"`}return e}),""),u=(e,t,n)=>{var a;const r={place:void 0},o=e.querySelector(`._like_wall${t}_${n}`);if(!o)return(0,s.badgesLogger)("Нет кнопки лайка"),r;const i=null==(a=o.parentNode)?void 0:a.querySelector(".PostActionStatusBar");if(!i)return(0,s.badgesLogger)("Нет .PostActionStatusBar"),r;const d=i.querySelector(".BadgesStatusBar__badgesSendButton"),l=i.querySelector(".BadgesStack");return d||l?d?(r.element=d,r.place="button",r):(r.element=l,r.place="stack",r):((0,s.badgesLogger)('Нет ни стака значков, ни кнопки "Подарить"'),r)},_=({counters:e,badges:t,tqAttributes:n,withContainer:s,withLabel:i})=>{let d=0,c=0,u="";const _=r.colorScheme.isDarkScheme();if((e||[]).forEach((({type:e,badge_id:n,value:s})=>{if("total"===e)d=s;else if("badge"===e&&n&&c<3){var r;c++;const e=null==(r=t)?void 0:r.find((e=>e.id===n));if(e){const{image:t}=e,n=(0,a.isRetina)()?"stack28_light_2x.png":"stack28_light.png",s=(0,a.isRetina)()?"stack28_dark_2x.png":"stack28_dark.png",r=t.version?`?${t.version}`:"",o=`${t.base_url}/${n}${r}`,i=`${t.base_url}/${s}${r}`,d=g({src:_?i:o,class:"BadgesStackItem BadgesStack__item",alt:e.alt_text||"","data-src-light":o,"data-src-dark":i});u+=`<img ${d}>`}}})),d>0&&u){let e;e=(0,l.partConfigEnabled)("groups_one_time_donut_without_badges")?i?o.getLang("groups_have_donuts_total",d):o.getLang("groups_wkview_donuts_total",d):i?o.getLang("awards_have_gifted_badges_total",d):o.getLang("awards_wkview_badges_total",d);let t=`\n      <div class="BadgesStack__inner" ${n}>\n        <div class="BadgesStack__items">${u}</div>\n        <span class="BadgesStack__counter">${e}</span>\n      </div>\n    `;if(s){t=`\n        <div data-tooltip-container="true" id="badges_stack" class="BadgesStack" ${"data-exec='{\"BadgesStack/init\":[]}'"}>\n          ${t}\n        </div>\n      `}return t}return""},h=(e,t,n)=>{var a,s;const r=n[2],[o,l]=r.split("_"),c=null==(s=t)||null==(a=s.wallTpl)?void 0:a.send_badge,g={};return(0,d.isBadgesEnabled)()&&c&&(e.push(c),Object.assign(g,{badges_object_id:l,badges_object_owner_id:o,badges_object_type:i.BadgesObjectType.WALL,badges_event_ref:i.BadgesEventRef.POST_BTN})),g},p=e=>{const t=e[16];try{var n;if(""===t||(null==(n=JSON.parse(t))?void 0:n.is_disabled))return!0}catch(e){return(0,s.badgesLogger)("Event from queue about IS_DISABLED_FOR_OWNER is not json"),!1}return!1},b=()=>{window.open(i.LINK_TO_HELP_FOR_AUTHORS,"_blank")}},683108:(e,t,n)=>{n.d(t,{checkPostRestrictedToSendBadge:()=>o});var a=n(881365),s=n(963169),r=n(736435);const o=(e,t)=>{const n=(0,a.getPostById)(e,t);return n?!!n.classList.contains("post--badgesRestricted")&&((0,r.renderRestrictionModal)(),!0):((0,s.badgesLogger)("Не нашли пост для показа модалки ограничения бейджиков"),!0)}},881365:(e,t,n)=>{n.d(t,{getPostById:()=>a,getReplyById:()=>s});const a=(e,t)=>{const n=`${e}_${t}`;return document.querySelector(`[data-post-id="${n}"`)},s=(e,t,n)=>e.querySelector(`#post${t}_${n}`)},9376:(e,t,n)=>{n.d(t,{ReexportInfiniteScroll:()=>a});const a=n(13602).default},230047:(e,t,n)=>{n.d(t,{initBadgesTqInteractiveHandlers:()=>b,initGroupBadgesTq:()=>B,initOpenBadgesInfoModalTq:()=>p,initStartupBadgesCheckTq:()=>v,initStartupBadgesStackTq:()=>I,tqOpenBadgesObjectInfo:()=>h});var a=n(785893),s=n(973935),r=n(234173),o=n(451151),i=n(934437),d=n(172613),l=n(618418),c=n(2190),g=n(736435),u=n(796299),_=n(97241);const h=()=>{(0,r.tq)().setInteractiveHandler("Badges/openBadgesObjectInfo",(e=>{if(!e.payload.dataAttrs)return;const{badgeId:t,objectType:n,objectOwnerId:a,objectId:s,eventRef:r}=e.payload.dataAttrs;if(!n||!a||!s)throw new Error("No required attributes in tq Badges/openBadgesObjectInfo");(0,o.initBadgesObjectInfo)({objectId:{type:Number(n),ownerId:Number(a),id:Number(s)},badgeId:Number(t),eventRef:r})}))},p=()=>{(0,_.isWidget)()||(0,r.tq)().setInteractiveHandler("Badges/openBadgesInfoModal",(e=>{if(!e.payload.dataAttrs)return;const{modalType:t}=e.payload.dataAttrs;if("restriction"===t)(0,g.renderRestrictionModal)();else(0,g.renderBadgesNotAvailableModal)()}))},b=()=>{(0,_.isWidget)()||(h(),(0,r.tq)().setInteractiveHandler("Badges/openBadgesCatalog",(e=>{if(!e.payload.dataAttrs)return;const{objectType:t,objectOwnerId:n,objectId:a,eventRef:s}=e.payload.dataAttrs;if(!t||!n||!a)throw new Error("No required attributes in tq Badges/openBadgesCatalog");(0,o.initBadgesCatalog)({objectId:{id:Number(a),type:Number(t),ownerId:Number(n)},eventRef:s})})))},B=()=>{(0,r.tq)().setStartupHandler("BadgesOwner/render_group_badges",(e=>{const{data:{owner_id:t,is_admin:n},target:r}=e.payload;r&&void 0!==t&&(0,d.isBadgesEnabled)()&&(s.render((0,a.jsx)(i.GroupBadges,{ownerId:Number(t),isAdmin:Boolean(n)}),r),(0,l.pushNavDestroy)((()=>s.unmountComponentAtNode(r))))}))},I=()=>{(0,_.isWidget)()||((0,r.tq)().setStartupHandler("BadgesStack/init",(e=>{const{target:t}=e.payload;t&&c.colorScheme.subscribe((()=>{t.querySelectorAll(".BadgesStackItem").forEach((e=>{let t=e.src;const{srcLight:n=t,srcDark:a=t}=e.dataset;t=c.colorScheme.isDarkScheme()?a:n,e.src=t}))}))})),(0,r.tq)().setStartupHandler("BadgesSendButton/init_tooltip",(e=>{const{target:t}=e.payload;t&&(0,o.loadBadgesStatusBarOnboarding)({element:t})})))},v=()=>{if((0,_.isWidget)())return;(0,r.tq)().setStartupHandler("BadgeComment/init",(({payload:{target:e,data:t}})=>{if(!e)return;const n=t.fallback_text;if(!(0,d.isBadgesRenderingEnabled)())return void((e,t)=>{const n=e.parentElement;n&&(n.innerHTML=t)})(e,n);e.classList.remove("BadgeComment--hidden");const{is_enabled_for_owner:a,badge_id:s,object_type:r,object_owner_id:o,object_id:i}=t;if(!r||!o||!i)return;const l=(0,d.isBadgesEnabled)();if(a&&l)return e.setAttribute("data-task-click","Badges/openBadgesObjectInfo"),e.setAttribute("data-object-type",r),e.setAttribute("data-object-owner-id",o),e.setAttribute("data-object-id",i),e.setAttribute("data-badge-id",s),void e.setAttribute("data-event-ref",u.BadgesEventRef.COMMENT_IMG);e.setAttribute("data-task-click","Badges/openBadgesInfoModal"),e.setAttribute("data-modal-type",l?"restriction":"not_available")}))}},451151:(e,t,n)=>{n.d(t,{initBadgesCatalog:()=>_,initBadgesObjectInfo:()=>h,initBadgesOwnerInfo:()=>p,initBadgesTqInteractiveHandlers:()=>u.initBadgesTqInteractiveHandlers,initOpenBadgesInfoModalTq:()=>u.initOpenBadgesInfoModalTq,initStartupBadgesCheckTq:()=>u.initStartupBadgesCheckTq,initStartupBadgesStackTq:()=>u.initStartupBadgesStackTq,loadBadgesStatusBarOnboarding:()=>b});var a=n(11010),s=n(963169),r=n(659397),o=n(172613),i=n(251087),d=n(717731),l=n(952258),c=n(683108),g=n(977053),u=n(230047);const _=({objectId:e,eventRef:t,withCheckRestriction:a=!0})=>{(0,o.isBadgesEnabled)()&&(a&&(0,c.checkPostRestrictedToSendBadge)(e.ownerId,e.id)||((0,i.showBoxLoader)(),(window.BadgesCatalog?Promise.resolve():(0,r.asyncImportLoader)((()=>Promise.all([n.e(2067),n.e(20795),n.e(18669)]).then(n.bind(n,238487)))).then((({BadgesCatalog:e})=>{window.BadgesCatalog=e}))).then((()=>window.BadgesCatalog.init(e,t))).catch((e=>{(0,s.badgesLogger)("Error loading module BadgesCatalog",e)})).finally((()=>{(0,i.hideBoxLoader)()}))))},h=e=>{(0,o.isBadgesEnabled)()&&((0,i.showBoxLoader)(),(window.BadgesObjectInfo?Promise.resolve():(0,r.asyncImportLoader)((()=>Promise.all([n.e(213),n.e(2067),n.e(20795),n.e(57451),n.e(71610),n.e(5038),n.e(43110),n.e(3876),n.e(83803)]).then(n.bind(n,265143)))).then((({BadgesObjectInfo:e})=>{window.BadgesObjectInfo=e}))).then((()=>window.BadgesObjectInfo.init(e))).catch((e=>{(0,s.badgesLogger)("Error loading module BadgesObjectInfo",e)})).finally((()=>{(0,i.hideBoxLoader)()})))},p=e=>{(0,o.isBadgesEnabled)()&&((0,i.showBoxLoader)(),(window.BadgesOwnerInfo?Promise.resolve():(0,r.asyncImportLoader)((()=>Promise.resolve().then(n.bind(n,934437)))).then((({BadgesOwnerInfo:e})=>{window.BadgesOwnerInfo=e}))).then((()=>window.BadgesOwnerInfo.init(e))).catch((e=>{(0,s.badgesLogger)("Error loading module BadgesOwnerInfo",e)})).finally((()=>{(0,i.hideBoxLoader)()})))},b=(0,a._)((function*({element:e}){if(!(0,o.isBadgesEnabled)())return;(yield d.HelpHints.get((0,g.partConfigEnabled)("groups_one_time_donut_without_badges")?"posting:post_feed_no_badges_unseen":l.HelpHintId.POSTING_POST_FEED_BADGES_UNSEEN))&&(0,r.asyncImportLoader)((()=>n.e(27772).then(n.bind(n,994683)))).then((({renderStatusBarOnboarding:t})=>{t({element:e})})).catch((e=>{(0,s.badgesLogger)("Error loading module badges_status_bar_onboarding_init",e)}))}))},963169:(e,t,n)=>{n.d(t,{badgesLogger:()=>s});var a=n(65718);const s=(e,t)=>{window.vk.dev&&console.log(t),(0,a.logError)(new Error(e),{environment:"badges"})}},736435:(e,t,n)=>{n.d(t,{renderBadgesNotAvailableModal:()=>c,renderRestrictionModal:()=>l,renderTaskModal:()=>g});var a=n(434788),s=n(785893),r=n(661587),o=n(284658),i=n(471828);const d=(0,r.asyncComponent)((()=>n.e(60456).then(n.bind(n,469446))),(({BadgesRestrictedModal:e})=>e)),l=()=>{(0,o.showMessageBoxModalSuspense)((e=>(0,s.jsx)(d,(0,a._)({title:i.getLang("awards_restricted_tittle"),subtitle:i.getLang("awards_restricted_subheader"),buttonText:i.getLang("awards_restricted_button")},e))))},c=()=>{(0,o.showMessageBoxModalSuspense)((e=>(0,s.jsx)(d,(0,a._)({title:i.getLang("awards_not_available_tittle"),subtitle:i.getLang("awards_not_available_subheader"),buttonText:i.getLang("awards_not_available_button")},e))))},g=e=>{const t=(0,r.asyncComponent)((()=>n.e(64369).then(n.bind(n,137121))),(({BadgesTaskModal:e})=>e));(0,o.showMessageBoxModalSuspense)((n=>(0,s.jsx)(t,(0,a._)({},n,e))))}},57436:(e,t,n)=>{n.d(t,{CounterType:()=>a});const a={total:"total",badge:"badge",friends:"friends"}},512796:(e,t,n)=>{function a(e){if(null==e)throw new TypeError("Cannot destructure "+e);return e}n.d(t,{_:()=>a})}}]);try{stManager.done("dist/web/chunks/9a477bd9.76084b4c.js")}catch(e){}